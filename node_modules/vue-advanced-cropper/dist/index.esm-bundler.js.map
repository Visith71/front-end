{"version":3,"file":"index.esm-bundler.js","sources":["../node_modules/classnames/index.js","../node_modules/easy-bem/index.js","../node_modules/debounce/index.js","../node_modules/tslib/tslib.es6.js","../src/core/utils.ts","../src/core/events.ts","../src/components/service/DraggableElement.vue","../src/components/service/HandlerWrapper.vue","../src/components/service/LineWrapper.vue","../src/core/constants.ts","../src/core/service.ts","../src/core/algorithms/approximatedSize.ts","../src/core/algorithms/move.ts","../src/core/algorithms/applyTransform.ts","../src/core/algorithms/autoZoom.ts","../src/core/algorithms/defaultPosition.ts","../src/core/algorithms/defaultSize.ts","../src/core/algorithms/defaultVisibleArea.ts","../src/core/algorithms/limitBy.ts","../src/core/algorithms/manipulateImage.ts","../src/core/algorithms/rotateImage.ts","../src/core/algorithms/flipImage.ts","../src/core/algorithms/resize.ts","../src/components/handlers/SimpleHandler.vue","../src/components/lines/SimpleLine.vue","../src/components/service/BoundingBox.vue","../src/components/service/DraggableArea.vue","../src/core/image.ts","../src/components/service/PreviewResult.vue","../src/core/touch.ts","../src/components/service/CropperWrapper.vue","../src/components/helpers/Preview.vue","../src/components/service/StencilPreview.vue","../src/components/stencils/RectangleStencil.vue","../src/components/stencils/CircleStencil.vue","../src/Cropper.vue","../src/core/algorithms/initStretcher.ts","../src/core/algorithms/fitCoordinates.ts","../src/core/algorithms/fitVisibleArea.ts","../src/core/algorithms/areaRestrictions.ts","../src/core/algorithms/sizeRestrictions.ts","../src/core/algorithms/positionRestrictions.ts","../src/core/algorithms/refineSizeRestrictions.ts","../src/core/algorithms/roundCoordinates.ts","../src/core/algorithms/normalizeEvent.ts","../src/core/canvas.ts","../src/core/algorithms/defaultBoundaries.ts","../src/core/algorithms/refineVisibleArea.ts","../src/core/algorithms/stencil.ts"],"sourcesContent":["/*!\n  Copyright (c) 2017 Jed Watson.\n  Licensed under the MIT License (MIT), see\n  http://jedwatson.github.io/classnames\n*/\n/* global define */\n\n(function () {\n\t'use strict';\n\n\tvar hasOwn = {}.hasOwnProperty;\n\n\tfunction classNames () {\n\t\tvar classes = [];\n\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tvar arg = arguments[i];\n\t\t\tif (!arg) continue;\n\n\t\t\tvar argType = typeof arg;\n\n\t\t\tif (argType === 'string' || argType === 'number') {\n\t\t\t\tclasses.push(arg);\n\t\t\t} else if (Array.isArray(arg) && arg.length) {\n\t\t\t\tvar inner = classNames.apply(null, arg);\n\t\t\t\tif (inner) {\n\t\t\t\t\tclasses.push(inner);\n\t\t\t\t}\n\t\t\t} else if (argType === 'object') {\n\t\t\t\tfor (var key in arg) {\n\t\t\t\t\tif (hasOwn.call(arg, key) && arg[key]) {\n\t\t\t\t\t\tclasses.push(key);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn classes.join(' ');\n\t}\n\n\tif (typeof module !== 'undefined' && module.exports) {\n\t\tclassNames.default = classNames;\n\t\tmodule.exports = classNames;\n\t} else if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {\n\t\t// register as 'classnames', consistent with npm package name\n\t\tdefine('classnames', [], function () {\n\t\t\treturn classNames;\n\t\t});\n\t} else {\n\t\twindow.classNames = classNames;\n\t}\n}());\n","'use strict';\r\n\r\n/**\r\n * BEM class name factory.\r\n *\r\n * @typedef {Function} Bem\r\n * @param {String|Object} [elementOrMods] Element name or hash object with mods\r\n * @param {Object} [mods] Hash object with mods\r\n * @returns {String}\r\n */\r\n\r\n/**\r\n * Returns BEM class name factory.\r\n *\r\n * @param {String} componentName Block name\r\n * @returns {Bem}\r\n */\r\nmodule.exports = function bem(componentName) {\r\n    return function (elementOrMods, mods) {\r\n        if (!elementOrMods) {\r\n            return componentName;\r\n        }\r\n\r\n        var element;\r\n\r\n        if (typeof elementOrMods === 'string') {\r\n            element = elementOrMods;\r\n        } else {\r\n            mods = elementOrMods;\r\n        }\r\n\r\n        var base = componentName;\r\n        if (element) {\r\n            base += '__' + element;\r\n        }\r\n\r\n        return base + (\r\n            mods\r\n                ? Object.keys(mods).reduce(function (result, name) {\r\n                    var value = mods[name];\r\n\r\n                    if (value) {\r\n                        result += ' ' + (\r\n                            typeof value === 'boolean'\r\n                                ? (base + '--' + name)\r\n                                : (base + '--' + name + '_' + value)\r\n                        );\r\n                    }\r\n\r\n                    return result;\r\n                }, '')\r\n                : ''\r\n        );\r\n    };\r\n}\r\n","/**\n * Returns a function, that, as long as it continues to be invoked, will not\n * be triggered. The function will be called after it stops being called for\n * N milliseconds. If `immediate` is passed, trigger the function on the\n * leading edge, instead of the trailing. The function also has a property 'clear' \n * that is a function which will clear the timer to prevent previously scheduled executions. \n *\n * @source underscore.js\n * @see http://unscriptable.com/2009/03/20/debouncing-javascript-methods/\n * @param {Function} function to wrap\n * @param {Number} timeout in ms (`100`)\n * @param {Boolean} whether to execute at the beginning (`false`)\n * @api public\n */\nfunction debounce(func, wait, immediate){\n  var timeout, args, context, timestamp, result;\n  if (null == wait) wait = 100;\n\n  function later() {\n    var last = Date.now() - timestamp;\n\n    if (last < wait && last >= 0) {\n      timeout = setTimeout(later, wait - last);\n    } else {\n      timeout = null;\n      if (!immediate) {\n        result = func.apply(context, args);\n        context = args = null;\n      }\n    }\n  };\n\n  var debounced = function(){\n    context = this;\n    args = arguments;\n    timestamp = Date.now();\n    var callNow = immediate && !timeout;\n    if (!timeout) timeout = setTimeout(later, wait);\n    if (callNow) {\n      result = func.apply(context, args);\n      context = args = null;\n    }\n\n    return result;\n  };\n\n  debounced.clear = function() {\n    if (timeout) {\n      clearTimeout(timeout);\n      timeout = null;\n    }\n  };\n  \n  debounced.flush = function() {\n    if (timeout) {\n      result = func.apply(context, args);\n      context = args = null;\n      \n      clearTimeout(timeout);\n      timeout = null;\n    }\n  };\n\n  return debounced;\n};\n\n// Adds compatibility for ES modules\ndebounce.debounce = debounce;\n\nmodule.exports = debounce;\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","type Protocol = 'http' | 'https';\r\n\r\nexport function directionNames(hDirection, vDirection) {\r\n\tlet name, classname;\r\n\tif (hDirection && vDirection) {\r\n\t\tname = `${hDirection}${vDirection[0].toUpperCase()}${vDirection.slice(1)}`;\r\n\t\tclassname = `${hDirection}-${vDirection}`;\r\n\t} else {\r\n\t\tname = hDirection || vDirection;\r\n\t\tclassname = hDirection || vDirection;\r\n\t}\r\n\treturn { name, classname };\r\n}\r\n\r\nexport function isBlob(url: string) {\r\n\treturn /^blob:/.test(url);\r\n}\r\n\r\nexport function isDataUrl(url: string) {\r\n\treturn /^data:/.test(url);\r\n}\r\n\r\nexport function isLocal(url: string) {\r\n\treturn isBlob(url) || isDataUrl(url);\r\n}\r\n\r\nexport function isCrossOriginURL(url: string) {\r\n\tif (isLocal(url)) {\r\n\t\treturn false;\r\n\t}\r\n\tconst pageLocation = window.location;\r\n\tconst URL_HOST_PATTERN = /(\\w+:)?(?:\\/\\/)([\\w.-]+)?(?::(\\d+))?\\/?/;\r\n\tconst urlMatch = URL_HOST_PATTERN.exec(url) || [];\r\n\tconst urlparts = {\r\n\t\tprotocol: urlMatch[1] || '',\r\n\t\thost: urlMatch[2] || '',\r\n\t\tport: urlMatch[3] || '',\r\n\t};\r\n\r\n\tconst defaultPort = (protocol: Protocol) => {\r\n\t\tif (protocol === 'http') {\r\n\t\t\treturn 80;\r\n\t\t} else {\r\n\t\t\treturn 433;\r\n\t\t}\r\n\t};\r\n\r\n\tconst portOf = (location: any) => {\r\n\t\treturn location.port || defaultPort((location.protocol || pageLocation.protocol) as Protocol);\r\n\t};\r\n\r\n\treturn !(\r\n\t\t(!urlparts.protocol && !urlparts.host && !urlparts.port) ||\r\n\t\tBoolean(\r\n\t\t\turlparts.protocol &&\r\n\t\t\t\turlparts.protocol == pageLocation.protocol &&\r\n\t\t\t\turlparts.host &&\r\n\t\t\t\turlparts.host == pageLocation.host &&\r\n\t\t\t\turlparts.host &&\r\n\t\t\t\tportOf(urlparts) == portOf(pageLocation),\r\n\t\t)\r\n\t);\r\n}\r\n\r\nexport function isFunction(obj: any) {\r\n\treturn !!(obj && obj.constructor && obj.call && obj.apply);\r\n}\r\n\r\nexport function isUndefined(obj: any): boolean {\r\n\treturn obj === undefined;\r\n}\r\n\r\nexport function isObject(obj) {\r\n\treturn typeof obj === 'object' && obj !== null;\r\n}\r\n\r\nexport function getOptions(options: any, defaultScheme: any, falseScheme: any) {\r\n\tconst result: any = {};\r\n\tif (isObject(options)) {\r\n\t\tObject.keys(defaultScheme).forEach((key) => {\r\n\t\t\tif (isUndefined(options[key])) {\r\n\t\t\t\tresult[key] = defaultScheme[key];\r\n\t\t\t} else if (isObject(defaultScheme[key])) {\r\n\t\t\t\tif (isObject(options[key])) {\r\n\t\t\t\t\tresult[key] = getOptions(options[key], defaultScheme[key], falseScheme[key]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult[key] = options[key] ? defaultScheme[key] : falseScheme[key];\r\n\t\t\t\t}\r\n\t\t\t} else if (defaultScheme[key] === true || defaultScheme[key] === false) {\r\n\t\t\t\tresult[key] = Boolean(options[key]);\r\n\t\t\t} else {\r\n\t\t\t\tresult[key] = options[key];\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t} else {\r\n\t\tif (options) {\r\n\t\t\treturn defaultScheme;\r\n\t\t} else {\r\n\t\t\treturn falseScheme;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function getSettings<T extends {}>(param, defaultParams?: T) {\r\n\tlet result = {\r\n\t\tenabled: Boolean(param),\r\n\t\t...defaultParams,\r\n\t};\r\n\tif (isObject(param)) {\r\n\t\tresult = { ...result, ...param };\r\n\t}\r\n\treturn result;\r\n}\r\n\r\nexport function parseNumber(number) {\r\n\tconst parsedNumber = Number(number);\r\n\tif (Number.isNaN(parsedNumber)) {\r\n\t\treturn number;\r\n\t} else {\r\n\t\treturn parsedNumber;\r\n\t}\r\n}\r\n\r\nexport function replacedProp(value, oldName, currentName) {\r\n\tif (!isEmpty(value) && process.env.NODE_ENV !== 'production') {\r\n\t\tconsole.warn(`Warning: prop \"${oldName}\" is deprecated, use \"${currentName}\" instead. Value:`, value);\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nexport function isEmpty(obj) {\r\n\treturn (!obj || Object.keys(obj).length === 0) && typeof obj !== 'function';\r\n}\r\n\r\nexport function isObjectLike(value) {\r\n\treturn typeof value === 'object' && value !== null;\r\n}\r\n\r\nexport function isNumber(value) {\r\n\treturn (\r\n\t\ttypeof (value == 'number' || (isObjectLike(value) && toString.call(value) == '[object Number]')) &&\r\n\t\t!isNaN(value)\r\n\t);\r\n}\r\n\r\nexport function isNumeric(value) {\r\n\treturn !Number.isNaN(parseFloat(value)) && isFinite(value);\r\n}\r\n\r\nexport function isNaN(value) {\r\n\treturn value !== value;\r\n}\r\n\r\nexport function isLoadedImage(image) {\r\n\treturn Boolean(image.naturalWidth);\r\n}\r\n\r\nexport function distance(firstPoint, secondPoint) {\r\n\treturn Math.sqrt(Math.pow(firstPoint.x - secondPoint.x, 2) + Math.pow(firstPoint.y - secondPoint.y, 2));\r\n}\r\n\r\nexport function isApproximatelyEqual(a: number, b: number, precision = 0.001) {\r\n\tif (a === 0 || b === 0) {\r\n\t\treturn Math.abs(b - a) < precision;\r\n\t} else {\r\n\t\treturn Math.abs(b / a) < 1 + precision && Math.abs(b / a) > 1 - precision;\r\n\t}\r\n}\r\n\r\nexport function sign(value) {\r\n\tconst number = +value;\r\n\tif (number === 0 || isNaN(number)) {\r\n\t\treturn number;\r\n\t}\r\n\treturn number > 0 ? 1 : -1;\r\n}\r\n\r\nexport function radians(angle: number) {\r\n\treturn (angle * Math.PI) / 180;\r\n}\r\n","import { StencilEvent, Diff, MoveDirections, Point, ResizeDirections, Scale } from './typings';\r\n\r\nexport class ManipulateImageEvent implements StencilEvent {\r\n\ttype: 'manipulateImage';\r\n\tnativeEvent: Event;\r\n\tmove: Partial<MoveDirections>;\r\n\tscale: Partial<Scale>;\r\n\tconstructor(move: Partial<MoveDirections> = {}, scale: Partial<Scale> = {}) {\r\n\t\tthis.type = 'manipulateImage';\r\n\t\tthis.move = move;\r\n\t\tthis.scale = scale;\r\n\t}\r\n}\r\n\r\nexport interface ResizeEventParams {\r\n\tcompensate?: boolean;\r\n\tpreserveRatio?: boolean;\r\n\tallowedDirections?: ResizeDirections;\r\n\trespectDirection?: 'width' | 'height';\r\n}\r\n\r\nexport class ResizeEvent implements StencilEvent {\r\n\ttype: 'resize';\r\n\tdirections: ResizeDirections;\r\n\tparams: ResizeEventParams;\r\n\r\n\tconstructor(directions: ResizeDirections, params: ResizeEventParams = {}) {\r\n\t\tthis.type = 'resize';\r\n\t\tthis.directions = directions;\r\n\t\tthis.params = params;\r\n\t}\r\n}\r\n\r\nexport class MoveEvent implements StencilEvent {\r\n\ttype: 'move';\r\n\tdirections: MoveDirections;\r\n\r\n\tconstructor(directions: MoveDirections) {\r\n\t\tthis.type = 'move';\r\n\t\tthis.directions = directions;\r\n\t}\r\n}\r\n\r\nexport class DragEvent implements StencilEvent {\r\n\ttype: 'drag';\r\n\tnativeEvent: Event;\r\n\tposition: Point;\r\n\tpreviousPosition: Point;\r\n\tanchor: Point;\r\n\telement: HTMLElement;\r\n\r\n\tconstructor(nativeEvent: Event, element: HTMLElement, position: Point, previousPosition: Point, anchor: Point) {\r\n\t\tthis.type = 'drag';\r\n\t\tthis.nativeEvent = nativeEvent;\r\n\t\tthis.position = position;\r\n\t\tthis.previousPosition = previousPosition;\r\n\t\tthis.element = element;\r\n\t\tthis.anchor = anchor;\r\n\t}\r\n\tpublic shift(): Diff {\r\n\t\tconst { element, anchor, position } = this;\r\n\r\n\t\tif (element) {\r\n\t\t\tconst { left, top } = element.getBoundingClientRect();\r\n\t\t\treturn {\r\n\t\t\t\tleft: position.left - left - anchor.left,\r\n\t\t\t\ttop: position.top - top - anchor.top,\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\treturn {\r\n\t\t\t\tleft: 0,\r\n\t\t\t\ttop: 0,\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n}\r\n","<script>\r\nimport { DragEvent } from '../../core/events';\r\n\r\nexport default {\r\n\tname: 'DraggableElement',\r\n\tprops: {\r\n\t\tclassname: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t},\r\n\tbeforeMount() {\r\n\t\twindow.addEventListener('mouseup', this.onMouseUp, { passive: false });\r\n\t\twindow.addEventListener('mousemove', this.onMouseMove, { passive: false });\r\n\t\twindow.addEventListener('touchmove', this.onTouchMove, { passive: false });\r\n\t\twindow.addEventListener('touchend', this.onTouchEnd, { passive: false });\r\n\t},\r\n\tbeforeUnmount() {\r\n\t\twindow.removeEventListener('mouseup', this.onMouseUp);\r\n\t\twindow.removeEventListener('mousemove', this.onMouseMove);\r\n\t\twindow.removeEventListener('touchmove', this.onTouchMove);\r\n\t\twindow.removeEventListener('touchend', this.onTouchEnd);\r\n\t},\r\n\tmounted() {\r\n\t\tif (!this.$refs.draggable) {\r\n\t\t\tthrow new Error('You should add ref \"draggable\" to your root element to use draggable mixin');\r\n\t\t}\r\n\t\tthis.touches = [];\r\n\t\tthis.hovered = false;\r\n\t},\r\n\tmethods: {\r\n\t\tonMouseOver() {\r\n\t\t\tif (!this.hovered) {\r\n\t\t\t\tthis.hovered = true;\r\n\t\t\t\tthis.$emit('enter');\r\n\t\t\t}\r\n\t\t},\r\n\t\tonMouseLeave() {\r\n\t\t\tif (this.hovered && !this.touches.length) {\r\n\t\t\t\tthis.hovered = false;\r\n\t\t\t\tthis.$emit('leave');\r\n\t\t\t}\r\n\t\t},\r\n\t\tonTouchStart(e) {\r\n\t\t\tif (e.cancelable && !this.disabled && e.touches.length === 1) {\r\n\t\t\t\tthis.touches = [...e.touches];\r\n\r\n\t\t\t\tif (!this.hovered) {\r\n\t\t\t\t\tthis.$emit('enter');\r\n\t\t\t\t\tthis.hovered = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (e.touches.length) {\r\n\t\t\t\t\tthis.initAnchor(\r\n\t\t\t\t\t\tthis.touches.reduce(\r\n\t\t\t\t\t\t\t(mean, touch) => {\r\n\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\tclientX: mean.clientX + touch.clientX / e.touches.length,\r\n\t\t\t\t\t\t\t\t\tclientY: mean.clientY + touch.clientY / e.touches.length,\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{ clientX: 0, clientY: 0 },\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tif (e.preventDefault) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t},\r\n\t\tonTouchEnd() {\r\n\t\t\tthis.processEnd();\r\n\t\t},\r\n\t\tonTouchMove(e) {\r\n\t\t\tif (this.touches.length) {\r\n\t\t\t\tthis.processMove(e, e.touches);\r\n\t\t\t\tif (e.preventDefault) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t\tif (e.stopPropagation) {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tonMouseDown(e) {\r\n\t\t\tif (!this.disabled) {\r\n\t\t\t\tconst touch = {\r\n\t\t\t\t\tfake: true,\r\n\t\t\t\t\tclientX: e.clientX,\r\n\t\t\t\t\tclientY: e.clientY,\r\n\t\t\t\t};\r\n\t\t\t\tthis.touches = [touch];\r\n\t\t\t\tthis.initAnchor(touch);\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t},\r\n\t\tonMouseMove(e) {\r\n\t\t\tif (this.touches.length) {\r\n\t\t\t\tthis.processMove(e, [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfake: true,\r\n\t\t\t\t\t\tclientX: e.clientX,\r\n\t\t\t\t\t\tclientY: e.clientY,\r\n\t\t\t\t\t},\r\n\t\t\t\t]);\r\n\t\t\t\tif (e.preventDefault) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tonMouseUp() {\r\n\t\t\tthis.processEnd();\r\n\t\t},\r\n\t\tinitAnchor(touch) {\r\n\t\t\tconst draggable = this.$refs.draggable;\r\n\t\t\tconst { left, right, bottom, top } = draggable.getBoundingClientRect();\r\n\r\n\t\t\tthis.anchor = {\r\n\t\t\t\tleft: touch.clientX - left,\r\n\t\t\t\ttop: touch.clientY - top,\r\n\t\t\t\tbottom: bottom - touch.clientY,\r\n\t\t\t\tright: right - touch.clientX,\r\n\t\t\t};\r\n\t\t},\r\n\t\tprocessMove(event, touches) {\r\n\t\t\tconst newTouches = [...touches];\r\n\t\t\tif (this.touches.length) {\r\n\t\t\t\tif (this.touches.length === 1 && newTouches.length === 1) {\r\n\t\t\t\t\tconst element = this.$refs.draggable;\r\n\t\t\t\t\tthis.$emit(\r\n\t\t\t\t\t\t'drag',\r\n\t\t\t\t\t\tnew DragEvent(\r\n\t\t\t\t\t\t\tevent,\r\n\t\t\t\t\t\t\telement,\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tleft: newTouches[0].clientX,\r\n\t\t\t\t\t\t\t\ttop: newTouches[0].clientY,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tleft: this.touches[0].clientX,\r\n\t\t\t\t\t\t\t\ttop: this.touches[0].clientY,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tthis.anchor,\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tthis.touches = newTouches;\r\n\t\t\t}\r\n\t\t},\r\n\t\tprocessEnd() {\r\n\t\t\tif (this.touches.length) {\r\n\t\t\t\tthis.$emit('drag-end');\r\n\t\t\t}\r\n\t\t\tif (this.hovered) {\r\n\t\t\t\tthis.$emit('leave');\r\n\t\t\t\tthis.hovered = false;\r\n\t\t\t}\r\n\t\t\tthis.touches = [];\r\n\t\t},\r\n\t},\r\n\temits: ['drag', 'drag-end', 'leave', 'enter'],\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<div\r\n\t\tref=\"draggable\"\r\n\t\t:class=\"classname\"\r\n\t\t@touchstart=\"onTouchStart\"\r\n\t\t@mousedown=\"onMouseDown\"\r\n\t\t@mouseover=\"onMouseOver\"\r\n\t\t@mouseleave=\"onMouseLeave\"\r\n\t>\r\n\t\t<slot />\r\n\t</div>\r\n</template>\r\n","<script>\r\nimport bem from 'easy-bem';\r\nimport classnames from 'classnames';\r\nimport { directionNames } from '../../core/utils';\r\nimport DraggableElement from './DraggableElement.vue';\r\n\r\nconst cn = bem('vue-handler-wrapper');\r\n\r\nexport default {\r\n\tname: 'HandlerWrapper',\r\n\tcomponents: {\r\n\t\tDraggableElement,\r\n\t},\r\n\tprops: {\r\n\t\thorizontalPosition: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tverticalPosition: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tdisabled: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false,\r\n\t\t},\r\n\t},\r\n\tcomputed: {\r\n\t\tclasses() {\r\n\t\t\tlet rootClass;\r\n\t\t\tif (this.horizontalPosition || this.verticalPosition) {\r\n\t\t\t\tconst position = directionNames(this.horizontalPosition, this.verticalPosition);\r\n\t\t\t\trootClass = cn({ [position.classname]: true, disabled: this.disabled });\r\n\t\t\t} else {\r\n\t\t\t\trootClass = cn({ disabled: this.disabled });\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\troot: rootClass,\r\n\t\t\t\tdraggable: cn('draggable'),\r\n\t\t\t};\r\n\t\t},\r\n\t},\r\n\temits: ['leave', 'enter', 'drag', 'drag-end'],\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<div :class=\"classes.root\">\r\n\t\t<DraggableElement\r\n\t\t\t:class=\"classes.draggable\"\r\n\t\t\t:disabled=\"disabled\"\r\n\t\t\t@drag=\"$emit('drag', $event)\"\r\n\t\t\t@drag-end=\"$emit('drag-end')\"\r\n\t\t\t@leave=\"$emit('leave')\"\r\n\t\t\t@enter=\"$emit('enter')\"\r\n\t\t>\r\n\t\t\t<slot />\r\n\t\t</DraggableElement>\r\n\t</div>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.vue-handler-wrapper {\r\n\tposition: absolute;\r\n\ttransform: translate(-50%, -50%);\r\n\twidth: 30px;\r\n\theight: 30px;\r\n\t&__draggable {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t}\r\n\t&--west-north {\r\n\t\tcursor: nw-resize;\r\n\t}\r\n\t&--north {\r\n\t\tcursor: n-resize;\r\n\t}\r\n\t&--east-north {\r\n\t\tcursor: ne-resize;\r\n\t}\r\n\t&--east {\r\n\t\tcursor: e-resize;\r\n\t}\r\n\t&--east-south {\r\n\t\tcursor: se-resize;\r\n\t}\r\n\t&--south {\r\n\t\tcursor: s-resize;\r\n\t}\r\n\t&--west-south {\r\n\t\tcursor: sw-resize;\r\n\t}\r\n\t&--west {\r\n\t\tcursor: w-resize;\r\n\t}\r\n\t&--disabled {\r\n\t\tcursor: auto;\r\n\t}\r\n}\r\n</style>\r\n","<script>\r\nimport bem from 'easy-bem';\r\nimport DraggableElement from './DraggableElement.vue';\r\n\r\nconst cn = bem('vue-line-wrapper');\r\n\r\nexport default {\r\n\tname: 'LineWrapper',\r\n\tcomponents: {\r\n\t\tDraggableElement,\r\n\t},\r\n\tprops: {\r\n\t\tposition: {\r\n\t\t\ttype: String,\r\n\t\t\trequired: true,\r\n\t\t},\r\n\t\tdisabled: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false,\r\n\t\t},\r\n\t},\r\n\tcomputed: {\r\n\t\tclassname() {\r\n\t\t\treturn cn({ [this.position]: true, disabled: this.disabled });\r\n\t\t},\r\n\t},\r\n\temits: ['leave', 'enter', 'drag', 'drag-end'],\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<DraggableElement\r\n\t\t:class=\"classname\"\r\n\t\t:disabled=\"disabled\"\r\n\t\t@drag=\"$emit('drag', $event)\"\r\n\t\t@drag-end=\"$emit('drag-end')\"\r\n\t\t@leave=\"$emit('leave')\"\r\n\t\t@enter=\"$emit('enter')\"\r\n\t>\r\n\t\t<slot />\r\n\t</DraggableElement>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.vue-line-wrapper {\r\n\tbackground: none;\r\n\tposition: absolute;\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n\r\n\t&--north,\r\n\t&--south {\r\n\t\theight: 12px;\r\n\t\twidth: 100%;\r\n\t\tleft: 0;\r\n\t\ttransform: translateY(-50%);\r\n\t}\r\n\t&--north {\r\n\t\ttop: 0;\r\n\t\tcursor: n-resize;\r\n\t}\r\n\t&--south {\r\n\t\ttop: 100%;\r\n\t\tcursor: s-resize;\r\n\t}\r\n\r\n\t&--east,\r\n\t&--west {\r\n\t\twidth: 12px;\r\n\t\theight: 100%;\r\n\t\ttransform: translateX(-50%);\r\n\t\ttop: 0;\r\n\t}\r\n\t&--east {\r\n\t\tleft: 100%;\r\n\t\tcursor: e-resize;\r\n\t}\r\n\t&--west {\r\n\t\tleft: 0;\r\n\t\tcursor: w-resize;\r\n\t}\r\n\t&--disabled {\r\n\t\tcursor: auto;\r\n\t}\r\n}\r\n</style>\r\n","import { HorizontalDirection, PositionDirection, VerticalDirection, MainDirections } from './typings';\r\n\r\nexport const ALL_DIRECTIONS: PositionDirection[] = ['left', 'right', 'top', 'bottom'];\r\nexport const HORIZONTAL_DIRECTIONS: HorizontalDirection[] = ['left', 'right'];\r\nexport const VERTICAL_DIRECTIONS: VerticalDirection[] = ['top', 'bottom'];\r\nexport const MAIN_DIRECTIONS: MainDirections[] = ['left', 'top'];\r\nexport const IMAGE_RESTRICTIONS = ['fill-area', 'fit-area', 'stencil', 'none'];\r\nexport const XHR_DONE = 4;\r\n\r\nexport const DEFAULT_COORDINATES = {\r\n\tleft: 0,\r\n\ttop: 0,\r\n\twidth: 0,\r\n\theight: 0,\r\n};\r\n","import {\r\n\tAspectRatio,\r\n\tCoordinates,\r\n\tDiff,\r\n\tIntersections,\r\n\tLimits,\r\n\tMoveDirections,\r\n\tPoint,\r\n\tResizeDirections,\r\n\tSize,\r\n\tSizeRestrictions,\r\n} from './typings';\r\nimport { ALL_DIRECTIONS } from './constants';\r\n\r\nexport function isEqual(a: any, b: any, properties?: string[]): boolean {\r\n\tproperties = properties || ['width', 'height', 'left', 'top'];\r\n\treturn !properties.some((property) => a[property] !== b[property]);\r\n}\r\n\r\nexport function toLimits(object: Coordinates): Limits {\r\n\treturn {\r\n\t\tleft: object.left,\r\n\t\ttop: object.top,\r\n\t\tright: object.left + object.width,\r\n\t\tbottom: object.top + object.height,\r\n\t};\r\n}\r\n\r\nexport function diff(firstObject: Point, secondObject: Point): Diff {\r\n\treturn {\r\n\t\tleft: firstObject.left - secondObject.left,\r\n\t\ttop: firstObject.top - secondObject.top,\r\n\t};\r\n}\r\n\r\nexport function getCenter(object: Coordinates): Point {\r\n\treturn {\r\n\t\tleft: object.left + object.width / 2,\r\n\t\ttop: object.top + object.height / 2,\r\n\t};\r\n}\r\n\r\nexport function getIntersections(object: Coordinates, limits: Limits): Intersections {\r\n\tconst intersections: Intersections = {\r\n\t\tleft: 0,\r\n\t\ttop: 0,\r\n\t\tright: 0,\r\n\t\tbottom: 0,\r\n\t};\r\n\tALL_DIRECTIONS.forEach((direction) => {\r\n\t\tconst areaLimit = limits[direction];\r\n\t\tconst objectLimit = toLimits(object)[direction];\r\n\t\tif (areaLimit !== undefined && objectLimit !== undefined) {\r\n\t\t\tif (direction === 'left' || direction === 'top') {\r\n\t\t\t\tintersections[direction] = Math.max(0, areaLimit - objectLimit);\r\n\t\t\t} else {\r\n\t\t\t\tintersections[direction] = Math.max(0, objectLimit - areaLimit);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tintersections[direction] = 0;\r\n\t\t}\r\n\t});\r\n\treturn intersections;\r\n}\r\n\r\nexport function applyDirections(coordinates: Coordinates, directions: ResizeDirections): Coordinates {\r\n\treturn {\r\n\t\tleft: coordinates.left - directions.left,\r\n\t\ttop: coordinates.top - directions.top,\r\n\t\twidth: coordinates.width + directions.left + directions.right,\r\n\t\theight: coordinates.height + directions.top + directions.bottom,\r\n\t};\r\n}\r\n\r\nexport function inverseMove(directions: MoveDirections): MoveDirections {\r\n\treturn {\r\n\t\tleft: -directions.left,\r\n\t\ttop: -directions.top,\r\n\t};\r\n}\r\n\r\nexport function applyMove(object: Coordinates, move: MoveDirections): Coordinates {\r\n\treturn {\r\n\t\t...object,\r\n\t\tleft: object.left + move.left,\r\n\t\ttop: object.top + move.top,\r\n\t};\r\n}\r\n\r\nexport function applyScale(object: Coordinates, scaleFactor: number, center?: Point, progress?: number): Coordinates {\r\n\tif (scaleFactor !== 1) {\r\n\t\tif (center) {\r\n\t\t\tconst currentCenter = getCenter(object);\r\n\t\t\treturn {\r\n\t\t\t\twidth: object.width * scaleFactor,\r\n\t\t\t\theight: object.height * scaleFactor,\r\n\t\t\t\tleft:\r\n\t\t\t\t\tobject.left +\r\n\t\t\t\t\t(object.width * (1 - scaleFactor)) / 2 +\r\n\t\t\t\t\t(center.left - currentCenter.left) * (progress || 1 - scaleFactor),\r\n\t\t\t\ttop:\r\n\t\t\t\t\tobject.top +\r\n\t\t\t\t\t(object.height * (1 - scaleFactor)) / 2 +\r\n\t\t\t\t\t(center.top - currentCenter.top) * (progress || 1 - scaleFactor),\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\treturn {\r\n\t\t\t\twidth: object.width * scaleFactor,\r\n\t\t\t\theight: object.height * scaleFactor,\r\n\t\t\t\tleft: object.left + (object.width * (1 - scaleFactor)) / 2,\r\n\t\t\t\ttop: object.top + (object.height * (1 - scaleFactor)) / 2,\r\n\t\t\t};\r\n\t\t}\r\n\t} else {\r\n\t\treturn object;\r\n\t}\r\n}\r\n\r\nexport function ratio(object: Size): number {\r\n\treturn object.width / object.height;\r\n}\r\n\r\nexport function maxScale(object: Coordinates, area: Limits): number {\r\n\treturn Math.min(\r\n\t\tarea.right !== undefined && area.left !== undefined ? (area.right - area.left) / object.width : Infinity,\r\n\t\tarea.bottom !== undefined && area.top !== undefined ? (area.bottom - area.top) / object.height : Infinity,\r\n\t);\r\n}\r\n\r\n// Move object to correspond limits\r\nexport function fit(object: Coordinates, limits: Limits): MoveDirections {\r\n\tconst directions = {\r\n\t\tleft: 0,\r\n\t\ttop: 0,\r\n\t};\r\n\r\n\tconst intersection = getIntersections(object, limits);\r\n\r\n\tif (intersection.left && intersection.left > 0) {\r\n\t\tdirections.left = intersection.left;\r\n\t} else if (intersection.right && intersection.right > 0) {\r\n\t\tdirections.left = -intersection.right;\r\n\t}\r\n\tif (intersection.top && intersection.top > 0) {\r\n\t\tdirections.top = intersection.top;\r\n\t} else if (intersection.bottom && intersection.bottom > 0) {\r\n\t\tdirections.top = -intersection.bottom;\r\n\t}\r\n\r\n\treturn directions;\r\n}\r\n\r\nexport function getBrokenRatio(currentAspectRatio: number, aspectRatio: AspectRatio): number | undefined {\r\n\tlet ratioBroken;\r\n\tif (aspectRatio.minimum && currentAspectRatio < aspectRatio.minimum) {\r\n\t\tratioBroken = aspectRatio.minimum;\r\n\t} else if (aspectRatio.maximum && currentAspectRatio > aspectRatio.maximum) {\r\n\t\tratioBroken = aspectRatio.maximum;\r\n\t}\r\n\treturn ratioBroken;\r\n}\r\n\r\nexport function fitSize(firstSize: Size, secondSize: Size): Size {\r\n\tconst firstRatio = ratio(firstSize);\r\n\tconst secondRatio = ratio(secondSize);\r\n\r\n\tif (secondSize.width < Infinity && secondSize.height < Infinity) {\r\n\t\tif (firstRatio > secondRatio) {\r\n\t\t\treturn {\r\n\t\t\t\twidth: secondSize.width,\r\n\t\t\t\theight: secondSize.width / firstRatio,\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\treturn {\r\n\t\t\t\twidth: secondSize.height * firstRatio,\r\n\t\t\t\theight: secondSize.height,\r\n\t\t\t};\r\n\t\t}\r\n\t} else if (secondSize.width < Infinity) {\r\n\t\treturn {\r\n\t\t\twidth: secondSize.width,\r\n\t\t\theight: secondSize.width / firstRatio,\r\n\t\t};\r\n\t} else if (secondSize.height < Infinity) {\r\n\t\treturn {\r\n\t\t\twidth: secondSize.height * firstRatio,\r\n\t\t\theight: secondSize.height,\r\n\t\t};\r\n\t} else {\r\n\t\treturn firstSize;\r\n\t}\r\n}\r\n\r\nexport function rotateSize(size: Size, angle: number) {\r\n\tconst radians = (angle * Math.PI) / 180;\r\n\treturn {\r\n\t\twidth: Math.abs(size.width * Math.cos(radians)) + Math.abs(size.height * Math.sin(radians)),\r\n\t\theight: Math.abs(size.width * Math.sin(radians)) + Math.abs(size.height * Math.cos(radians)),\r\n\t};\r\n}\r\n\r\nexport function rotatePoint(point: Point, angle: number) {\r\n\tconst radians = (angle * Math.PI) / 180;\r\n\treturn {\r\n\t\tleft: point.left * Math.cos(radians) - point.top * Math.sin(radians),\r\n\t\ttop: point.left * Math.sin(radians) + point.top * Math.cos(radians),\r\n\t};\r\n}\r\n\r\nexport function adjustSize(coordinates: Coordinates, area: Limits) {\r\n\tconst intersections = getIntersections(fitToLimits(coordinates, area), area);\r\n\r\n\tif (intersections.left + intersections.right + intersections.top + intersections.bottom) {\r\n\t\tif (intersections.left + intersections.right > intersections.top + intersections.bottom) {\r\n\t\t\treturn Math.min(\r\n\t\t\t\t(coordinates.width + intersections.left + intersections.right) / coordinates.width,\r\n\t\t\t\tmaxScale(coordinates, area),\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\treturn Math.min(\r\n\t\t\t\t(coordinates.height + intersections.top + intersections.bottom) / coordinates.height,\r\n\t\t\t\tmaxScale(coordinates, area),\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\treturn 1;\r\n}\r\n\r\nexport function fitToLimits(coordinates: Coordinates, area: Limits, inverse = false) {\r\n\tconst move = fit(coordinates, area);\r\n\treturn applyMove(coordinates, inverse ? inverseMove(move) : move);\r\n}\r\n\r\nexport function limitsToSize(area: Limits) {\r\n\treturn {\r\n\t\twidth: area.right !== undefined && area.left !== undefined ? area.right - area.left : Infinity,\r\n\t\theight: area.bottom !== undefined && area.top !== undefined ? area.bottom - area.top : Infinity,\r\n\t};\r\n}\r\n\r\nexport function limitSizeRestrictions(sizeRestrictions: SizeRestrictions, object: Size) {\r\n\treturn {\r\n\t\t...sizeRestrictions,\r\n\t\tminWidth: Math.min(object.width, sizeRestrictions.minWidth),\r\n\t\tminHeight: Math.min(object.height, sizeRestrictions.minHeight),\r\n\t\tmaxWidth: Math.min(object.width, sizeRestrictions.maxWidth),\r\n\t\tmaxHeight: Math.min(object.height, sizeRestrictions.maxHeight),\r\n\t};\r\n}\r\n\r\nexport function joinLimits(a: Limits, b: Limits, intersection = true): Limits {\r\n\tconst limits: Limits = {};\r\n\tALL_DIRECTIONS.forEach((direction) => {\r\n\t\tconst firstDirection = a[direction];\r\n\t\tconst secondDirection = b[direction];\r\n\t\tif (firstDirection !== undefined && secondDirection !== undefined) {\r\n\t\t\tif (direction === 'left' || direction === 'top') {\r\n\t\t\t\tlimits[direction] = intersection\r\n\t\t\t\t\t? Math.max(firstDirection, secondDirection)\r\n\t\t\t\t\t: Math.min(firstDirection, secondDirection);\r\n\t\t\t} else {\r\n\t\t\t\tlimits[direction] = intersection\r\n\t\t\t\t\t? Math.min(firstDirection, secondDirection)\r\n\t\t\t\t\t: Math.max(firstDirection, secondDirection);\r\n\t\t\t}\r\n\t\t} else if (secondDirection !== undefined) {\r\n\t\t\tlimits[direction] = secondDirection;\r\n\t\t} else if (firstDirection !== undefined) {\r\n\t\t\tlimits[direction] = firstDirection;\r\n\t\t}\r\n\t});\r\n\treturn limits;\r\n}\r\n\r\nexport function unionLimits(a: Limits, b: Limits) {\r\n\treturn joinLimits(a, b, false);\r\n}\r\n\r\nexport function intersectionLimits(a: Limits, b: Limits) {\r\n\treturn joinLimits(a, b, true);\r\n}\r\n","// This function returns the approximation size to width / height with respect to\r\n// restrictions and aspect ratio\r\nimport { AspectRatio, Size, SizeRestrictions } from '../typings';\r\nimport { ratio } from '../service';\r\n\r\ninterface CandidateSize extends Size {\r\n\t// Additional param to prevent double precision problems\r\n\tcorrectRatio?: boolean;\r\n}\r\n\r\ninterface ValidateSizeParams {\r\n\tsize: CandidateSize;\r\n\taspectRatio: AspectRatio;\r\n\tsizeRestrictions: SizeRestrictions;\r\n\tignoreMinimum?: boolean;\r\n}\r\nfunction validateSize(params: ValidateSizeParams): boolean {\r\n\tconst { size, aspectRatio, ignoreMinimum, sizeRestrictions } = params;\r\n\treturn Boolean(\r\n\t\t(size.correctRatio || (ratio(size) >= aspectRatio.minimum && ratio(size) <= aspectRatio.maximum)) &&\r\n\t\t\tsize.height <= sizeRestrictions.maxHeight &&\r\n\t\t\tsize.width <= sizeRestrictions.maxWidth &&\r\n\t\t\tsize.width &&\r\n\t\t\tsize.height &&\r\n\t\t\t(ignoreMinimum || (size.height >= sizeRestrictions.minHeight && size.width >= sizeRestrictions.minWidth)),\r\n\t);\r\n}\r\n\r\nfunction distance(a: Size, b: Size): number {\r\n\treturn Math.pow(a.width - b.width, 2) + Math.pow(a.height - b.height, 2);\r\n}\r\n\r\n// Limitations:\r\n// 1. Assume that maximum width and height always larger than minimum width and height\r\n// 2. Assume that aspectRatio.minimum < aspectRatio.maximum\r\n// If you break this limitations function could return null!\r\ninterface ApproximatedSizeParams {\r\n\twidth: number;\r\n\theight: number;\r\n\tsizeRestrictions: SizeRestrictions;\r\n\taspectRatio?: AspectRatio;\r\n}\r\nexport function approximatedSize(params: ApproximatedSizeParams): Size {\r\n\tconst { width, height, sizeRestrictions } = params;\r\n\r\n\tconst aspectRatio = {\r\n\t\tminimum: (params.aspectRatio && params.aspectRatio.minimum) || 0,\r\n\t\tmaximum: (params.aspectRatio && params.aspectRatio.maximum) || Infinity,\r\n\t};\r\n\r\n\tconst coordinates = {\r\n\t\twidth: Math.max(sizeRestrictions.minWidth, Math.min(sizeRestrictions.maxWidth, width)),\r\n\t\theight: Math.max(sizeRestrictions.minHeight, Math.min(sizeRestrictions.maxHeight, height)),\r\n\t};\r\n\r\n\tfunction findBestCandidate(candidates: CandidateSize[], ignoreMinimum = false): CandidateSize | null {\r\n\t\treturn candidates.reduce<CandidateSize | null>((minimum: CandidateSize | null, size: CandidateSize) => {\r\n\t\t\tif (validateSize({ size, aspectRatio, sizeRestrictions, ignoreMinimum })) {\r\n\t\t\t\treturn !minimum || distance(size, { width, height }) < distance(minimum, { width, height })\r\n\t\t\t\t\t? size\r\n\t\t\t\t\t: minimum;\r\n\t\t\t} else {\r\n\t\t\t\treturn minimum;\r\n\t\t\t}\r\n\t\t}, null);\r\n\t}\r\n\r\n\tconst candidates: CandidateSize[] = [];\r\n\r\n\tif (aspectRatio) {\r\n\t\t[aspectRatio.minimum, aspectRatio.maximum].forEach((ratio) => {\r\n\t\t\tif (ratio) {\r\n\t\t\t\tcandidates.push(\r\n\t\t\t\t\t{ width: coordinates.width, height: coordinates.width / ratio, correctRatio: true },\r\n\t\t\t\t\t{ width: coordinates.height * ratio, height: coordinates.height, correctRatio: true },\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tif (validateSize({ size: coordinates, aspectRatio, sizeRestrictions })) {\r\n\t\tcandidates.push(coordinates);\r\n\t}\r\n\r\n\tconst candidate = findBestCandidate(candidates) || findBestCandidate(candidates, true);\r\n\r\n\treturn (\r\n\t\tcandidate && {\r\n\t\t\twidth: candidate.width,\r\n\t\t\theight: candidate.height,\r\n\t\t}\r\n\t);\r\n}\r\n","import { MoveEvent } from '../events';\r\nimport { Coordinates, PositionRestrictions } from '../typings';\r\nimport { applyMove, fit } from '../service';\r\n\r\nexport interface MoveParams {\r\n\tevent: MoveEvent;\r\n\tcoordinates: Coordinates;\r\n\tpositionRestrictions: PositionRestrictions;\r\n}\r\n\r\nexport function move(params: MoveParams): Coordinates {\r\n\tconst { event, coordinates, positionRestrictions = {} } = params;\r\n\r\n\tconst movedCoordinates = applyMove(coordinates, event.directions);\r\n\r\n\treturn applyMove(movedCoordinates, fit(movedCoordinates, positionRestrictions));\r\n}\r\n","import {\r\n\tAspectRatio,\r\n\tPositionRestrictions,\r\n\tSizeRestrictions,\r\n\tTransform,\r\n\tCoordinates,\r\n\tSize,\r\n\tVisibleArea,\r\n} from '../typings';\r\nimport { MoveEvent } from '../events';\r\nimport { approximatedSize } from './approximatedSize';\r\nimport { isUndefined } from '../utils';\r\nimport { move } from './move';\r\n\r\ninterface ApplyTransformParams {\r\n\tcoordinates: Coordinates;\r\n\ttransform: Transform | Transform[];\r\n\tsizeRestrictions: SizeRestrictions;\r\n\tpositionRestrictions: PositionRestrictions;\r\n\timageSize: Size;\r\n\tvisibleArea: VisibleArea;\r\n\taspectRatio?: AspectRatio;\r\n}\r\n\r\nexport function applyTransform(params: ApplyTransformParams) {\r\n\tconst {\r\n\t\tcoordinates: initialCoordinates,\r\n\t\ttransform,\r\n\t\timageSize,\r\n\t\tsizeRestrictions,\r\n\t\tpositionRestrictions,\r\n\t\taspectRatio,\r\n\t\tvisibleArea,\r\n\t} = params;\r\n\r\n\tconst moveAlgorithm = (prevCoordinates, newCoordinates) => {\r\n\t\treturn move({\r\n\t\t\tcoordinates: prevCoordinates,\r\n\t\t\tpositionRestrictions,\r\n\t\t\tevent: new MoveEvent({\r\n\t\t\t\tleft: newCoordinates.left - prevCoordinates.left,\r\n\t\t\t\ttop: newCoordinates.top - prevCoordinates.top,\r\n\t\t\t}),\r\n\t\t});\r\n\t};\r\n\r\n\tconst resizeAlgorithm = (prevCoordinates, newCoordinates) => {\r\n\t\tlet coordinates = {\r\n\t\t\t...prevCoordinates,\r\n\t\t\t...approximatedSize({\r\n\t\t\t\twidth: newCoordinates.width,\r\n\t\t\t\theight: newCoordinates.height,\r\n\t\t\t\tsizeRestrictions,\r\n\t\t\t\taspectRatio,\r\n\t\t\t}),\r\n\t\t\tleft: 0,\r\n\t\t\ttop: 0,\r\n\t\t};\r\n\r\n\t\treturn moveAlgorithm(coordinates, {\r\n\t\t\tleft: prevCoordinates.left,\r\n\t\t\ttop: prevCoordinates.top,\r\n\t\t});\r\n\t};\r\n\r\n\tlet coordinates = { ...initialCoordinates };\r\n\r\n\tconst transforms = Array.isArray(transform) ? transform : [transform];\r\n\r\n\ttransforms.forEach((transform) => {\r\n\t\tlet changes: Partial<Coordinates> = {};\r\n\t\tif (typeof transform === 'function') {\r\n\t\t\tchanges = transform({ coordinates, imageSize, visibleArea });\r\n\t\t} else {\r\n\t\t\tchanges = transform;\r\n\t\t}\r\n\r\n\t\tif (!isUndefined(changes.width) || !isUndefined(changes.height)) {\r\n\t\t\tcoordinates = resizeAlgorithm(coordinates, { ...coordinates, ...changes });\r\n\t\t}\r\n\t\tif (!isUndefined(changes.left) || !isUndefined(changes.top)) {\r\n\t\t\tcoordinates = moveAlgorithm(coordinates, { ...coordinates, ...changes });\r\n\t\t}\r\n\t});\r\n\r\n\treturn coordinates;\r\n}\r\n","import {\r\n\tadjustSize,\r\n\tapplyMove,\r\n\tapplyScale,\r\n\tdiff,\r\n\tfit,\r\n\tfitToLimits,\r\n\tgetCenter,\r\n\tintersectionLimits,\r\n\tinverseMove,\r\n\tmaxScale,\r\n\tratio,\r\n\ttoLimits,\r\n} from '../service';\r\nimport {\r\n\tAspectRatio,\r\n\tBoundaries,\r\n\tCoordinates,\r\n\tCropperEvent,\r\n\tGetAreaRestrictions,\r\n\tPositionRestrictions,\r\n\tSize,\r\n\tSizeRestrictions,\r\n\tVisibleArea,\r\n} from '../typings';\r\nimport { isApproximatelyEqual } from '../utils';\r\nimport { approximatedSize } from './approximatedSize';\r\nimport { ALL_DIRECTIONS } from '../constants';\r\n\r\ninterface AutoZoomResult {\r\n\tvisibleArea: VisibleArea;\r\n\tcoordinates: Coordinates;\r\n}\r\n\r\ninterface AutoZoomParams {\r\n\tevent: CropperEvent;\r\n\tcoordinates: Coordinates;\r\n\tstencilReference: Coordinates;\r\n\tvisibleArea: VisibleArea;\r\n\tboundaries: Boundaries;\r\n\taspectRatio: AspectRatio;\r\n\tstencilSize: Size;\r\n\tsizeRestrictions: SizeRestrictions;\r\n\tpositionRestrictions: PositionRestrictions;\r\n\tgetAreaRestrictions: GetAreaRestrictions;\r\n}\r\n\r\nexport function fixedStencilAutoZoom(params: AutoZoomParams): AutoZoomResult {\r\n\tconst {\r\n\t\tevent,\r\n\t\tgetAreaRestrictions,\r\n\t\tboundaries,\r\n\t\tcoordinates: originalCoordinates,\r\n\t\tvisibleArea: originalVisibleArea,\r\n\t\taspectRatio,\r\n\t\tstencilSize,\r\n\t\tsizeRestrictions,\r\n\t\tpositionRestrictions,\r\n\t\tstencilReference,\r\n\t} = params;\r\n\r\n\tlet coordinates = { ...originalCoordinates };\r\n\tlet visibleArea = { ...originalVisibleArea };\r\n\r\n\t// Checks that coordinates has the same ratio that coordinates:\r\n\tlet stencil = { ...stencilSize };\r\n\r\n\tif (!isApproximatelyEqual(ratio(stencil), ratio(coordinates))) {\r\n\t\tif (process.env.NODE_ENV !== 'production') {\r\n\t\t\tconsole.error(\r\n\t\t\t\t`[Adjusting stencil] The aspect ratio of coordinates is not equal to the aspect ratio of stencil (${ratio(\r\n\t\t\t\t\tcoordinates,\r\n\t\t\t\t)} != ${ratio(stencil)})! Coordinates will be changed`,\r\n\t\t\t);\r\n\t\t}\r\n\t\tcoordinates = {\r\n\t\t\t...coordinates,\r\n\t\t\t...approximatedSize({\r\n\t\t\t\tsizeRestrictions,\r\n\t\t\t\twidth: coordinates.width,\r\n\t\t\t\theight: coordinates.height,\r\n\t\t\t\taspectRatio: {\r\n\t\t\t\t\tminimum: ratio(stencil),\r\n\t\t\t\t\tmaximum: ratio(stencil),\r\n\t\t\t\t},\r\n\t\t\t}),\r\n\t\t};\r\n\t}\r\n\r\n\t// First of all try to resize visible area as much as possible:\r\n\tvisibleArea = applyScale(visibleArea, (coordinates.width * boundaries.width) / (visibleArea.width * stencil.width));\r\n\r\n\t// Check that visible area doesn't break the area restrictions:\r\n\tconst scale = adjustSize(visibleArea, getAreaRestrictions({ visibleArea, type: 'resize' }));\r\n\tif (scale !== 1) {\r\n\t\tvisibleArea = applyScale(visibleArea, scale);\r\n\t\tcoordinates = applyScale(coordinates, scale);\r\n\t}\r\n\r\n\tvisibleArea = applyMove(visibleArea, diff(getCenter(coordinates), getCenter(visibleArea)));\r\n\r\n\t// Center stencil in visible area:\r\n\tvisibleArea = fitToLimits(visibleArea, getAreaRestrictions({ visibleArea, type: 'move' }));\r\n\tcoordinates = fitToLimits(coordinates, intersectionLimits(toLimits(visibleArea), positionRestrictions));\r\n\r\n\treturn {\r\n\t\tcoordinates,\r\n\t\tvisibleArea,\r\n\t};\r\n}\r\n\r\nexport function hybridStencilAutoZoom(params: AutoZoomParams): AutoZoomResult {\r\n\tconst {\r\n\t\tevent,\r\n\t\tgetAreaRestrictions,\r\n\t\tboundaries,\r\n\t\tcoordinates: originalCoordinates,\r\n\t\tvisibleArea: originalVisibleArea,\r\n\t\taspectRatio,\r\n\t\tstencilSize,\r\n\t\tsizeRestrictions,\r\n\t\tpositionRestrictions,\r\n\t\tstencilReference,\r\n\t} = params;\r\n\r\n\tlet coordinates = { ...originalCoordinates };\r\n\tlet visibleArea = { ...originalVisibleArea };\r\n\r\n\tif (originalCoordinates && originalVisibleArea && event.type !== 'manipulateImage') {\r\n\t\t// Checks that coordinates has the same ratio that coordinates:\r\n\t\tlet stencil: Size = {\r\n\t\t\twidth: 0,\r\n\t\t\theight: 0,\r\n\t\t};\r\n\r\n\t\tconst coefficient = visibleArea.width / boundaries.width;\r\n\r\n\t\tif (ratio(boundaries) > ratio(coordinates)) {\r\n\t\t\tstencil.height = boundaries.height * 0.8;\r\n\t\t\tstencil.width = stencil.height * ratio(coordinates);\r\n\t\t} else {\r\n\t\t\tstencil.width = boundaries.width * 0.8;\r\n\t\t\tstencil.height = stencil.width * ratio(coordinates);\r\n\t\t}\r\n\r\n\t\t// First of all try to resize visible area as much as possible:\r\n\t\tvisibleArea = applyScale(\r\n\t\t\tvisibleArea,\r\n\t\t\t(coordinates.width * boundaries.width) / (visibleArea.width * stencil.width),\r\n\t\t);\r\n\r\n\t\t// Check that visible area doesn't break the area restrictions:\r\n\t\tconst scale = adjustSize(visibleArea, getAreaRestrictions({ visibleArea, type: 'resize' }));\r\n\t\tvisibleArea = applyScale(visibleArea, scale);\r\n\r\n\t\tif (scale !== 1) {\r\n\t\t\tstencil.height /= scale;\r\n\t\t\tstencil.width /= scale;\r\n\t\t}\r\n\r\n\t\tvisibleArea = applyMove(visibleArea, diff(getCenter(coordinates), getCenter(visibleArea)));\r\n\r\n\t\t// Center stencil in visible area:\r\n\t\tvisibleArea = fitToLimits(visibleArea, getAreaRestrictions({ visibleArea, type: 'move' }));\r\n\t\tcoordinates = fitToLimits(coordinates, intersectionLimits(toLimits(visibleArea), positionRestrictions));\r\n\t}\r\n\r\n\treturn {\r\n\t\tcoordinates,\r\n\t\tvisibleArea,\r\n\t};\r\n}\r\n\r\n// The main point of this feature is calculating the needed position of stencil and parameters of world transforms\r\n// Real coordinates don't changes here\r\ninterface SimplestAutoZoomParams {\r\n\tevent: CropperEvent;\r\n\tcoordinates: Coordinates;\r\n\tvisibleArea: VisibleArea;\r\n\tgetAreaRestrictions: GetAreaRestrictions;\r\n}\r\nexport function simplestAutoZoom(params: SimplestAutoZoomParams): AutoZoomResult {\r\n\tconst { event, coordinates: originalCoordinates, visibleArea: originalVisibleArea, getAreaRestrictions } = params;\r\n\r\n\tlet visibleArea = { ...originalVisibleArea };\r\n\tconst coordinates = { ...originalCoordinates };\r\n\r\n\tif (event.type === 'setCoordinates') {\r\n\t\tconst widthIntersections = Math.max(0, coordinates.width - visibleArea.width);\r\n\t\tconst heightIntersections = Math.max(0, coordinates.height - visibleArea.height);\r\n\r\n\t\tif (widthIntersections > heightIntersections) {\r\n\t\t\tvisibleArea = applyScale(\r\n\t\t\t\tvisibleArea,\r\n\t\t\t\tMath.min(\r\n\t\t\t\t\tcoordinates.width / visibleArea.width,\r\n\t\t\t\t\tmaxScale(visibleArea, getAreaRestrictions({ visibleArea, type: 'resize' })),\r\n\t\t\t\t),\r\n\t\t\t);\r\n\t\t} else if (heightIntersections > widthIntersections) {\r\n\t\t\tvisibleArea = applyScale(\r\n\t\t\t\tvisibleArea,\r\n\t\t\t\tMath.min(\r\n\t\t\t\t\tcoordinates.height / visibleArea.height,\r\n\t\t\t\t\tmaxScale(visibleArea, getAreaRestrictions({ visibleArea, type: 'resize' })),\r\n\t\t\t\t),\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tvisibleArea = applyMove(visibleArea, inverseMove(fit(coordinates, toLimits(visibleArea))));\r\n\r\n\t\tvisibleArea = fitToLimits(visibleArea, getAreaRestrictions({ visibleArea, type: 'move' }));\r\n\t}\r\n\treturn {\r\n\t\tvisibleArea,\r\n\t\tcoordinates,\r\n\t};\r\n}\r\n","import { ImageSize, Point, Size, VisibleArea } from '../typings';\r\n\r\nexport interface DefaultPositionParams {\r\n\tcoordinates: Size;\r\n\timageSize?: ImageSize;\r\n\tvisibleArea?: VisibleArea;\r\n}\r\nexport function defaultPosition({ imageSize, visibleArea, coordinates }: DefaultPositionParams): Point {\r\n\tconst area = visibleArea || imageSize;\r\n\r\n\treturn {\r\n\t\tleft: (visibleArea ? visibleArea.left : 0) + area.width / 2 - coordinates.width / 2,\r\n\t\ttop: (visibleArea ? visibleArea.top : 0) + area.height / 2 - coordinates.height / 2,\r\n\t};\r\n}\r\n","import {\r\n\tAspectRatio,\r\n\tBoundaries,\r\n\tFalsy,\r\n\tImageSize,\r\n\tSize,\r\n\tSizeRestrictions,\r\n\tStencilSize,\r\n\tVisibleArea,\r\n} from '../typings';\r\nimport { approximatedSize } from './approximatedSize';\r\nimport { ratio } from '../service';\r\nimport { isNumber } from '../utils';\r\n\r\ninterface DefaultSizeBasicParams {\r\n\taspectRatio: AspectRatio;\r\n\tboundaries: Boundaries;\r\n\tsizeRestrictions: SizeRestrictions;\r\n}\r\n\r\ninterface ImageDefaultSizeParams extends DefaultSizeBasicParams {\r\n\timageSize: ImageSize;\r\n\tvisibleArea?: VisibleArea | Falsy;\r\n}\r\n\r\ninterface VisibleAreaDefaultSizeParams extends DefaultSizeBasicParams {\r\n\timageSize?: ImageSize | Falsy;\r\n\tvisibleArea: VisibleArea;\r\n}\r\n\r\nexport type DefaultSizeParams = VisibleAreaDefaultSizeParams | ImageDefaultSizeParams;\r\n\r\nexport function defaultSize(params: DefaultSizeParams): Size {\r\n\tconst { imageSize, visibleArea, aspectRatio, sizeRestrictions } = params;\r\n\r\n\tconst area = (visibleArea || imageSize) as Size;\r\n\r\n\tconst optimalRatio = Math.min(aspectRatio.maximum || Infinity, Math.max(aspectRatio.minimum || 0, ratio(area)));\r\n\r\n\tconst size =\r\n\t\tarea.width < area.height\r\n\t\t\t? {\r\n\t\t\t\t\twidth: area.width * 0.8,\r\n\t\t\t\t\theight: (area.width * 0.8) / optimalRatio,\r\n\t\t\t  }\r\n\t\t\t: {\r\n\t\t\t\t\theight: area.height * 0.8,\r\n\t\t\t\t\twidth: area.height * 0.8 * optimalRatio,\r\n\t\t\t  };\r\n\r\n\treturn approximatedSize({\r\n\t\t...size,\r\n\t\taspectRatio,\r\n\t\tsizeRestrictions: sizeRestrictions,\r\n\t});\r\n}\r\n\r\nexport type FixedDefaultSizeParams = DefaultSizeParams & { stencilSize: Size };\r\n\r\nexport function fixedDefaultSize(params: FixedDefaultSizeParams): Size {\r\n\tconst { imageSize, visibleArea, boundaries, aspectRatio, sizeRestrictions, stencilSize } = params;\r\n\r\n\tconst area = (visibleArea || imageSize) as Size;\r\n\r\n\tlet height, width;\r\n\tif (ratio(area) > ratio(boundaries)) {\r\n\t\theight = (stencilSize.height * area.height) / boundaries.height;\r\n\t\twidth = height * ratio(stencilSize);\r\n\t} else {\r\n\t\twidth = (stencilSize.width * area.width) / boundaries.width;\r\n\t\theight = width / ratio(stencilSize);\r\n\t}\r\n\r\n\treturn approximatedSize({\r\n\t\twidth,\r\n\t\theight,\r\n\t\taspectRatio,\r\n\t\tsizeRestrictions: sizeRestrictions,\r\n\t});\r\n}\r\n","import { Size, VisibleArea, Coordinates, GetAreaRestrictions, Limits, Falsy } from '../typings';\r\nimport { ratio, toLimits, intersectionLimits, fitToLimits, getIntersections, fitSize, limitsToSize } from '../service';\r\n\r\nexport interface DefaultVisibleAreaParams {\r\n\timageSize: Size;\r\n\tboundaries: Size;\r\n\tcoordinates?: Coordinates | Falsy;\r\n\tgetAreaRestrictions: GetAreaRestrictions;\r\n}\r\nexport function defaultVisibleArea(params: DefaultVisibleAreaParams): VisibleArea {\r\n\tconst { getAreaRestrictions, coordinates, imageSize, boundaries } = params;\r\n\r\n\tconst boundaryRatio = ratio(boundaries);\r\n\r\n\tif (coordinates) {\r\n\t\t// Visible area will try to fit reference:\r\n\t\tconst reference = {\r\n\t\t\theight: Math.max(coordinates.height, imageSize.height),\r\n\t\t\twidth: Math.max(coordinates.width, imageSize.width),\r\n\t\t};\r\n\r\n\t\tconst areaProperties = fitSize(\r\n\t\t\t{\r\n\t\t\t\twidth: ratio(reference) > boundaryRatio ? reference.width : reference.height * boundaryRatio,\r\n\t\t\t\theight: ratio(reference) > boundaryRatio ? reference.width / boundaryRatio : reference.height,\r\n\t\t\t},\r\n\t\t\tlimitsToSize(getAreaRestrictions()),\r\n\t\t);\r\n\r\n\t\t// Visible area will try to center stencil:\r\n\t\tconst visibleArea = {\r\n\t\t\tleft: coordinates.left + coordinates.width / 2 - areaProperties.width / 2,\r\n\t\t\ttop: coordinates.top + coordinates.height / 2 - areaProperties.height / 2,\r\n\t\t\twidth: areaProperties.width,\r\n\t\t\theight: areaProperties.height,\r\n\t\t};\r\n\r\n\t\t// TODO: Controversial behavior:\r\n\t\t// If the coordinates are beyond image visible area will be allowed to be beyond image alike:\r\n\t\tconst coordinatesIntersection = getIntersections(\r\n\t\t\tcoordinates,\r\n\t\t\ttoLimits({\r\n\t\t\t\tleft: 0,\r\n\t\t\t\ttop: 0,\r\n\t\t\t\t...imageSize,\r\n\t\t\t}),\r\n\t\t);\r\n\r\n\t\tconst limits: Limits = {};\r\n\r\n\t\tif (!coordinatesIntersection.left && !coordinatesIntersection.right && visibleArea.width <= imageSize.width) {\r\n\t\t\tlimits.left = 0;\r\n\t\t\tlimits.right = imageSize.width;\r\n\t\t}\r\n\r\n\t\tif (!coordinatesIntersection.top && !coordinatesIntersection.bottom && visibleArea.height <= imageSize.height) {\r\n\t\t\tlimits.top = 0;\r\n\t\t\tlimits.bottom = imageSize.height;\r\n\t\t}\r\n\r\n\t\treturn fitToLimits(visibleArea, limits);\r\n\t} else {\r\n\t\tconst imageRatio = ratio(imageSize);\r\n\r\n\t\tconst areaProperties = {\r\n\t\t\theight: imageRatio > boundaryRatio ? imageSize.height : imageSize.width / boundaryRatio,\r\n\t\t\twidth: imageRatio > boundaryRatio ? imageSize.height * boundaryRatio : imageSize.width,\r\n\t\t};\r\n\r\n\t\treturn {\r\n\t\t\tleft: imageSize.width / 2 - areaProperties.width / 2,\r\n\t\t\ttop: imageSize.height / 2 - areaProperties.height / 2,\r\n\t\t\twidth: areaProperties.width,\r\n\t\t\theight: areaProperties.height,\r\n\t\t};\r\n\t}\r\n}\r\n","import { Coordinates, Limits } from '../typings';\r\nimport { joinLimits } from '../service';\r\nimport { toLimits } from '../service';\r\n\r\nexport function limitBy(limits: Limits, object: Coordinates): Limits {\r\n\treturn joinLimits(limits, toLimits(object));\r\n}\r\n","import { ManipulateImageEvent } from '../events';\r\nimport { GetAreaRestrictions, Coordinates, PositionRestrictions, SizeRestrictions, VisibleArea } from '../typings';\r\nimport {\r\n\tapplyMove,\r\n\tapplyScale,\r\n\tfit,\r\n\tfitToLimits,\r\n\tgetCenter,\r\n\tintersectionLimits,\r\n\tinverseMove,\r\n\tmaxScale,\r\n\ttoLimits,\r\n} from '../service';\r\n\r\ninterface ManipulateImageParams {\r\n\tevent: ManipulateImageEvent;\r\n\tcoordinates: Coordinates;\r\n\tvisibleArea: VisibleArea;\r\n\tsizeRestrictions: SizeRestrictions;\r\n\tpositionRestrictions: PositionRestrictions;\r\n\tgetAreaRestrictions: GetAreaRestrictions;\r\n\tadjustStencil: boolean;\r\n}\r\ninterface ManipulateImageResult {\r\n\tvisibleArea: VisibleArea;\r\n\tcoordinates: Coordinates;\r\n}\r\nexport function manipulateImage(params: ManipulateImageParams): ManipulateImageResult {\r\n\tconst {\r\n\t\tevent,\r\n\t\tcoordinates: originalCoordinates,\r\n\t\tvisibleArea: originalVisibleArea,\r\n\t\tsizeRestrictions,\r\n\t\tgetAreaRestrictions,\r\n\t\tpositionRestrictions,\r\n\t\tadjustStencil,\r\n\t} = params;\r\n\r\n\tconst { scale, move } = event;\r\n\r\n\tlet visibleArea = { ...originalVisibleArea };\r\n\tlet coordinates = { ...originalCoordinates };\r\n\r\n\tlet areaScale = 1;\r\n\tlet stencilScale = 1;\r\n\tconst allowedScale = scale.factor && Math.abs(scale.factor - 1) > 1e-3;\r\n\r\n\tvisibleArea = applyMove(visibleArea, {\r\n\t\tleft: move.left || 0,\r\n\t\ttop: move.top || 0,\r\n\t});\r\n\r\n\tconst scaleRestrictions = {\r\n\t\tstencil: {\r\n\t\t\tminimum: Math.max(\r\n\t\t\t\tsizeRestrictions.minWidth ? sizeRestrictions.minWidth / coordinates.width : 0,\r\n\t\t\t\tsizeRestrictions.minHeight ? sizeRestrictions.minHeight / coordinates.height : 0,\r\n\t\t\t),\r\n\t\t\tmaximum: Math.min(\r\n\t\t\t\tsizeRestrictions.maxWidth ? sizeRestrictions.maxWidth / coordinates.width : Infinity,\r\n\t\t\t\tsizeRestrictions.maxHeight ? sizeRestrictions.maxHeight / coordinates.height : Infinity,\r\n\t\t\t\tmaxScale(coordinates, positionRestrictions),\r\n\t\t\t),\r\n\t\t},\r\n\t\tarea: {\r\n\t\t\tmaximum: maxScale(visibleArea, getAreaRestrictions({ visibleArea, type: 'resize' })),\r\n\t\t},\r\n\t};\r\n\r\n\t// If there is scaling then begin scale\r\n\tif (scale.factor && allowedScale) {\r\n\t\t// Determine scale factor\r\n\t\tif (scale.factor < 1) {\r\n\t\t\tstencilScale = Math.max(scale.factor, scaleRestrictions.stencil.minimum);\r\n\t\t\tif (stencilScale > 1) {\r\n\t\t\t\tstencilScale = 1;\r\n\t\t\t}\r\n\t\t} else if (scale.factor > 1) {\r\n\t\t\tstencilScale = Math.min(\r\n\t\t\t\tscale.factor,\r\n\t\t\t\tMath.min(scaleRestrictions.area.maximum, scaleRestrictions.stencil.maximum),\r\n\t\t\t);\r\n\t\t\tif (stencilScale < 1) {\r\n\t\t\t\tstencilScale = 1;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (stencilScale) {\r\n\t\t// Resize stencil with area as much is possible\r\n\t\tvisibleArea = applyScale(visibleArea, stencilScale, scale.center);\r\n\t}\r\n\r\n\tconst relativeCoordinates = {\r\n\t\tleft: originalCoordinates.left - originalVisibleArea.left,\r\n\t\tright:\r\n\t\t\toriginalVisibleArea.width +\r\n\t\t\toriginalVisibleArea.left -\r\n\t\t\t(originalCoordinates.width + originalCoordinates.left),\r\n\t\ttop: originalCoordinates.top - originalVisibleArea.top,\r\n\t\tbottom:\r\n\t\t\toriginalVisibleArea.height +\r\n\t\t\toriginalVisibleArea.top -\r\n\t\t\t(originalCoordinates.height + originalCoordinates.top),\r\n\t};\r\n\r\n\t// Move the area to fit to coordinates limits:\r\n\tvisibleArea = applyMove(\r\n\t\tvisibleArea,\r\n\t\tfit(visibleArea, {\r\n\t\t\tleft:\r\n\t\t\t\tpositionRestrictions.left !== undefined\r\n\t\t\t\t\t? positionRestrictions.left - relativeCoordinates.left * stencilScale\r\n\t\t\t\t\t: undefined,\r\n\t\t\ttop:\r\n\t\t\t\tpositionRestrictions.top !== undefined\r\n\t\t\t\t\t? positionRestrictions.top - relativeCoordinates.top * stencilScale\r\n\t\t\t\t\t: undefined,\r\n\t\t\tbottom:\r\n\t\t\t\tpositionRestrictions.bottom !== undefined\r\n\t\t\t\t\t? positionRestrictions.bottom + relativeCoordinates.bottom * stencilScale\r\n\t\t\t\t\t: undefined,\r\n\t\t\tright:\r\n\t\t\t\tpositionRestrictions.right !== undefined\r\n\t\t\t\t\t? positionRestrictions.right + relativeCoordinates.right * stencilScale\r\n\t\t\t\t\t: undefined,\r\n\t\t}),\r\n\t);\r\n\r\n\t// But the more important to fit are to the area restrictions, so we should fit it to that restrictions:\r\n\tvisibleArea = fitToLimits(visibleArea, getAreaRestrictions({ visibleArea, type: 'move' }));\r\n\r\n\t// Set the same coordinates of stencil inside visible area\r\n\tcoordinates.width = coordinates.width * stencilScale;\r\n\tcoordinates.height = coordinates.height * stencilScale;\r\n\tcoordinates.left = visibleArea.left + relativeCoordinates.left * stencilScale;\r\n\tcoordinates.top = visibleArea.top + relativeCoordinates.top * stencilScale;\r\n\r\n\t// Move the coordinates to prevent the intersection with visible area and position restrictions\r\n\tcoordinates = fitToLimits(coordinates, intersectionLimits(toLimits(visibleArea), positionRestrictions));\r\n\r\n\t// Resize only area if stencil can't be resized and stencil resize is disabled\r\n\tif (scale.factor && allowedScale && adjustStencil) {\r\n\t\tif (scale.factor > 1) {\r\n\t\t\tareaScale = Math.min(scaleRestrictions.area.maximum, scale.factor) / stencilScale;\r\n\t\t} else if (scale.factor < 1) {\r\n\t\t\tareaScale = Math.max(\r\n\t\t\t\tcoordinates.height / visibleArea.height,\r\n\t\t\t\tcoordinates.width / visibleArea.width,\r\n\t\t\t\tscale.factor / stencilScale,\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (areaScale !== 1) {\r\n\t\t\tvisibleArea = applyScale(visibleArea, areaScale, scale.factor > 1 ? scale.center : getCenter(coordinates));\r\n\r\n\t\t\t// Move to prevent the breaking of the area restrictions:\r\n\t\t\tvisibleArea = fitToLimits(visibleArea, getAreaRestrictions({ visibleArea, type: 'move' }));\r\n\r\n\t\t\t// Move to prevent the intersection with coordinates:\r\n\t\t\tvisibleArea = applyMove(visibleArea, inverseMove(fit(coordinates, toLimits(visibleArea))));\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\tcoordinates,\r\n\t\tvisibleArea,\r\n\t};\r\n}\r\n","import {\r\n\tAspectRatio,\r\n\tBoundaries,\r\n\tCoordinates,\r\n\tCropperEvent,\r\n\tGetAreaRestrictions,\r\n\tImageSize,\r\n\tPositionRestrictions,\r\n\tSize,\r\n\tSizeRestrictions,\r\n\tVisibleArea,\r\n} from '../typings';\r\nimport { isApproximatelyEqual, sign } from '../utils';\r\nimport {\r\n\tadjustSize,\r\n\tapplyMove,\r\n\tapplyScale,\r\n\tdiff,\r\n\tfitSize,\r\n\tfitToLimits,\r\n\tgetCenter,\r\n\tintersectionLimits,\r\n\tratio,\r\n\trotatePoint,\r\n\trotateSize,\r\n\ttoLimits,\r\n} from '../service';\r\nimport { approximatedSize } from './approximatedSize';\r\n\r\ninterface RotateImageParams {\r\n\taspectRatio: AspectRatio;\r\n\tcoordinates: Coordinates;\r\n\tvisibleArea: VisibleArea;\r\n\tsizeRestrictions: SizeRestrictions;\r\n\tpositionRestrictions: PositionRestrictions;\r\n\tgetAreaRestrictions: GetAreaRestrictions;\r\n\timageSize: ImageSize;\r\n\tpreviousImageSize: ImageSize;\r\n\tangle: number;\r\n}\r\n\r\ninterface RotateImageResult {\r\n\tvisibleArea: VisibleArea;\r\n\tcoordinates: Coordinates;\r\n}\r\n\r\nexport function rotateImage(params: RotateImageParams): RotateImageResult {\r\n\tconst {\r\n\t\taspectRatio,\r\n\t\tgetAreaRestrictions,\r\n\t\tcoordinates: originalCoordinates,\r\n\t\tvisibleArea: originalVisibleArea,\r\n\t\tsizeRestrictions,\r\n\t\tpositionRestrictions,\r\n\t\timageSize,\r\n\t\tpreviousImageSize,\r\n\t\tangle,\r\n\t} = params;\r\n\r\n\tlet coordinates = { ...originalCoordinates };\r\n\tlet visibleArea = { ...originalVisibleArea };\r\n\r\n\tconst imageCenter = rotatePoint(\r\n\t\tgetCenter({\r\n\t\t\tleft: 0,\r\n\t\t\ttop: 0,\r\n\t\t\t...previousImageSize,\r\n\t\t}),\r\n\t\tangle,\r\n\t);\r\n\r\n\tcoordinates = {\r\n\t\t...approximatedSize({\r\n\t\t\tsizeRestrictions,\r\n\t\t\taspectRatio,\r\n\t\t\twidth: coordinates.width,\r\n\t\t\theight: coordinates.height,\r\n\t\t}),\r\n\t\t...rotatePoint(getCenter(coordinates), angle),\r\n\t};\r\n\r\n\tcoordinates.left -= imageCenter.left - imageSize.width / 2 + coordinates.width / 2;\r\n\tcoordinates.top -= imageCenter.top - imageSize.height / 2 + coordinates.height / 2;\r\n\r\n\t// Check that visible area doesn't break the area restrictions:\r\n\tvisibleArea = applyScale(\r\n\t\tvisibleArea,\r\n\t\tadjustSize(visibleArea, getAreaRestrictions({ visibleArea, type: 'resize' })),\r\n\t);\r\n\r\n\tcoordinates = fitToLimits(coordinates, positionRestrictions);\r\n\r\n\tvisibleArea = applyMove(visibleArea, diff(getCenter(coordinates), getCenter(originalCoordinates)));\r\n\r\n\tvisibleArea = fitToLimits(visibleArea, getAreaRestrictions({ visibleArea, type: 'move' }));\r\n\r\n\treturn {\r\n\t\tcoordinates,\r\n\t\tvisibleArea,\r\n\t};\r\n}\r\n","import {\r\n\tAspectRatio,\r\n\tBoundaries,\r\n\tCoordinates,\r\n\tCropperEvent,\r\n\tGetAreaRestrictions,\r\n\tImageSize,\r\n\tPositionRestrictions,\r\n\tSize,\r\n\tSizeRestrictions,\r\n\tVisibleArea,\r\n} from '../typings';\r\nimport { isApproximatelyEqual, sign } from '../utils';\r\nimport {\r\n\tadjustSize,\r\n\tapplyMove,\r\n\tapplyScale,\r\n\tdiff,\r\n\tfitSize,\r\n\tfitToLimits,\r\n\tgetCenter,\r\n\tintersectionLimits,\r\n\tratio,\r\n\trotatePoint,\r\n\trotateSize,\r\n\ttoLimits,\r\n} from '../service';\r\nimport { approximatedSize } from './approximatedSize';\r\n\r\ninterface Reflect {\r\n\thorizontal: boolean;\r\n\tvertical: boolean;\r\n}\r\n\r\ninterface FlipImageParams {\r\n\taspectRatio: AspectRatio;\r\n\tcoordinates: Coordinates;\r\n\tvisibleArea: VisibleArea;\r\n\tgetAreaRestrictions: GetAreaRestrictions;\r\n\timageSize: ImageSize;\r\n\tpreviousFlip: Reflect;\r\n\tflip: Reflect;\r\n\trotate: number;\r\n}\r\n\r\ninterface FlipImageResult {\r\n\tvisibleArea: VisibleArea;\r\n\tcoordinates: Coordinates;\r\n}\r\n\r\nexport function flipImage(params: FlipImageParams): FlipImageResult {\r\n\tconst {\r\n\t\tflip,\r\n\t\tpreviousFlip,\r\n\t\trotate,\r\n\t\taspectRatio,\r\n\t\tgetAreaRestrictions,\r\n\t\tcoordinates: originalCoordinates,\r\n\t\tvisibleArea: originalVisibleArea,\r\n\t\timageSize,\r\n\t} = params;\r\n\r\n\tlet coordinates = { ...originalCoordinates };\r\n\tlet visibleArea = { ...originalVisibleArea };\r\n\r\n\tconst changed = {\r\n\t\thorizontal: previousFlip.horizontal !== flip.horizontal,\r\n\t\tvertical: previousFlip.vertical !== flip.vertical,\r\n\t};\r\n\r\n\tif (changed.horizontal || changed.vertical) {\r\n\t\tconst imageCenter = rotatePoint(\r\n\t\t\t{\r\n\t\t\t\tleft: imageSize.width / 2,\r\n\t\t\t\ttop: imageSize.height / 2,\r\n\t\t\t},\r\n\t\t\t-rotate,\r\n\t\t);\r\n\r\n\t\tlet oldCenter = rotatePoint(getCenter(coordinates), -rotate);\r\n\t\tlet newCenter = rotatePoint(\r\n\t\t\t{\r\n\t\t\t\tleft: changed.horizontal ? imageCenter.left - (oldCenter.left - imageCenter.left) : oldCenter.left,\r\n\t\t\t\ttop: changed.vertical ? imageCenter.top - (oldCenter.top - imageCenter.top) : oldCenter.top,\r\n\t\t\t},\r\n\t\t\trotate,\r\n\t\t);\r\n\t\tcoordinates = applyMove(coordinates, diff(newCenter, getCenter(coordinates)));\r\n\r\n\t\toldCenter = rotatePoint(getCenter(visibleArea), -rotate);\r\n\t\tnewCenter = rotatePoint(\r\n\t\t\t{\r\n\t\t\t\tleft: changed.horizontal ? imageCenter.left - (oldCenter.left - imageCenter.left) : oldCenter.left,\r\n\t\t\t\ttop: changed.vertical ? imageCenter.top - (oldCenter.top - imageCenter.top) : oldCenter.top,\r\n\t\t\t},\r\n\t\t\trotate,\r\n\t\t);\r\n\t\tvisibleArea = applyMove(visibleArea, diff(newCenter, getCenter(visibleArea)));\r\n\r\n\t\tvisibleArea = fitToLimits(visibleArea, getAreaRestrictions({ visibleArea, type: 'move' }));\r\n\t}\r\n\r\n\treturn {\r\n\t\tcoordinates,\r\n\t\tvisibleArea,\r\n\t};\r\n}\r\n","import { MoveEvent, ResizeEvent } from '../events';\r\nimport { AspectRatio, Coordinates, Limits, PositionRestrictions, ResizeDirections, SizeRestrictions } from '../typings';\r\nimport { ALL_DIRECTIONS, HORIZONTAL_DIRECTIONS, VERTICAL_DIRECTIONS } from '../constants';\r\nimport { applyDirections, getBrokenRatio, getIntersections, ratio } from '../service';\r\nimport { move } from './move';\r\n\r\ninterface FitConditionsParams {\r\n\tdirections: ResizeDirections;\r\n\tcoordinates: Coordinates;\r\n\tpositionRestrictions: Limits;\r\n\tsizeRestrictions: SizeRestrictions;\r\n\tpreserveRatio?: boolean;\r\n\tcompensate?: boolean;\r\n}\r\n\r\nexport function fitConditions({\r\n\tdirections,\r\n\tcoordinates,\r\n\tpositionRestrictions = {},\r\n\tsizeRestrictions,\r\n\tpreserveRatio,\r\n\tcompensate,\r\n}: FitConditionsParams): ResizeDirections {\r\n\tconst fittedDirections = { ...directions };\r\n\r\n\tlet currentWidth = applyDirections(coordinates, fittedDirections).width;\r\n\tlet currentHeight = applyDirections(coordinates, fittedDirections).height;\r\n\r\n\t// Prevent strange resizes when the width or height of stencil becomes smaller than 0\r\n\tif (currentWidth < 0) {\r\n\t\tif (fittedDirections.left < 0 && fittedDirections.right < 0) {\r\n\t\t\tfittedDirections.left =\r\n\t\t\t\t-(coordinates.width - sizeRestrictions.minWidth) / (fittedDirections.left / fittedDirections.right);\r\n\t\t\tfittedDirections.right =\r\n\t\t\t\t-(coordinates.width - sizeRestrictions.minWidth) / (fittedDirections.right / fittedDirections.left);\r\n\t\t} else if (fittedDirections.left < 0) {\r\n\t\t\tfittedDirections.left = -(coordinates.width - sizeRestrictions.minWidth);\r\n\t\t} else if (fittedDirections.right < 0) {\r\n\t\t\tfittedDirections.right = -(coordinates.width - sizeRestrictions.minWidth);\r\n\t\t}\r\n\t}\r\n\tif (currentHeight < 0) {\r\n\t\tif (fittedDirections.top < 0 && fittedDirections.bottom < 0) {\r\n\t\t\tfittedDirections.top =\r\n\t\t\t\t-(coordinates.height - sizeRestrictions.minHeight) / (fittedDirections.top / fittedDirections.bottom);\r\n\t\t\tfittedDirections.bottom =\r\n\t\t\t\t-(coordinates.height - sizeRestrictions.minHeight) / (fittedDirections.bottom / fittedDirections.top);\r\n\t\t} else if (fittedDirections.top < 0) {\r\n\t\t\tfittedDirections.top = -(coordinates.height - sizeRestrictions.minHeight);\r\n\t\t} else if (fittedDirections.bottom < 0) {\r\n\t\t\tfittedDirections.bottom = -(coordinates.height - sizeRestrictions.minHeight);\r\n\t\t}\r\n\t}\r\n\r\n\t// Prevent breaking limits\r\n\tlet breaks = getIntersections(applyDirections(coordinates, fittedDirections), positionRestrictions);\r\n\r\n\tif (compensate) {\r\n\t\tif (breaks.left && breaks.left > 0 && breaks.right === 0) {\r\n\t\t\tfittedDirections.right += breaks.left;\r\n\t\t\tfittedDirections.left -= breaks.left;\r\n\t\t} else if (breaks.right && breaks.right > 0 && breaks.left === 0) {\r\n\t\t\tfittedDirections.left += breaks.right;\r\n\t\t\tfittedDirections.right -= breaks.right;\r\n\t\t}\r\n\r\n\t\tif (breaks.top && breaks.top > 0 && breaks.bottom === 0) {\r\n\t\t\tfittedDirections.bottom += breaks.top;\r\n\t\t\tfittedDirections.top -= breaks.top;\r\n\t\t} else if (breaks.bottom && breaks.bottom > 0 && breaks.top === 0) {\r\n\t\t\tfittedDirections.top += breaks.bottom;\r\n\t\t\tfittedDirections.bottom -= breaks.bottom;\r\n\t\t}\r\n\r\n\t\tbreaks = getIntersections(applyDirections(coordinates, fittedDirections), positionRestrictions);\r\n\t}\r\n\r\n\tconst maxResize = {\r\n\t\twidth: Infinity,\r\n\t\theight: Infinity,\r\n\t\tleft: Infinity,\r\n\t\tright: Infinity,\r\n\t\ttop: Infinity,\r\n\t\tbottom: Infinity,\r\n\t};\r\n\r\n\tALL_DIRECTIONS.forEach((direction) => {\r\n\t\tconst intersection = breaks[direction];\r\n\t\tif (intersection && fittedDirections[direction]) {\r\n\t\t\tmaxResize[direction] = Math.max(0, 1 - intersection / fittedDirections[direction]);\r\n\t\t}\r\n\t});\r\n\r\n\tif (preserveRatio) {\r\n\t\tconst multiplier = Math.min(...ALL_DIRECTIONS.map((direction) => maxResize[direction]));\r\n\t\tif (multiplier !== Infinity) {\r\n\t\t\tALL_DIRECTIONS.forEach((direction) => {\r\n\t\t\t\tfittedDirections[direction] *= multiplier;\r\n\t\t\t});\r\n\t\t}\r\n\t} else {\r\n\t\tALL_DIRECTIONS.forEach((direction) => {\r\n\t\t\tif (maxResize[direction] !== Infinity) {\r\n\t\t\t\tfittedDirections[direction] *= maxResize[direction];\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tcurrentWidth = applyDirections(coordinates, fittedDirections).width;\r\n\tcurrentHeight = applyDirections(coordinates, fittedDirections).height;\r\n\r\n\tif (fittedDirections.right + fittedDirections.left) {\r\n\t\tif (currentWidth > sizeRestrictions.maxWidth) {\r\n\t\t\tmaxResize.width =\r\n\t\t\t\t(sizeRestrictions.maxWidth - coordinates.width) / (fittedDirections.right + fittedDirections.left);\r\n\t\t} else if (currentWidth < sizeRestrictions.minWidth) {\r\n\t\t\tmaxResize.width =\r\n\t\t\t\t(sizeRestrictions.minWidth - coordinates.width) / (fittedDirections.right + fittedDirections.left);\r\n\t\t}\r\n\t}\r\n\r\n\tif (fittedDirections.bottom + fittedDirections.top) {\r\n\t\tif (currentHeight > sizeRestrictions.maxHeight) {\r\n\t\t\tmaxResize.height =\r\n\t\t\t\t(sizeRestrictions.maxHeight - coordinates.height) / (fittedDirections.bottom + fittedDirections.top);\r\n\t\t} else if (currentHeight < sizeRestrictions.minHeight) {\r\n\t\t\tmaxResize.height =\r\n\t\t\t\t(sizeRestrictions.minHeight - coordinates.height) / (fittedDirections.bottom + fittedDirections.top);\r\n\t\t}\r\n\t}\r\n\r\n\tif (preserveRatio) {\r\n\t\tconst multiplier = Math.min(maxResize.width, maxResize.height);\r\n\t\tif (multiplier !== Infinity) {\r\n\t\t\tALL_DIRECTIONS.forEach((direction) => {\r\n\t\t\t\tfittedDirections[direction] *= multiplier;\r\n\t\t\t});\r\n\t\t}\r\n\t} else {\r\n\t\tif (maxResize.width !== Infinity) {\r\n\t\t\tHORIZONTAL_DIRECTIONS.forEach((direction) => {\r\n\t\t\t\tfittedDirections[direction] *= maxResize.width;\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (maxResize.height !== Infinity) {\r\n\t\t\tVERTICAL_DIRECTIONS.forEach((direction) => {\r\n\t\t\t\tfittedDirections[direction] *= maxResize.height;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\treturn fittedDirections;\r\n}\r\n\r\nexport interface ResizeParams {\r\n\tevent: ResizeEvent;\r\n\tcoordinates: Coordinates;\r\n\taspectRatio: AspectRatio;\r\n\tsizeRestrictions: SizeRestrictions;\r\n\tpositionRestrictions: PositionRestrictions;\r\n}\r\n\r\nfunction distributeOverlap(overlap: number, first: number, second: number) {\r\n\tif (first == 0 && second == 0) {\r\n\t\treturn overlap / 2;\r\n\t} else if (first == 0) {\r\n\t\treturn 0;\r\n\t} else if (second == 0) {\r\n\t\treturn overlap;\r\n\t} else {\r\n\t\treturn overlap * Math.abs(first / (first + second));\r\n\t}\r\n}\r\n\r\nexport function resize(params: ResizeParams): Coordinates {\r\n\tconst { event, coordinates, aspectRatio, positionRestrictions, sizeRestrictions } = params;\r\n\tconst actualCoordinates = {\r\n\t\t...coordinates,\r\n\t\tright: coordinates.left + coordinates.width,\r\n\t\tbottom: coordinates.top + coordinates.height,\r\n\t};\r\n\r\n\tconst eventParams = event.params || {};\r\n\r\n\tlet directions = {\r\n\t\t...event.directions,\r\n\t};\r\n\r\n\tconst allowedDirections = eventParams.allowedDirections || {\r\n\t\tleft: true,\r\n\t\tright: true,\r\n\t\tbottom: true,\r\n\t\ttop: true,\r\n\t};\r\n\r\n\tif (sizeRestrictions.widthFrozen) {\r\n\t\tdirections.left = 0;\r\n\t\tdirections.right = 0;\r\n\t}\r\n\r\n\tif (sizeRestrictions.heightFrozen) {\r\n\t\tdirections.top = 0;\r\n\t\tdirections.bottom = 0;\r\n\t}\r\n\r\n\tALL_DIRECTIONS.forEach((direction) => {\r\n\t\tif (!allowedDirections[direction]) {\r\n\t\t\tdirections[direction] = 0;\r\n\t\t}\r\n\t});\r\n\r\n\t// 1. First step: determine the safe and desired area\r\n\tdirections = fitConditions({\r\n\t\tcoordinates: actualCoordinates,\r\n\t\tdirections,\r\n\t\tsizeRestrictions: sizeRestrictions,\r\n\t\tpositionRestrictions,\r\n\t});\r\n\r\n\t// 2. Second step: fix desired box to correspondent to aspect ratio\r\n\tlet currentWidth = applyDirections(actualCoordinates, directions).width;\r\n\tlet currentHeight = applyDirections(actualCoordinates, directions).height;\r\n\r\n\t// Checks ratio:\r\n\tlet ratioBroken = eventParams.preserveRatio\r\n\t\t? ratio(actualCoordinates)\r\n\t\t: getBrokenRatio(currentWidth / currentHeight, aspectRatio);\r\n\r\n\tif (ratioBroken) {\r\n\t\tlet { respectDirection } = eventParams;\r\n\t\tif (!respectDirection) {\r\n\t\t\tif (actualCoordinates.width >= actualCoordinates.height || ratioBroken === 1) {\r\n\t\t\t\trespectDirection = 'width';\r\n\t\t\t} else {\r\n\t\t\t\trespectDirection = 'height';\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (respectDirection === 'width') {\r\n\t\t\tconst overlapHeight = currentWidth / ratioBroken - actualCoordinates.height;\r\n\t\t\tif (allowedDirections.top && allowedDirections.bottom) {\r\n\t\t\t\tconst { top, bottom } = directions;\r\n\t\t\t\tdirections.bottom = distributeOverlap(overlapHeight, bottom, top);\r\n\t\t\t\tdirections.top = distributeOverlap(overlapHeight, top, bottom);\r\n\t\t\t} else if (allowedDirections.bottom) {\r\n\t\t\t\tdirections.bottom = overlapHeight;\r\n\t\t\t} else if (allowedDirections.top) {\r\n\t\t\t\tdirections.top = overlapHeight;\r\n\t\t\t} else if (allowedDirections.right) {\r\n\t\t\t\tdirections.right = 0;\r\n\t\t\t} else if (allowedDirections.left) {\r\n\t\t\t\tdirections.left = 0;\r\n\t\t\t}\r\n\t\t} else if (respectDirection === 'height') {\r\n\t\t\tconst overlapWidth = actualCoordinates.width - currentHeight * ratioBroken;\r\n\t\t\tif (allowedDirections.left && allowedDirections.right) {\r\n\t\t\t\tconst { left, right } = directions;\r\n\t\t\t\tdirections.left = -distributeOverlap(overlapWidth, left, right);\r\n\t\t\t\tdirections.right = -distributeOverlap(overlapWidth, right, left);\r\n\t\t\t} else if (allowedDirections.left) {\r\n\t\t\t\tdirections.left = -overlapWidth;\r\n\t\t\t} else if (allowedDirections.right) {\r\n\t\t\t\tdirections.right = -overlapWidth;\r\n\t\t\t} else if (allowedDirections.top) {\r\n\t\t\t\tdirections.top = 0;\r\n\t\t\t} else if (allowedDirections.bottom) {\r\n\t\t\t\tdirections.bottom = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// 3. Third step: check if desired box with correct aspect ratios break some limits and fit to this conditions\r\n\t\tdirections = fitConditions({\r\n\t\t\tdirections,\r\n\t\t\tcoordinates: actualCoordinates,\r\n\t\t\tsizeRestrictions: sizeRestrictions,\r\n\t\t\tpositionRestrictions,\r\n\t\t\tpreserveRatio: true,\r\n\t\t\tcompensate: eventParams.compensate,\r\n\t\t});\r\n\t}\r\n\r\n\t// 4. Check if ratio broken (temporary):\r\n\tcurrentWidth = applyDirections(actualCoordinates, directions).width;\r\n\tcurrentHeight = applyDirections(actualCoordinates, directions).height;\r\n\tratioBroken = eventParams.preserveRatio\r\n\t\t? ratio(actualCoordinates)\r\n\t\t: getBrokenRatio(currentWidth / currentHeight, aspectRatio);\r\n\tif (ratioBroken && Math.abs(ratioBroken - currentWidth / currentHeight) > 1e-3) {\r\n\t\tif (process.env.NODE_ENV !== 'production') {\r\n\t\t\tconsole.error(\r\n\t\t\t\t`Something went wrong and ratio was broken: ${currentWidth / currentHeight} instead of ${ratioBroken}`,\r\n\t\t\t);\r\n\t\t}\r\n\t\tALL_DIRECTIONS.forEach((direction) => {\r\n\t\t\tif (!allowedDirections[direction]) {\r\n\t\t\t\tdirections[direction] = 0;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\treturn move({\r\n\t\tevent: new MoveEvent({\r\n\t\t\tleft: -directions.left,\r\n\t\t\ttop: -directions.top,\r\n\t\t}),\r\n\t\tcoordinates: {\r\n\t\t\twidth: coordinates.width + directions.right + directions.left,\r\n\t\t\theight: coordinates.height + directions.top + directions.bottom,\r\n\t\t\tleft: coordinates.left,\r\n\t\t\ttop: coordinates.top,\r\n\t\t},\r\n\t\tpositionRestrictions,\r\n\t});\r\n}\r\n","<script>\r\nimport classnames from 'classnames';\r\nimport bem from 'easy-bem';\r\nimport { HandlerWrapper } from '../service';\r\n\r\nconst block = bem('vue-simple-handler');\r\nconst wrapper = bem('vue-simple-handler-wrapper');\r\n\r\nexport default {\r\n\tname: 'SimpleHandler',\r\n\tcomponents: {\r\n\t\tHandlerWrapper,\r\n\t},\r\n\tprops: {\r\n\t\tdefaultClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\thoverClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\twrapperClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\thorizontalPosition: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tverticalPosition: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tdisabled: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false,\r\n\t\t},\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\thover: false,\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\tclasses() {\r\n\t\t\tconst options = {\r\n\t\t\t\t[this.horizontalPosition]: Boolean(this.horizontalPosition),\r\n\t\t\t\t[this.verticalPosition]: Boolean(this.verticalPosition),\r\n\t\t\t\t[`${this.horizontalPosition}-${this.verticalPosition}`]: Boolean(\r\n\t\t\t\t\tthis.verticalPosition && this.horizontalPosition,\r\n\t\t\t\t),\r\n\t\t\t\thover: this.hover,\r\n\t\t\t};\r\n\t\t\treturn {\r\n\t\t\t\tdefault: classnames(block(options), this.defaultClass, this.hover && this.hoverClass),\r\n\t\t\t\twrapper: classnames(wrapper(options), this.wrapperClass),\r\n\t\t\t};\r\n\t\t},\r\n\t},\r\n\tmethods: {\r\n\t\tonDrag(dragEvent) {\r\n\t\t\tthis.$emit('drag', dragEvent);\r\n\t\t},\r\n\t\tonEnter() {\r\n\t\t\tthis.hover = true;\r\n\t\t},\r\n\t\tonLeave() {\r\n\t\t\tthis.hover = false;\r\n\t\t},\r\n\t\tonDragEnd() {\r\n\t\t\tthis.$emit('drag-end');\r\n\t\t},\r\n\t},\r\n\temits: ['drag', 'drag-end'],\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<HandlerWrapper\r\n\t\t:class=\"classes.wrapper\"\r\n\t\t:vertical-position=\"verticalPosition\"\r\n\t\t:horizontal-position=\"horizontalPosition\"\r\n\t\t:disabled=\"disabled\"\r\n\t\t@drag=\"onDrag\"\r\n\t\t@drag-end=\"onDragEnd\"\r\n\t\t@enter=\"onEnter\"\r\n\t\t@leave=\"onLeave\"\r\n\t>\r\n\t\t<div :class=\"classes.default\" />\r\n\t</HandlerWrapper>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.vue-simple-handler {\r\n\tdisplay: block;\r\n\tbackground: white;\r\n\theight: 10px;\r\n\twidth: 10px;\r\n}\r\n</style>\r\n","<script>\r\nimport bem from 'easy-bem';\r\nimport classnames from 'classnames';\r\nimport { LineWrapper } from '../service';\r\n\r\nconst block = bem('vue-simple-line');\r\nconst wrapper = bem('vue-simple-line-wrapper');\r\n\r\nexport default {\r\n\tname: 'SimpleLine',\r\n\tcomponents: {\r\n\t\tLineWrapper,\r\n\t},\r\n\tprops: {\r\n\t\tdefaultClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\thoverClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\twrapperClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tposition: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tdisabled: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false,\r\n\t\t},\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\thover: false,\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\tclasses() {\r\n\t\t\treturn {\r\n\t\t\t\troot: classnames(block({ [this.position]: true }), this.defaultClass, this.hover && this.hoverClass),\r\n\t\t\t\twrapper: classnames(wrapper({ [this.position]: true }), this.wrapperClass),\r\n\t\t\t};\r\n\t\t},\r\n\t},\r\n\tmethods: {\r\n\t\tonDrag(dragEvent) {\r\n\t\t\tthis.$emit('drag', dragEvent);\r\n\t\t},\r\n\t\tonEnter() {\r\n\t\t\tthis.hover = true;\r\n\t\t},\r\n\t\tonLeave() {\r\n\t\t\tthis.hover = false;\r\n\t\t},\r\n\t\tonDragEnd() {\r\n\t\t\tthis.$emit('drag-end');\r\n\t\t},\r\n\t},\r\n\temits: ['drag', 'drag-end'],\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<LineWrapper\r\n\t\t:class=\"classes.wrapper\"\r\n\t\t:position=\"position\"\r\n\t\t:disabled=\"disabled\"\r\n\t\t@drag=\"onDrag\"\r\n\t\t@drag-end=\"onDragEnd\"\r\n\t\t@enter=\"onEnter\"\r\n\t\t@leave=\"onLeave\"\r\n\t>\r\n\t\t<div :class=\"classes.root\" />\r\n\t</LineWrapper>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.vue-simple-line {\r\n\tbackground: none;\r\n\ttransition: border 0.5s;\r\n\tborder-color: rgba(white, 0.3);\r\n\tborder-width: 0;\r\n\tborder-style: solid;\r\n\r\n\t&--south,\r\n\t&--north {\r\n\t\theight: 0;\r\n\t\twidth: 100%;\r\n\t}\r\n\r\n\t&--east,\r\n\t&--west {\r\n\t\theight: 100%;\r\n\t\twidth: 0;\r\n\t}\r\n\r\n\t&--east {\r\n\t\tborder-right-width: 1px;\r\n\t}\r\n\t&--west {\r\n\t\tborder-left-width: 1px;\r\n\t}\r\n\t&--south {\r\n\t\tborder-bottom-width: 1px;\r\n\t}\r\n\t&--north {\r\n\t\tborder-top-width: 1px;\r\n\t}\r\n\r\n\t&--hover {\r\n\t\topacity: 1;\r\n\t\tborder-color: white;\r\n\t}\r\n}\r\n</style>\r\n","<script>\r\nimport bem from 'easy-bem';\r\nimport classnames from 'classnames';\r\nimport { isEmpty, replacedProp } from '../../core';\r\nimport { directionNames } from '../../core/utils';\r\nimport { ResizeEvent } from '../../core/events';\r\nimport { SimpleHandler } from '../handlers';\r\nimport { SimpleLine } from '../lines';\r\n\r\nconst cn = bem('vue-bounding-box');\r\n\r\nconst HORIZONTAL_DIRECTIONS = ['east', 'west', null];\r\nconst VERTICAL_DIRECTIONS = ['south', 'north', null];\r\n\r\nexport default {\r\n\tname: 'BoundingBox',\r\n\tprops: {\r\n\t\twidth: {\r\n\t\t\ttype: Number,\r\n\t\t},\r\n\t\theight: {\r\n\t\t\ttype: Number,\r\n\t\t},\r\n\t\ttransitions: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\thandlers: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {\r\n\t\t\t\t\teastNorth: true,\r\n\t\t\t\t\tnorth: true,\r\n\t\t\t\t\twestNorth: true,\r\n\t\t\t\t\twest: true,\r\n\t\t\t\t\twestSouth: true,\r\n\t\t\t\t\tsouth: true,\r\n\t\t\t\t\teastSouth: true,\r\n\t\t\t\t\teast: true,\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t},\r\n\t\thandlersComponent: {\r\n\t\t\ttype: [Object, String],\r\n\t\t\tdefault() {\r\n\t\t\t\treturn SimpleHandler;\r\n\t\t\t},\r\n\t\t},\r\n\t\thandlersClasses: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\thandlersWrappersClasses: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\tlines: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {\r\n\t\t\t\t\twest: true,\r\n\t\t\t\t\tnorth: true,\r\n\t\t\t\t\teast: true,\r\n\t\t\t\t\tsouth: true,\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t},\r\n\t\tlinesComponent: {\r\n\t\t\ttype: [Object, String],\r\n\t\t\tdefault() {\r\n\t\t\t\treturn SimpleLine;\r\n\t\t\t},\r\n\t\t},\r\n\t\tlinesClasses: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\tlinesWrappersClasses: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\tresizable: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true,\r\n\t\t},\r\n\t},\r\n\tdata() {\r\n\t\tconst points = [];\r\n\t\tHORIZONTAL_DIRECTIONS.forEach((hDirection) => {\r\n\t\t\tVERTICAL_DIRECTIONS.forEach((vDirection) => {\r\n\t\t\t\tif (hDirection !== vDirection) {\r\n\t\t\t\t\tlet { name, classname } = directionNames(hDirection, vDirection);\r\n\t\t\t\t\tpoints.push({\r\n\t\t\t\t\t\tname,\r\n\t\t\t\t\t\tclassname,\r\n\t\t\t\t\t\tverticalDirection: vDirection,\r\n\t\t\t\t\t\thorizontalDirection: hDirection,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tpoints,\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\tstyle() {\r\n\t\t\tconst result = {};\r\n\t\t\tif (this.width && this.height) {\r\n\t\t\t\tresult.width = `${this.width}px`;\r\n\t\t\t\tresult.height = `${this.height}px`;\r\n\r\n\t\t\t\tif (this.transitions && this.transitions.enabled) {\r\n\t\t\t\t\tresult.transition = `${this.transitions.time}ms ${this.transitions.timingFunction}`;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\tclasses() {\r\n\t\t\tconst handlers = this.handlersClasses;\r\n\t\t\tconst handlersWrappers = this.handlersWrappersClasses;\r\n\t\t\tconst lines = this.linesClasses;\r\n\t\t\tconst linesWrappers = this.linesWrappersClasses;\r\n\r\n\t\t\treturn {\r\n\t\t\t\troot: cn(),\r\n\t\t\t\thandlers,\r\n\t\t\t\thandlersWrappers,\r\n\t\t\t\tlines,\r\n\t\t\t\tlinesWrappers,\r\n\t\t\t};\r\n\t\t},\r\n\t\tlineNodes() {\r\n\t\t\tconst lines = [];\r\n\t\t\tthis.points.forEach((point) => {\r\n\t\t\t\tif ((!point.horizontalDirection || !point.verticalDirection) && this.lines[point.name]) {\r\n\t\t\t\t\tlines.push({\r\n\t\t\t\t\t\tname: point.name,\r\n\t\t\t\t\t\tcomponent: this.linesComponent,\r\n\t\t\t\t\t\tclass: classnames(\r\n\t\t\t\t\t\t\tthis.classes.lines.default,\r\n\t\t\t\t\t\t\tthis.classes.lines[point.name],\r\n\t\t\t\t\t\t\t!this.resizable && this.classes.lines.disabled,\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\twrapperClass: classnames(\r\n\t\t\t\t\t\t\tthis.classes.linesWrappers.default,\r\n\t\t\t\t\t\t\tthis.classes.linesWrappers[point.name],\r\n\t\t\t\t\t\t\t!this.resizable && this.classes.linesWrappers.disabled,\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\thoverClass: this.classes.lines.hover,\r\n\t\t\t\t\t\tverticalDirection: point.verticalDirection,\r\n\t\t\t\t\t\thorizontalDirection: point.horizontalDirection,\r\n\t\t\t\t\t\tdisabled: !this.resizable,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn lines;\r\n\t\t},\r\n\t\thandlerNodes() {\r\n\t\t\tconst handlers = [];\r\n\t\t\tconst { width, height } = this;\r\n\t\t\tthis.points.forEach((point) => {\r\n\t\t\t\tif (this.handlers[point.name]) {\r\n\t\t\t\t\tconst result = {\r\n\t\t\t\t\t\tname: point.name,\r\n\t\t\t\t\t\tcomponent: this.handlersComponent,\r\n\t\t\t\t\t\tclass: classnames(this.classes.handlers.default, this.classes.handlers[point.name]),\r\n\t\t\t\t\t\twrapperClass: classnames(\r\n\t\t\t\t\t\t\tthis.classes.handlersWrappers.default,\r\n\t\t\t\t\t\t\tthis.classes.handlersWrappers[point.name],\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\thoverClass: this.classes.handlers.hover,\r\n\t\t\t\t\t\tverticalDirection: point.verticalDirection,\r\n\t\t\t\t\t\thorizontalDirection: point.horizontalDirection,\r\n\t\t\t\t\t\tdisabled: !this.resizable,\r\n\t\t\t\t\t};\r\n\t\t\t\t\tif (width && height) {\r\n\t\t\t\t\t\tconst { horizontalDirection, verticalDirection } = point;\r\n\t\t\t\t\t\tconst left =\r\n\t\t\t\t\t\t\thorizontalDirection === 'east' ? width : horizontalDirection === 'west' ? 0 : width / 2;\r\n\t\t\t\t\t\tconst top =\r\n\t\t\t\t\t\t\tverticalDirection === 'south' ? height : verticalDirection === 'north' ? 0 : height / 2;\r\n\t\t\t\t\t\tresult.wrapperClass = cn('handler');\r\n\t\t\t\t\t\tresult.wrapperStyle = {\r\n\t\t\t\t\t\t\ttransform: `translate(${left}px, ${top}px)`,\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tif (this.transitions && this.transitions.enabled) {\r\n\t\t\t\t\t\t\tresult.wrapperStyle.transition = `${this.transitions.time}ms ${this.transitions.timingFunction}`;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresult.wrapperClass = cn('handler', { [point.classname]: true });\r\n\t\t\t\t\t}\r\n\t\t\t\t\thandlers.push(result);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn handlers;\r\n\t\t},\r\n\t},\r\n\tbeforeMount() {\r\n\t\twindow.addEventListener('mouseup', this.onMouseUp, { passive: false });\r\n\t\twindow.addEventListener('mousemove', this.onMouseMove, { passive: false });\r\n\t\twindow.addEventListener('touchmove', this.onTouchMove, { passive: false });\r\n\t\twindow.addEventListener('touchend', this.onTouchEnd, { passive: false });\r\n\t},\r\n\tbeforeUnmount() {\r\n\t\twindow.removeEventListener('mouseup', this.onMouseUp);\r\n\t\twindow.removeEventListener('mousemove', this.onMouseMove);\r\n\t\twindow.removeEventListener('touchmove', this.onTouchMove);\r\n\t\twindow.removeEventListener('touchend', this.onTouchEnd);\r\n\t},\r\n\tmounted() {\r\n\t\tthis.touches = [];\r\n\t},\r\n\tmethods: {\r\n\t\tonEnd() {\r\n\t\t\tthis.$emit('resize-end');\r\n\t\t},\r\n\t\tonHandlerDrag(dragEvent, horizontalDirection, verticalDirection) {\r\n\t\t\tconst { left, top } = dragEvent.shift();\r\n\r\n\t\t\tconst directions = {\r\n\t\t\t\tleft: 0,\r\n\t\t\t\tright: 0,\r\n\t\t\t\ttop: 0,\r\n\t\t\t\tbottom: 0,\r\n\t\t\t};\r\n\r\n\t\t\tif (horizontalDirection === 'west') {\r\n\t\t\t\tdirections.left -= left;\r\n\t\t\t} else if (horizontalDirection === 'east') {\r\n\t\t\t\tdirections.right += left;\r\n\t\t\t}\r\n\t\t\tif (verticalDirection === 'north') {\r\n\t\t\t\tdirections.top -= top;\r\n\t\t\t} else if (verticalDirection === 'south') {\r\n\t\t\t\tdirections.bottom += top;\r\n\t\t\t}\r\n\r\n\t\t\tlet respectDirection;\r\n\t\t\tif (!verticalDirection && horizontalDirection) {\r\n\t\t\t\trespectDirection = 'width';\r\n\t\t\t} else if (verticalDirection && !horizontalDirection) {\r\n\t\t\t\trespectDirection = 'height';\r\n\t\t\t}\r\n\r\n\t\t\tif (this.resizable) {\r\n\t\t\t\tthis.$emit(\r\n\t\t\t\t\t'resize',\r\n\t\t\t\t\tnew ResizeEvent(directions, {\r\n\t\t\t\t\t\tallowedDirections: {\r\n\t\t\t\t\t\t\tleft: horizontalDirection === 'west' || !horizontalDirection,\r\n\t\t\t\t\t\t\tright: horizontalDirection === 'east' || !horizontalDirection,\r\n\t\t\t\t\t\t\tbottom: verticalDirection === 'south' || !verticalDirection,\r\n\t\t\t\t\t\t\ttop: verticalDirection === 'north' || !verticalDirection,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tpreserveAspectRatio: dragEvent.nativeEvent && dragEvent.nativeEvent.shiftKey,\r\n\t\t\t\t\t\trespectDirection,\r\n\t\t\t\t\t}),\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n\temits: ['resize', 'resize-end'],\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<div ref=\"box\" :class=\"classes.root\" :style=\"style\">\r\n\t\t<slot />\r\n\t\t<div>\r\n\t\t\t<component\r\n\t\t\t\t:is=\"line.component\"\r\n\t\t\t\tv-for=\"line in lineNodes\"\r\n\t\t\t\t:key=\"line.name\"\r\n\t\t\t\t:default-class=\"line.class\"\r\n\t\t\t\t:hover-class=\"line.hoverClass\"\r\n\t\t\t\t:wrapper-class=\"line.wrapperClass\"\r\n\t\t\t\t:position=\"line.name\"\r\n\t\t\t\t:disabled=\"line.disabled\"\r\n\t\t\t\t@drag=\"onHandlerDrag($event, line.horizontalDirection, line.verticalDirection)\"\r\n\t\t\t\t@drag-end=\"onEnd()\"\r\n\t\t\t/>\r\n\t\t</div>\r\n\t\t<div\r\n\t\t\tv-for=\"handler in handlerNodes\"\r\n\t\t\t:key=\"handler.name\"\r\n\t\t\t:style=\"handler.wrapperStyle\"\r\n\t\t\t:class=\"handler.wrapperClass\"\r\n\t\t>\r\n\t\t\t<component\r\n\t\t\t\t:is=\"handler.component\"\r\n\t\t\t\t:default-class=\"handler.class\"\r\n\t\t\t\t:hover-class=\"handler.hoverClass\"\r\n\t\t\t\t:wrapper-class=\"handler.wrapperClass\"\r\n\t\t\t\t:horizontal-position=\"handler.horizontalDirection\"\r\n\t\t\t\t:vertical-position=\"handler.verticalDirection\"\r\n\t\t\t\t:disabled=\"handler.disabled\"\r\n\t\t\t\t@drag=\"onHandlerDrag($event, handler.horizontalDirection, handler.verticalDirection)\"\r\n\t\t\t\t@drag-end=\"onEnd()\"\r\n\t\t\t/>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.vue-bounding-box {\r\n\tposition: relative;\r\n\theight: 100%;\r\n\twidth: 100%;\r\n\t&__handler {\r\n\t\tposition: absolute;\r\n\t\t&--west-north {\r\n\t\t\tleft: 0;\r\n\t\t\ttop: 0;\r\n\t\t}\r\n\t\t&--north {\r\n\t\t\tleft: 50%;\r\n\t\t\ttop: 0;\r\n\t\t}\r\n\t\t&--east-north {\r\n\t\t\tleft: 100%;\r\n\t\t\ttop: 0;\r\n\t\t}\r\n\t\t&--east {\r\n\t\t\tleft: 100%;\r\n\t\t\ttop: 50%;\r\n\t\t}\r\n\t\t&--east-south {\r\n\t\t\tleft: 100%;\r\n\t\t\ttop: 100%;\r\n\t\t}\r\n\t\t&--south {\r\n\t\t\tleft: 50%;\r\n\t\t\ttop: 100%;\r\n\t\t}\r\n\t\t&--west-south {\r\n\t\t\tleft: 0;\r\n\t\t\ttop: 100%;\r\n\t\t}\r\n\t\t&--west {\r\n\t\t\tleft: 0;\r\n\t\t\ttop: 50%;\r\n\t\t}\r\n\t}\r\n}\r\n</style>\r\n","<script>\r\nimport classnames from 'classnames';\r\nimport bem from 'easy-bem';\r\nimport { distance } from '../../core/utils';\r\nimport { MoveEvent } from '../../core/events.ts';\r\n\r\nconst cn = bem('vue-draggable-area');\r\n\r\nexport default {\r\n\tname: 'DraggableArea',\r\n\tprops: {\r\n\t\tmovable: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true,\r\n\t\t},\r\n\t\tactivationDistance: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 20,\r\n\t\t},\r\n\t},\r\n\tcomputed: {\r\n\t\tclassnames() {\r\n\t\t\treturn {\r\n\t\t\t\tdefault: cn(),\r\n\t\t\t};\r\n\t\t},\r\n\t},\r\n\tbeforeMount() {\r\n\t\twindow.addEventListener('mouseup', this.onMouseUp, { passive: false });\r\n\t\twindow.addEventListener('mousemove', this.onMouseMove, { passive: false });\r\n\t\twindow.addEventListener('touchmove', this.onTouchMove, { passive: false });\r\n\t\twindow.addEventListener('touchend', this.onTouchEnd, { passive: false });\r\n\t},\r\n\tbeforeUnmount() {\r\n\t\twindow.removeEventListener('mouseup', this.onMouseUp);\r\n\t\twindow.removeEventListener('mousemove', this.onMouseMove);\r\n\t\twindow.removeEventListener('touchmove', this.onTouchMove);\r\n\t\twindow.removeEventListener('touchend', this.onTouchEnd);\r\n\t},\r\n\tmounted() {\r\n\t\tthis.touches = [];\r\n\t\tthis.touchStarted = false;\r\n\t},\r\n\tmethods: {\r\n\t\tonTouchStart(e) {\r\n\t\t\tif (e.cancelable) {\r\n\t\t\t\tconst shouldStartMove = this.movable && e.touches.length === 1;\r\n\t\t\t\tif (shouldStartMove) {\r\n\t\t\t\t\tthis.touches = [...e.touches];\r\n\t\t\t\t}\r\n\t\t\t\tif (this.touchStarted || shouldStartMove) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tonTouchEnd() {\r\n\t\t\tthis.touchStarted = false;\r\n\t\t\tthis.processEnd();\r\n\t\t},\r\n\t\tonTouchMove(e) {\r\n\t\t\tif (this.touches.length >= 1) {\r\n\t\t\t\tif (this.touchStarted) {\r\n\t\t\t\t\tthis.processMove(e, e.touches);\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t} else if (\r\n\t\t\t\t\tdistance(\r\n\t\t\t\t\t\t{ x: this.touches[0].clientX, y: this.touches[0].clientY },\r\n\t\t\t\t\t\t{ x: e.touches[0].clientX, y: e.touches[0].clientY },\r\n\t\t\t\t\t) > this.activationDistance\r\n\t\t\t\t) {\r\n\t\t\t\t\tthis.initAnchor({\r\n\t\t\t\t\t\tclientX: e.touches[0].clientX,\r\n\t\t\t\t\t\tclientY: e.touches[0].clientY,\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.touchStarted = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tonMouseDown(e) {\r\n\t\t\tif (this.movable && e.button === 0) {\r\n\t\t\t\tconst touch = {\r\n\t\t\t\t\tfake: true,\r\n\t\t\t\t\tclientX: e.clientX,\r\n\t\t\t\t\tclientY: e.clientY,\r\n\t\t\t\t};\r\n\t\t\t\tthis.touches = [touch];\r\n\t\t\t\tthis.initAnchor(touch);\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t},\r\n\t\tonMouseMove(e) {\r\n\t\t\tif (this.touches.length) {\r\n\t\t\t\tthis.processMove(e, [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfake: true,\r\n\t\t\t\t\t\tclientX: e.clientX,\r\n\t\t\t\t\t\tclientY: e.clientY,\r\n\t\t\t\t\t},\r\n\t\t\t\t]);\r\n\t\t\t\tif (e.preventDefault && e.cancelable) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t},\r\n\t\tonMouseUp() {\r\n\t\t\tthis.processEnd();\r\n\t\t},\r\n\t\tinitAnchor(touch) {\r\n\t\t\tconst container = this.$refs.container;\r\n\t\t\tconst { left, top } = container.getBoundingClientRect();\r\n\r\n\t\t\tthis.anchor = {\r\n\t\t\t\tx: touch.clientX - left,\r\n\t\t\t\ty: touch.clientY - top,\r\n\t\t\t};\r\n\t\t},\r\n\t\tprocessMove(event, touches) {\r\n\t\t\tconst newTouches = [...touches];\r\n\t\t\tif (this.touches.length) {\r\n\t\t\t\tconst container = this.$refs.container;\r\n\t\t\t\tconst { left, top } = container.getBoundingClientRect();\r\n\t\t\t\tif (this.touches.length === 1 && newTouches.length === 1) {\r\n\t\t\t\t\tthis.$emit(\r\n\t\t\t\t\t\t'move',\r\n\t\t\t\t\t\tnew MoveEvent({\r\n\t\t\t\t\t\t\tleft: newTouches[0].clientX - (left + this.anchor.x),\r\n\t\t\t\t\t\t\ttop: newTouches[0].clientY - (top + this.anchor.y),\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tprocessEnd() {\r\n\t\t\tif (this.touches.length) {\r\n\t\t\t\tthis.$emit('move-end');\r\n\t\t\t}\r\n\t\t\tthis.touches = [];\r\n\t\t},\r\n\t},\r\n\temits: ['move', 'move-end'],\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<div ref=\"container\" @touchstart=\"onTouchStart\" @mousedown=\"onMouseDown\">\r\n\t\t<slot />\r\n\t</div>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.vue-draggable-area {\r\n\tposition: relative;\r\n}\r\n</style>\r\n","import { ImageTransforms } from './typings';\r\nimport { getCenter, rotatePoint, rotateSize } from './service';\r\n\r\nexport const XHR_DONE = 4;\r\n\r\nexport function prepareSource(canvas, image, { rotate, flip }) {\r\n\tconst originalSize = {\r\n\t\twidth: image.naturalWidth,\r\n\t\theight: image.naturalHeight,\r\n\t};\r\n\r\n\tconst transformedSize = rotateSize(originalSize, rotate);\r\n\r\n\tconst ctx = canvas.getContext('2d');\r\n\tcanvas.height = transformedSize.height;\r\n\tcanvas.width = transformedSize.width;\r\n\r\n\tctx.save();\r\n\r\n\t// Rotation:\r\n\tconst originalCenter = {\r\n\t\tleft: originalSize.width / 2,\r\n\t\ttop: originalSize.height / 2,\r\n\t};\r\n\r\n\tlet canvasCenter = rotatePoint(\r\n\t\tgetCenter({\r\n\t\t\tleft: 0,\r\n\t\t\ttop: 0,\r\n\t\t\t...originalSize,\r\n\t\t}),\r\n\t\trotate,\r\n\t);\r\n\r\n\tctx.translate(-(canvasCenter.left - transformedSize.width / 2), -(canvasCenter.top - transformedSize.height / 2));\r\n\tctx.rotate((rotate * Math.PI) / 180);\r\n\r\n\t// Reflection;\r\n\tctx.translate(flip.horizontal ? originalSize.width : 0, flip.vertical ? originalSize.height : 0);\r\n\tctx.scale(flip.horizontal ? -1 : 1, flip.vertical ? -1 : 1);\r\n\r\n\tctx.drawImage(image, 0, 0, originalSize.width, originalSize.height);\r\n\tctx.restore();\r\n\r\n\treturn canvas;\r\n}\r\n\r\nfunction base64ToArrayBuffer(base64) {\r\n\tbase64 = base64.replace(/^data:([^;]+);base64,/gim, '');\r\n\tconst binary = atob(base64);\r\n\tconst len = binary.length;\r\n\tconst buffer = new ArrayBuffer(len);\r\n\tconst view = new Uint8Array(buffer);\r\n\tfor (let i = 0; i < len; i++) {\r\n\t\tview[i] = binary.charCodeAt(i);\r\n\t}\r\n\treturn buffer;\r\n}\r\n\r\nfunction objectURLToBlob(url, callback) {\r\n\tconst http = new XMLHttpRequest();\r\n\thttp.open('GET', url, true);\r\n\thttp.responseType = 'blob';\r\n\thttp.onload = function () {\r\n\t\tif (this.status == 200 || this.status === 0) {\r\n\t\t\tcallback(this.response);\r\n\t\t}\r\n\t};\r\n\thttp.send();\r\n}\r\n\r\nexport function getImageTransforms(orientation: number) {\r\n\tconst result: ImageTransforms = {\r\n\t\tflip: {\r\n\t\t\thorizontal: false,\r\n\t\t\tvertical: false,\r\n\t\t},\r\n\t\trotate: 0,\r\n\t};\r\n\tif (orientation) {\r\n\t\tswitch (orientation) {\r\n\t\t\tcase 2:\r\n\t\t\t\tresult.flip.horizontal = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tresult.rotate = -180;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tresult.flip.vertical = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tresult.rotate = 90;\r\n\t\t\t\tresult.flip.vertical = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\r\n\t\t\t\tresult.rotate = 90;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 7:\r\n\t\t\t\tresult.rotate = 90;\r\n\t\t\t\tresult.flip.horizontal = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 8:\r\n\t\t\t\tresult.rotate = -90;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n}\r\nfunction getImageData(img) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\ttry {\r\n\t\t\tif (img) {\r\n\t\t\t\tif (/^data:/i.test(img)) {\r\n\t\t\t\t\t// Data URL\r\n\t\t\t\t\tresolve(base64ToArrayBuffer(img));\r\n\t\t\t\t} else if (/^blob:/i.test(img)) {\r\n\t\t\t\t\t// Blob\r\n\t\t\t\t\tconst fileReader = new FileReader();\r\n\t\t\t\t\tfileReader.onload = function (e) {\r\n\t\t\t\t\t\tresolve(e.target.result);\r\n\t\t\t\t\t};\r\n\t\t\t\t\tobjectURLToBlob(img, function (blob) {\r\n\t\t\t\t\t\tfileReader.readAsArrayBuffer(blob);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Simple URL\r\n\t\t\t\t\tlet http = new XMLHttpRequest();\r\n\t\t\t\t\thttp.onreadystatechange = function () {\r\n\t\t\t\t\t\tif (http.readyState !== XHR_DONE) return;\r\n\r\n\t\t\t\t\t\tif (http.status === 200 || http.status === 0) {\r\n\t\t\t\t\t\t\tresolve(http.response);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treject('Warning: could not load an image to parse its orientation');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\thttp = null;\r\n\t\t\t\t\t};\r\n\t\t\t\t\thttp.onprogress = function () {\r\n\t\t\t\t\t\t// Abort the request directly if it not a JPEG image for better performance\r\n\t\t\t\t\t\tif (http.getResponseHeader('content-type') !== 'image/jpeg') {\r\n\t\t\t\t\t\t\thttp.abort();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t\thttp.withCredentials = false;\r\n\t\t\t\t\thttp.open('GET', img, true);\r\n\t\t\t\t\thttp.responseType = 'arraybuffer';\r\n\t\t\t\t\thttp.send(null);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treject('Error: the image is empty');\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\treject(e);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nexport function getStyleTransforms({ rotate, flip, scaleX, scaleY }) {\r\n\tlet transform = '';\r\n\ttransform += ` rotate(${rotate}deg) `;\r\n\ttransform += ` scaleX(${scaleX * (flip.horizontal ? -1 : 1)}) `;\r\n\ttransform += ` scaleY(${scaleY * (flip.vertical ? -1 : 1)}) `;\r\n\treturn transform;\r\n}\r\n\r\nfunction getStringFromCharCode(dataView, start, length) {\r\n\tlet str = '';\r\n\tlet i;\r\n\tfor (i = start, length += start; i < length; i++) {\r\n\t\tstr += String.fromCharCode(dataView.getUint8(i));\r\n\t}\r\n\treturn str;\r\n}\r\n\r\nfunction resetAndGetOrientation(arrayBuffer) {\r\n\ttry {\r\n\t\tconst dataView = new DataView(arrayBuffer);\r\n\t\tlet orientation;\r\n\t\tlet exifIDCode;\r\n\t\tlet tiffOffset;\r\n\t\tlet littleEndian;\r\n\t\tlet app1Start;\r\n\t\tlet ifdStart;\r\n\t\t// Only handle JPEG image (start by 0xFFD8)\r\n\t\tif (dataView.getUint8(0) === 0xff && dataView.getUint8(1) === 0xd8) {\r\n\t\t\tconst length = dataView.byteLength;\r\n\t\t\tlet offset = 2;\r\n\t\t\twhile (offset + 1 < length) {\r\n\t\t\t\tif (dataView.getUint8(offset) === 0xff && dataView.getUint8(offset + 1) === 0xe1) {\r\n\t\t\t\t\tapp1Start = offset;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\toffset++;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (app1Start) {\r\n\t\t\texifIDCode = app1Start + 4;\r\n\t\t\ttiffOffset = app1Start + 10;\r\n\t\t\tif (getStringFromCharCode(dataView, exifIDCode, 4) === 'Exif') {\r\n\t\t\t\tconst endianness = dataView.getUint16(tiffOffset);\r\n\r\n\t\t\t\tlittleEndian = endianness === 0x4949;\r\n\r\n\t\t\t\tif (littleEndian || endianness === 0x4d4d /* bigEndian */) {\r\n\t\t\t\t\tif (dataView.getUint16(tiffOffset + 2, littleEndian) === 0x002a) {\r\n\t\t\t\t\t\tconst firstIFDOffset = dataView.getUint32(tiffOffset + 4, littleEndian);\r\n\t\t\t\t\t\tif (firstIFDOffset >= 0x00000008) {\r\n\t\t\t\t\t\t\tifdStart = tiffOffset + firstIFDOffset;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (ifdStart) {\r\n\t\t\tconst length = dataView.getUint16(ifdStart, littleEndian);\r\n\r\n\t\t\tfor (let i = 0; i < length; i++) {\r\n\t\t\t\tlet offset = ifdStart + i * 12 + 2;\r\n\t\t\t\tif (dataView.getUint16(offset, littleEndian) === 0x0112 /* Orientation */) {\r\n\t\t\t\t\t// 8 is the offset of the current tag's value\r\n\t\t\t\t\toffset += 8;\r\n\t\t\t\t\t// Get the original orientation value\r\n\t\t\t\t\torientation = dataView.getUint16(offset, littleEndian);\r\n\t\t\t\t\t// Override the orientation with its default value\r\n\t\t\t\t\tdataView.setUint16(offset, 1, littleEndian);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn orientation;\r\n\t} catch (error) {\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nexport function parseImage(src: string) {\r\n\treturn new Promise((resolve) => {\r\n\t\tgetImageData(src)\r\n\t\t\t.then((data) => {\r\n\t\t\t\tconst orientation = resetAndGetOrientation(data);\r\n\t\t\t\tresolve(\r\n\t\t\t\t\tdata\r\n\t\t\t\t\t\t? { source: src, arrayBuffer: data, orientation }\r\n\t\t\t\t\t\t: { source: src, arrayBuffer: null, orientation: null },\r\n\t\t\t\t);\r\n\t\t\t})\r\n\t\t\t.catch((error) => {\r\n\t\t\t\tconsole.warn(error);\r\n\t\t\t\tresolve({ source: src, arrayBuffer: null, orientation: null });\r\n\t\t\t});\r\n\t});\r\n}\r\n\r\nexport function arrayBufferToDataURL(arrayBuffer) {\r\n\tconst chunks = [];\r\n\r\n\t// Chunk Typed Array for better performance\r\n\tconst chunkSize = 8192;\r\n\tlet uint8 = new Uint8Array(arrayBuffer);\r\n\r\n\twhile (uint8.length > 0) {\r\n\t\tconst value = uint8.subarray(0, chunkSize);\r\n\t\tchunks.push(String.fromCharCode.apply(null, Array.from ? Array.from(value) : value.slice()));\r\n\t\tuint8 = uint8.subarray(chunkSize);\r\n\t}\r\n\r\n\treturn `data:image/jpeg;base64,${btoa(chunks.join(''))}`;\r\n}\r\n","<script>\r\nimport bem from 'easy-bem';\r\nimport classnames from 'classnames';\r\nimport { radians } from '../../core';\r\nimport { getStyleTransforms } from '../../core/image';\r\nimport { rotateSize } from '../../core/service';\r\n\r\nconst cn = bem('vue-preview-result');\r\n\r\nexport default {\r\n\tname: 'PreviewResult',\r\n\tprops: {\r\n\t\timage: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\ttransitions: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\tstencilCoordinates: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {\r\n\t\t\t\t\twidth: 0,\r\n\t\t\t\t\theight: 0,\r\n\t\t\t\t\tleft: 0,\r\n\t\t\t\t\ttop: 0,\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t},\r\n\t\timageClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t},\r\n\tcomputed: {\r\n\t\tclasses() {\r\n\t\t\treturn {\r\n\t\t\t\troot: cn(),\r\n\t\t\t\twrapper: cn('wrapper'),\r\n\t\t\t\timageWrapper: cn('image-wrapper'),\r\n\t\t\t\timage: classnames(cn('image'), this.imageClass),\r\n\t\t\t};\r\n\t\t},\r\n\t\twrapperStyle() {\r\n\t\t\tconst result = {\r\n\t\t\t\twidth: `${this.stencilCoordinates.width}px`,\r\n\t\t\t\theight: `${this.stencilCoordinates.height}px`,\r\n\t\t\t\tleft: `calc(50% - ${this.stencilCoordinates.width / 2}px)`,\r\n\t\t\t\ttop: `calc(50% - ${this.stencilCoordinates.height / 2}px)`,\r\n\t\t\t};\r\n\t\t\tif (this.transitions && this.transitions.enabled) {\r\n\t\t\t\tresult.transition = `${this.transitions.time}ms ${this.transitions.timingFunction}`;\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\timageStyle() {\r\n\t\t\tconst imageTransforms = this.image.transforms;\r\n\r\n\t\t\tconst virtualSize = rotateSize(\r\n\t\t\t\t{\r\n\t\t\t\t\twidth: this.image.width,\r\n\t\t\t\t\theight: this.image.height,\r\n\t\t\t\t},\r\n\t\t\t\timageTransforms.rotate,\r\n\t\t\t);\r\n\r\n\t\t\tconst result = {\r\n\t\t\t\twidth: `${this.image.width}px`,\r\n\t\t\t\theight: `${this.image.height}px`,\r\n\t\t\t\tleft: '0px',\r\n\t\t\t\ttop: '0px',\r\n\t\t\t};\r\n\r\n\t\t\tconst compensations = {\r\n\t\t\t\trotate: {\r\n\t\t\t\t\tleft: ((this.image.width - virtualSize.width) * imageTransforms.scaleX) / 2,\r\n\t\t\t\t\ttop: ((this.image.height - virtualSize.height) * imageTransforms.scaleY) / 2,\r\n\t\t\t\t},\r\n\t\t\t\tscale: {\r\n\t\t\t\t\tleft: ((1 - imageTransforms.scaleX) * this.image.width) / 2,\r\n\t\t\t\t\ttop: ((1 - imageTransforms.scaleY) * this.image.height) / 2,\r\n\t\t\t\t},\r\n\t\t\t};\r\n\r\n\t\t\tresult.transform =\r\n\t\t\t\t`translate(\r\n\t\t\t\t${\r\n\t\t\t\t\t-this.stencilCoordinates.left -\r\n\t\t\t\t\timageTransforms.translateX -\r\n\t\t\t\t\tcompensations.rotate.left -\r\n\t\t\t\t\tcompensations.scale.left\r\n\t\t\t\t}px,${\r\n\t\t\t\t\t-this.stencilCoordinates.top -\r\n\t\t\t\t\timageTransforms.translateY -\r\n\t\t\t\t\tcompensations.rotate.top -\r\n\t\t\t\t\tcompensations.scale.top\r\n\t\t\t\t}px) ` + getStyleTransforms(imageTransforms);\r\n\r\n\t\t\tif (this.transitions && this.transitions.enabled) {\r\n\t\t\t\tresult.transition = `${this.transitions.time}ms ${this.transitions.timingFunction}`;\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t},\r\n\t},\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<div :class=\"classes.root\">\r\n\t\t<div ref=\"wrapper\" :class=\"classes.wrapper\" :style=\"wrapperStyle\">\r\n\t\t\t<img ref=\"image\" :src=\"image.src\" :class=\"classes.image\" :style=\"imageStyle\" />\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.vue-preview-result {\r\n\toverflow: hidden;\r\n\tbox-sizing: border-box;\r\n\tposition: absolute;\r\n\theight: 100%;\r\n\twidth: 100%;\r\n\t&__wrapper {\r\n\t\tposition: absolute;\r\n\t}\r\n\r\n\t&__image {\r\n\t\tpointer-events: none;\r\n\t\tposition: relative;\r\n\t\tuser-select: none;\r\n\t\ttransform-origin: center;\r\n\t\t// Workaround to prevent bugs at the websites with max-width\r\n\t\t// rule applied to img (Vuepress for example)\r\n\t\tmax-width: none !important;\r\n\t}\r\n}\r\n</style>\r\n","import { distance } from './utils';\r\n\r\nexport function calculateGeometricProperties(touches: Touch[], container: HTMLElement) {\r\n\tconst { left, top } = container.getBoundingClientRect();\r\n\r\n\tconst centerMass = { left: 0, top: 0 };\r\n\tlet spread = 0;\r\n\r\n\ttouches.forEach((touch) => {\r\n\t\tcenterMass.left += (touch.clientX - left) / touches.length;\r\n\t\tcenterMass.top += (touch.clientY - top) / touches.length;\r\n\t});\r\n\r\n\ttouches.forEach((touch) => {\r\n\t\tspread += distance(\r\n\t\t\t{ x: centerMass.left, y: centerMass.top },\r\n\t\t\t{ x: touch.clientX - left, y: touch.clientY - top },\r\n\t\t);\r\n\t});\r\n\r\n\treturn { centerMass, spread, count: touches.length };\r\n}\r\n","<script>\r\nimport { ManipulateImageEvent } from '../../core/events.ts';\r\nimport { calculateGeometricProperties } from '../../core/touch';\r\nimport { sign } from '../../core/utils';\r\n\r\nexport default {\r\n\tname: 'CropperWrapper',\r\n\tprops: {\r\n\t\ttouchMove: {\r\n\t\t\ttype: Boolean,\r\n\t\t\trequired: true,\r\n\t\t},\r\n\t\tmouseMove: {\r\n\t\t\ttype: Boolean,\r\n\t\t\trequired: true,\r\n\t\t},\r\n\t\ttouchResize: {\r\n\t\t\ttype: Boolean,\r\n\t\t\trequired: true,\r\n\t\t},\r\n\t\twheelResize: {\r\n\t\t\ttype: [Boolean, Object],\r\n\t\t\trequired: true,\r\n\t\t},\r\n\t},\r\n\tbeforeMount() {\r\n\t\twindow.addEventListener('mouseup', this.onMouseUp, { passive: false });\r\n\t\twindow.addEventListener('mousemove', this.onMouseMove, { passive: false });\r\n\t\twindow.addEventListener('touchmove', this.onTouchMove, { passive: false });\r\n\t\twindow.addEventListener('touchend', this.onTouchEnd, { passive: false });\r\n\t},\r\n\tbeforeUnmount() {\r\n\t\twindow.removeEventListener('mouseup', this.onMouseUp);\r\n\t\twindow.removeEventListener('mousemove', this.onMouseMove);\r\n\t\twindow.removeEventListener('touchmove', this.onTouchMove);\r\n\t\twindow.removeEventListener('touchend', this.onTouchEnd);\r\n\t},\r\n\tmounted() {\r\n\t\tthis.touches = [];\r\n\t},\r\n\tmethods: {\r\n\t\tonTouchStart(e) {\r\n\t\t\tif (e.cancelable && (this.touchMove || (this.touchResize && e.touches.length > 1))) {\r\n\t\t\t\tconst container = this.$refs.container;\r\n\t\t\t\tconst { left, top, bottom, right } = container.getBoundingClientRect();\r\n\t\t\t\tthis.touches = [...e.touches].filter(\r\n\t\t\t\t\t(touch) =>\r\n\t\t\t\t\t\ttouch.clientX > left && touch.clientX < right && touch.clientY > top && touch.clientY < bottom,\r\n\t\t\t\t);\r\n\t\t\t\tthis.oldGeometricProperties = calculateGeometricProperties(this.touches, container);\r\n\r\n\t\t\t\tif (e.preventDefault) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t},\r\n\t\tonTouchEnd(e) {\r\n\t\t\tif (e.touches.length === 0) {\r\n\t\t\t\tthis.processEnd();\r\n\t\t\t}\r\n\t\t},\r\n\t\tonTouchMove(e) {\r\n\t\t\tif (this.touches.length) {\r\n\t\t\t\tconst touches = [...e.touches].filter(\r\n\t\t\t\t\t(touch) =>\r\n\t\t\t\t\t\t!touch.identifier ||\r\n\t\t\t\t\t\tthis.touches.find((anotherTouch) => anotherTouch.identifier === touch.identifier),\r\n\t\t\t\t);\r\n\t\t\t\tthis.processMove(e, touches);\r\n\t\t\t\tif (e.preventDefault) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t\tif (e.stopPropagation) {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tonMouseDown(e) {\r\n\t\t\tif (this.mouseMove && 'buttons' in e && e.buttons === 1) {\r\n\t\t\t\tconst touch = {\r\n\t\t\t\t\tfake: true,\r\n\t\t\t\t\tclientX: e.clientX,\r\n\t\t\t\t\tclientY: e.clientY,\r\n\t\t\t\t};\r\n\t\t\t\tthis.touches = [touch];\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t},\r\n\t\tonMouseMove(e) {\r\n\t\t\tif (this.touches.length) {\r\n\t\t\t\tthis.processMove(e, [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfake: true,\r\n\t\t\t\t\t\tclientX: e.clientX,\r\n\t\t\t\t\t\tclientY: e.clientY,\r\n\t\t\t\t\t},\r\n\t\t\t\t]);\r\n\t\t\t\tif (e.preventDefault && e.cancelable) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tonMouseUp() {\r\n\t\t\tthis.touches = [];\r\n\t\t},\r\n\t\tprocessMove(event, newTouches) {\r\n\t\t\tif (this.touches.length) {\r\n\t\t\t\tif (this.touches.length === 1 && newTouches.length === 1) {\r\n\t\t\t\t\tthis.$emit(\r\n\t\t\t\t\t\t'move',\r\n\t\t\t\t\t\tnew ManipulateImageEvent({\r\n\t\t\t\t\t\t\tleft: this.touches[0].clientX - newTouches[0].clientX,\r\n\t\t\t\t\t\t\ttop: this.touches[0].clientY - newTouches[0].clientY,\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t);\r\n\t\t\t\t} else if (this.touches.length > 1 && this.touchResize) {\r\n\t\t\t\t\tconst newProperties = calculateGeometricProperties(newTouches, this.$refs.container);\r\n\t\t\t\t\tconst oldProperties = this.oldGeometricProperties;\r\n\r\n\t\t\t\t\tif (oldProperties.count === newProperties.count && oldProperties.count > 1) {\r\n\t\t\t\t\t\tthis.$emit(\r\n\t\t\t\t\t\t\t'resize',\r\n\t\t\t\t\t\t\tnew ManipulateImageEvent(\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tleft: oldProperties.centerMass.left - newProperties.centerMass.left,\r\n\t\t\t\t\t\t\t\t\ttop: oldProperties.centerMass.top - newProperties.centerMass.top,\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tfactor: oldProperties.spread / newProperties.spread,\r\n\t\t\t\t\t\t\t\t\tcenter: newProperties.centerMass,\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.oldGeometricProperties = newProperties;\r\n\t\t\t\t}\r\n\t\t\t\tthis.touches = newTouches;\r\n\t\t\t}\r\n\t\t},\r\n\t\tprocessEnd() {\r\n\t\t\tthis.touches = [];\r\n\t\t},\r\n\t\tonWheel(event) {\r\n\t\t\tif (this.wheelResize) {\r\n\t\t\t\tconst container = this.$refs.container;\r\n\t\t\t\tconst { left, top } = container.getBoundingClientRect();\r\n\t\t\t\tconst factor = 1 + this.wheelResize.ratio * sign(event.deltaY || event.detail || event.wheelDelta);\r\n\t\t\t\tconst center = {\r\n\t\t\t\t\tleft: event.clientX - left,\r\n\t\t\t\t\ttop: event.clientY - top,\r\n\t\t\t\t};\r\n\r\n\t\t\t\tthis.$emit('resize', new ManipulateImageEvent({}, { factor, center }));\r\n\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tevent.stopPropagation();\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n\temits: ['resize', 'resize-end', 'move', 'move-end'],\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<div ref=\"container\" @touchstart=\"onTouchStart\" @mousedown=\"onMouseDown\" @wheel=\"onWheel\">\r\n\t\t<slot />\r\n\t</div>\r\n</template>\r\n","<script>\r\nimport classnames from 'classnames';\r\nimport bem from 'easy-bem';\r\nimport { radians } from '../../core';\r\nimport { getStyleTransforms } from '../../core/image';\r\nimport { rotateSize } from '../../core/service';\r\nconst cn = bem('vue-preview');\r\nexport default {\r\n\tprops: {\r\n\t\tcoordinates: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\ttransitions: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\timage: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\timageClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\twidth: {\r\n\t\t\ttype: Number,\r\n\t\t},\r\n\t\theight: {\r\n\t\t\ttype: Number,\r\n\t\t},\r\n\t\tfill: {\r\n\t\t\ttype: Boolean,\r\n\t\t},\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tcalculatedImageSize: {\r\n\t\t\t\twidth: 0,\r\n\t\t\t\theight: 0,\r\n\t\t\t},\r\n\t\t\tcalculatedSize: {\r\n\t\t\t\twidth: 0,\r\n\t\t\t\theight: 0,\r\n\t\t\t},\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\tclasses() {\r\n\t\t\treturn {\r\n\t\t\t\troot: cn({ fill: this.fill }),\r\n\t\t\t\twrapper: cn('wrapper'),\r\n\t\t\t\timageWrapper: cn('image-wrapper'),\r\n\t\t\t\timage: classnames(cn('image'), this.imageClass),\r\n\t\t\t};\r\n\t\t},\r\n\t\tstyle() {\r\n\t\t\tif (!this.fill) {\r\n\t\t\t\tconst result = {};\r\n\t\t\t\tif (this.width) {\r\n\t\t\t\t\tresult.width = `${this.size.width}px`;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.height) {\r\n\t\t\t\t\tresult.height = `${this.size.height}px`;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.transitions && this.transitions.enabled) {\r\n\t\t\t\t\tresult.transition = `${this.transitions.time}ms ${this.transitions.timingFunction}`;\r\n\t\t\t\t}\r\n\t\t\t\treturn result;\r\n\t\t\t} else {\r\n\t\t\t\treturn {};\r\n\t\t\t}\r\n\t\t},\r\n\t\twrapperStyle() {\r\n\t\t\tconst result = {\r\n\t\t\t\twidth: `${this.size.width}px`,\r\n\t\t\t\theight: `${this.size.height}px`,\r\n\t\t\t\tleft: `calc(50% - ${this.size.width / 2}px)`,\r\n\t\t\t\ttop: `calc(50% - ${this.size.height / 2}px)`,\r\n\t\t\t};\r\n\t\t\tif (this.transitions && this.transitions.enabled) {\r\n\t\t\t\tresult.transition = `${this.transitions.time}ms ${this.transitions.timingFunction}`;\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\timageStyle() {\r\n\t\t\tif (this.coordinates && this.image) {\r\n\t\t\t\tconst coefficient = this.coordinates.width / this.size.width;\r\n\t\t\t\tconst transforms = {\r\n\t\t\t\t\trotate: 0,\r\n\t\t\t\t\tflip: {\r\n\t\t\t\t\t\thorizontal: false,\r\n\t\t\t\t\t\tvertical: false,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t...this.image.transforms,\r\n\t\t\t\t\tscaleX: 1 / coefficient,\r\n\t\t\t\t\tscaleY: 1 / coefficient,\r\n\t\t\t\t};\r\n\t\t\t\tconst width = this.imageSize.width;\r\n\t\t\t\tconst height = this.imageSize.height;\r\n\t\t\t\tconst virtualSize = rotateSize(\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\twidth,\r\n\t\t\t\t\t\theight,\r\n\t\t\t\t\t},\r\n\t\t\t\t\ttransforms.rotate,\r\n\t\t\t\t);\r\n\t\t\t\tconst result = {\r\n\t\t\t\t\twidth: `${width}px`,\r\n\t\t\t\t\theight: `${height}px`,\r\n\t\t\t\t\tleft: '0px',\r\n\t\t\t\t\ttop: '0px',\r\n\t\t\t\t};\r\n\t\t\t\tconst compensations = {\r\n\t\t\t\t\trotate: {\r\n\t\t\t\t\t\tleft: ((width - virtualSize.width) * transforms.scaleX) / 2,\r\n\t\t\t\t\t\ttop: ((height - virtualSize.height) * transforms.scaleY) / 2,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tscale: {\r\n\t\t\t\t\t\tleft: ((1 - transforms.scaleX) * width) / 2,\r\n\t\t\t\t\t\ttop: ((1 - transforms.scaleY) * height) / 2,\r\n\t\t\t\t\t},\r\n\t\t\t\t};\r\n\t\t\t\tresult.transform =\r\n\t\t\t\t\t`translate(\r\n\t\t\t\t${-this.coordinates.left / coefficient - compensations.rotate.left - compensations.scale.left}px,${\r\n\t\t\t\t\t\t-this.coordinates.top / coefficient - compensations.rotate.top - compensations.scale.top\r\n\t\t\t\t\t}px) ` + getStyleTransforms(transforms);\r\n\t\t\t\tif (this.transitions && this.transitions.enabled) {\r\n\t\t\t\t\tresult.transition = `${this.transitions.time}ms ${this.transitions.timingFunction}`;\r\n\t\t\t\t}\r\n\t\t\t\treturn result;\r\n\t\t\t} else {\r\n\t\t\t\treturn {};\r\n\t\t\t}\r\n\t\t},\r\n\t\tsize() {\r\n\t\t\treturn {\r\n\t\t\t\twidth: this.width || this.calculatedSize.width,\r\n\t\t\t\theight: this.height || this.calculatedSize.height,\r\n\t\t\t};\r\n\t\t},\r\n\t\timageSize() {\r\n\t\t\treturn {\r\n\t\t\t\twidth: this.image.width || this.calculatedImageSize.width,\r\n\t\t\t\theight: this.image.height || this.calculatedImageSize.height,\r\n\t\t\t};\r\n\t\t},\r\n\t},\r\n\twatch: {\r\n\t\timage(value) {\r\n\t\t\tif (value.width || value.height) {\r\n\t\t\t\tthis.onChangeImage();\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n\tmounted() {\r\n\t\tthis.onChangeImage();\r\n\t\tthis.$refs.image.addEventListener('load', () => {\r\n\t\t\tthis.refreshImage();\r\n\t\t});\r\n\t\twindow.addEventListener('resize', this.refresh);\r\n\t\twindow.addEventListener('orientationchange', this.refresh);\r\n\t},\r\n\tunmounted() {\r\n\t\twindow.removeEventListener('resize', this.refresh);\r\n\t\twindow.removeEventListener('orientationchange', this.refresh);\r\n\t},\r\n\tmethods: {\r\n\t\trefreshImage() {\r\n\t\t\tconst image = this.$refs.image;\r\n\t\t\tthis.calculatedImageSize.height = image.naturalHeight;\r\n\t\t\tthis.calculatedImageSize.width = image.naturalWidth;\r\n\t\t},\r\n\t\trefresh() {\r\n\t\t\tconst root = this.$refs.root;\r\n\t\t\tif (!this.width) {\r\n\t\t\t\tthis.calculatedSize.width = root.clientWidth;\r\n\t\t\t}\r\n\t\t\tif (!this.height) {\r\n\t\t\t\tthis.calculatedSize.height = root.clientHeight;\r\n\t\t\t}\r\n\t\t},\r\n\t\tonChangeImage() {\r\n\t\t\tconst image = this.$refs.image;\r\n\t\t\tif (image && image.complete) {\r\n\t\t\t\tthis.refreshImage();\r\n\t\t\t}\r\n\t\t\tthis.refresh();\r\n\t\t},\r\n\t},\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<div ref=\"root\" :class=\"classes.root\" :style=\"style\">\r\n\t\t<div ref=\"wrapper\" :class=\"classes.wrapper\" :style=\"wrapperStyle\">\r\n\t\t\t<img\r\n\t\t\t\tv-show=\"image && image.src\"\r\n\t\t\t\tref=\"image\"\r\n\t\t\t\t:src=\"image && image.src\"\r\n\t\t\t\t:class=\"classes.image\"\r\n\t\t\t\t:style=\"imageStyle\"\r\n\t\t\t/>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.vue-preview {\r\n\toverflow: hidden;\r\n\tbox-sizing: border-box;\r\n\tposition: relative;\r\n\t&--fill {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tposition: absolute;\r\n\t}\r\n\t&__wrapper {\r\n\t\tposition: absolute;\r\n\t\theight: 100%;\r\n\t\twidth: 100%;\r\n\t}\r\n\t&__image {\r\n\t\tpointer-events: none;\r\n\t\tposition: absolute;\r\n\t\tuser-select: none;\r\n\t\ttransform-origin: center;\r\n\t\t// Workaround to prevent bugs at the websites with max-width\r\n\t\t// rule applied to img (Vuepress for example)\r\n\t\tmax-width: none !important;\r\n\t}\r\n}\r\n</style>\r\n","<script>\r\nimport bem from 'easy-bem';\r\nimport { Preview } from '../../components/helpers';\r\n\r\nexport default {\r\n\tcomponents: {\r\n\t\tPreview,\r\n\t},\r\n\tinheritAttrs: false,\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<preview v-bind=\"$attrs\" :fill=\"true\" />\r\n</template>\r\n","<script>\r\nimport classnames from 'classnames';\r\nimport bem from 'easy-bem';\r\nimport { BoundingBox, DraggableArea, StencilPreview } from '../service';\r\nimport { SimpleHandler } from '../handlers';\r\nimport { SimpleLine } from '../lines';\r\n\r\nconst cn = bem('vue-rectangle-stencil');\r\n\r\nexport default {\r\n\tname: 'RectangleStencil',\r\n\tcomponents: {\r\n\t\tStencilPreview,\r\n\t\tBoundingBox,\r\n\t\tDraggableArea,\r\n\t},\r\n\tprops: {\r\n\t\timage: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\tcoordinates: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\tstencilCoordinates: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\thandlers: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\thandlersComponent: {\r\n\t\t\ttype: [Object, String],\r\n\t\t\tdefault() {\r\n\t\t\t\treturn SimpleHandler;\r\n\t\t\t},\r\n\t\t},\r\n\t\tlines: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\tlinesComponent: {\r\n\t\t\ttype: [Object, String],\r\n\t\t\tdefault() {\r\n\t\t\t\treturn SimpleLine;\r\n\t\t\t},\r\n\t\t},\r\n\t\taspectRatio: {\r\n\t\t\ttype: [Number, String],\r\n\t\t},\r\n\t\tminAspectRatio: {\r\n\t\t\ttype: [Number, String],\r\n\t\t},\r\n\t\tmaxAspectRatio: {\r\n\t\t\ttype: [Number, String],\r\n\t\t},\r\n\t\tmovable: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true,\r\n\t\t},\r\n\t\tresizable: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true,\r\n\t\t},\r\n\t\ttransitions: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\tmovingClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tresizingClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tpreviewClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tboundingBoxClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tlinesClasses: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\tlinesWrappersClasses: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\thandlersClasses: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\thandlersWrappersClasses: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tmoving: false,\r\n\t\t\tresizing: false,\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\tclasses() {\r\n\t\t\treturn {\r\n\t\t\t\tstencil: classnames(\r\n\t\t\t\t\tcn({ movable: this.movable, moving: this.moving, resizing: this.resizing }),\r\n\t\t\t\t\tthis.moving && this.movingClass,\r\n\t\t\t\t\tthis.resizing && this.resizingClass,\r\n\t\t\t\t),\r\n\t\t\t\tpreview: classnames(cn('preview'), this.previewClass),\r\n\t\t\t\tboundingBox: classnames(cn('bounding-box'), this.boundingBoxClass),\r\n\t\t\t};\r\n\t\t},\r\n\t\tstyle() {\r\n\t\t\tconst { height, width, left, top } = this.stencilCoordinates;\r\n\r\n\t\t\tconst style = {\r\n\t\t\t\twidth: `${width}px`,\r\n\t\t\t\theight: `${height}px`,\r\n\t\t\t\ttransform: `translate(${left}px, ${top}px)`,\r\n\t\t\t};\r\n\r\n\t\t\tif (this.transitions && this.transitions.enabled) {\r\n\t\t\t\tstyle.transition = `${this.transitions.time}ms ${this.transitions.timingFunction}`;\r\n\t\t\t}\r\n\t\t\treturn style;\r\n\t\t},\r\n\t},\r\n\tmethods: {\r\n\t\tonMove(moveEvent) {\r\n\t\t\tthis.$emit('move', moveEvent);\r\n\t\t\tthis.moving = true;\r\n\t\t},\r\n\t\tonMoveEnd() {\r\n\t\t\tthis.$emit('move-end');\r\n\t\t\tthis.moving = false;\r\n\t\t},\r\n\t\tonResize(resizeEvent) {\r\n\t\t\tthis.$emit('resize', resizeEvent);\r\n\t\t\tthis.resizing = true;\r\n\t\t},\r\n\t\tonResizeEnd() {\r\n\t\t\tthis.$emit('resize-end');\r\n\t\t\tthis.resizing = false;\r\n\t\t},\r\n\t\taspectRatios() {\r\n\t\t\treturn {\r\n\t\t\t\tminimum: this.aspectRatio || this.minAspectRatio,\r\n\t\t\t\tmaximum: this.aspectRatio || this.maxAspectRatio,\r\n\t\t\t};\r\n\t\t},\r\n\t},\r\n\temits: ['resize', 'resize-end', 'move', 'move-end'],\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<div :class=\"classes.stencil\" :style=\"style\">\r\n\t\t<bounding-box\r\n\t\t\t:width=\"stencilCoordinates.width\"\r\n\t\t\t:height=\"stencilCoordinates.height\"\r\n\t\t\t:transitions=\"transitions\"\r\n\t\t\t:class=\"classes.boundingBox\"\r\n\t\t\t:handlers=\"handlers\"\r\n\t\t\t:handlers-component=\"handlersComponent\"\r\n\t\t\t:handlers-classes=\"handlersClasses\"\r\n\t\t\t:handlers-wrappers-classes=\"handlersWrappersClasses\"\r\n\t\t\t:lines=\"lines\"\r\n\t\t\t:lines-component=\"linesComponent\"\r\n\t\t\t:lines-classes=\"linesClasses\"\r\n\t\t\t:lines-wrappers-classes=\"linesWrappersClasses\"\r\n\t\t\t:resizable=\"resizable\"\r\n\t\t\t@resize=\"onResize\"\r\n\t\t\t@resize-end=\"onResizeEnd\"\r\n\t\t>\r\n\t\t\t<draggable-area :movable=\"movable\" @move=\"onMove\" @move-end=\"onMoveEnd\">\r\n\t\t\t\t<stencil-preview\r\n\t\t\t\t\t:image=\"image\"\r\n\t\t\t\t\t:coordinates=\"coordinates\"\r\n\t\t\t\t\t:width=\"stencilCoordinates.width\"\r\n\t\t\t\t\t:height=\"stencilCoordinates.height\"\r\n\t\t\t\t\t:class=\"classes.preview\"\r\n\t\t\t\t\t:transitions=\"transitions\"\r\n\t\t\t\t/>\r\n\t\t\t</draggable-area>\r\n\t\t</bounding-box>\r\n\t</div>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.vue-rectangle-stencil {\r\n\tposition: absolute;\r\n\theight: 100%;\r\n\twidth: 100%;\r\n\tbox-sizing: border-box;\r\n\t&__preview {\r\n\t\tposition: absolute;\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n\t&--movable {\r\n\t\tcursor: move;\r\n\t}\r\n}\r\n</style>\r\n","<script>\r\nimport classnames from 'classnames';\r\nimport bem from 'easy-bem';\r\nimport { BoundingBox, DraggableArea, StencilPreview } from '../service';\r\nimport { SimpleHandler } from '../handlers';\r\nimport { SimpleLine } from '../lines';\r\n\r\nconst cn = bem('vue-circle-stencil');\r\n\r\nexport default {\r\n\tcomponents: {\r\n\t\tStencilPreview,\r\n\t\tBoundingBox,\r\n\t\tDraggableArea,\r\n\t},\r\n\tprops: {\r\n\t\timage: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\tcoordinates: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\tstencilCoordinates: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\thandlers: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {\r\n\t\t\t\t\teastNorth: true,\r\n\t\t\t\t\twestNorth: true,\r\n\t\t\t\t\twestSouth: true,\r\n\t\t\t\t\teastSouth: true,\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t},\r\n\t\thandlersComponent: {\r\n\t\t\ttype: [Object, String],\r\n\t\t\tdefault() {\r\n\t\t\t\treturn SimpleHandler;\r\n\t\t\t},\r\n\t\t},\r\n\t\thandlersClasses: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\thandlersWrappersClasses: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\tlines: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\tlinesComponent: {\r\n\t\t\ttype: [Object, String],\r\n\t\t\tdefault() {\r\n\t\t\t\treturn SimpleLine;\r\n\t\t\t},\r\n\t\t},\r\n\t\tlinesClasses: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\tlinesWrappersClasses: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\tmovable: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true,\r\n\t\t},\r\n\t\tresizable: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true,\r\n\t\t},\r\n\t\ttransitions: {\r\n\t\t\ttype: Object,\r\n\t\t},\r\n\t\tmovingClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tresizingClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tpreviewClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tboundingBoxClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tmoving: false,\r\n\t\t\tresizing: false,\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\tclasses() {\r\n\t\t\treturn {\r\n\t\t\t\tstencil: classnames(\r\n\t\t\t\t\tcn({ movable: this.movable, moving: this.moving, resizing: this.resizing }),\r\n\t\t\t\t\tthis.moving && this.movingClass,\r\n\t\t\t\t\tthis.resizing && this.resizingClass,\r\n\t\t\t\t),\r\n\t\t\t\tpreview: classnames(cn('preview'), this.previewClass),\r\n\t\t\t\tboundingBox: classnames(cn('bounding-box'), this.boundingBoxClass),\r\n\t\t\t};\r\n\t\t},\r\n\t\tstyle() {\r\n\t\t\tconst { height, width, left, top } = this.stencilCoordinates;\r\n\r\n\t\t\tconst style = {\r\n\t\t\t\twidth: `${width}px`,\r\n\t\t\t\theight: `${height}px`,\r\n\t\t\t\ttransform: `translate(${left}px, ${top}px)`,\r\n\t\t\t};\r\n\r\n\t\t\tif (this.transitions && this.transitions.enabled) {\r\n\t\t\t\tstyle.transition = `${this.transitions.time}ms ${this.transitions.timingFunction}`;\r\n\t\t\t}\r\n\t\t\treturn style;\r\n\t\t},\r\n\t},\r\n\tmethods: {\r\n\t\tonMove(moveEvent) {\r\n\t\t\tthis.$emit('move', moveEvent);\r\n\t\t\tthis.moving = true;\r\n\t\t},\r\n\t\tonMoveEnd() {\r\n\t\t\tthis.$emit('move-end');\r\n\t\t\tthis.moving = false;\r\n\t\t},\r\n\t\tonResize(resizeEvent) {\r\n\t\t\tthis.$emit('resize', resizeEvent);\r\n\t\t\tthis.resizing = true;\r\n\t\t},\r\n\t\tonResizeEnd() {\r\n\t\t\tthis.$emit('resize-end');\r\n\t\t\tthis.resizing = false;\r\n\t\t},\r\n\t\taspectRatios() {\r\n\t\t\treturn {\r\n\t\t\t\tminimum: 1,\r\n\t\t\t\tmaximum: 1,\r\n\t\t\t};\r\n\t\t},\r\n\t},\r\n\temits: ['resize', 'resize-end', 'move', 'move-end'],\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<div :class=\"classes.stencil\" :style=\"style\">\r\n\t\t<bounding-box\r\n\t\t\t:width=\"stencilCoordinates.width\"\r\n\t\t\t:height=\"stencilCoordinates.height\"\r\n\t\t\t:transitions=\"transitions\"\r\n\t\t\t:class=\"classes.boundingBox\"\r\n\t\t\t:handlers=\"handlers\"\r\n\t\t\t:handlers-component=\"handlersComponent\"\r\n\t\t\t:handlers-classes=\"handlersClasses\"\r\n\t\t\t:handlers-wrappers-classes=\"handlersWrappersClasses\"\r\n\t\t\t:lines=\"lines\"\r\n\t\t\t:lines-component=\"linesComponent\"\r\n\t\t\t:lines-classes=\"linesClasses\"\r\n\t\t\t:lines-wrappers-classes=\"linesWrappersClasses\"\r\n\t\t\t:resizable=\"resizable\"\r\n\t\t\t@resize=\"onResize\"\r\n\t\t\t@resize-end=\"onResizeEnd\"\r\n\t\t>\r\n\t\t\t<draggable-area :movable=\"movable\" @move=\"onMove\" @move-end=\"onMoveEnd\">\r\n\t\t\t\t<stencil-preview\r\n\t\t\t\t\t:image=\"image\"\r\n\t\t\t\t\t:coordinates=\"coordinates\"\r\n\t\t\t\t\t:width=\"stencilCoordinates.width\"\r\n\t\t\t\t\t:height=\"stencilCoordinates.height\"\r\n\t\t\t\t\t:class=\"classes.preview\"\r\n\t\t\t\t\t:transitions=\"transitions\"\r\n\t\t\t\t/>\r\n\t\t\t</draggable-area>\r\n\t\t</bounding-box>\r\n\t</div>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.vue-circle-stencil {\r\n\tposition: absolute;\r\n\theight: 100%;\r\n\twidth: 100%;\r\n\tbox-sizing: content-box;\r\n\tcursor: move;\r\n\t&__preview {\r\n\t\tborder-radius: 50%;\r\n\t\tposition: absolute;\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n\t&--movable {\r\n\t\tcursor: move;\r\n\t}\r\n}\r\n</style>\r\n","<script>\r\nimport classnames from 'classnames';\r\nimport bem from 'easy-bem';\r\nimport debounce from 'debounce';\r\nimport { RectangleStencil } from './components/stencils';\r\nimport { CropperWrapper } from './components/service';\r\nimport {\r\n\tfillBoundaries,\r\n\tfitBoundaries,\r\n\tgetOptions,\r\n\tisBlob,\r\n\tisFunction,\r\n\tisLoadedImage,\r\n\tisNumber,\r\n\tisNumeric,\r\n\tisObject,\r\n\tlimitBy,\r\n\tradians,\r\n\treplacedProp,\r\n} from './core';\r\nimport { approximatedSize } from './core/algorithms';\r\nimport { updateCanvas } from './core/canvas';\r\nimport { ManipulateImageEvent } from './core/events';\r\nimport { isEqual, limitSizeRestrictions, limitsToSize, ratio } from './core/service';\r\nimport { isLocal, isCrossOriginURL, isUndefined, getSettings, parseNumber } from './core/utils';\r\nimport { arrayBufferToDataURL, getImageTransforms, getStyleTransforms, prepareSource, parseImage } from './core/image';\r\nimport { IMAGE_RESTRICTIONS, DEFAULT_COORDINATES } from './core/constants';\r\nimport * as algorithms from './core/algorithms';\r\n\r\nconst cn = bem('vue-advanced-cropper');\r\n\r\nexport default {\r\n\tname: 'Cropper',\r\n\tcomponents: {\r\n\t\tCropperWrapper,\r\n\t},\r\n\tprops: {\r\n\t\tsrc: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: null,\r\n\t\t},\r\n\t\tstencilComponent: {\r\n\t\t\ttype: [Object, String],\r\n\t\t\tdefault() {\r\n\t\t\t\treturn RectangleStencil;\r\n\t\t\t},\r\n\t\t},\r\n\t\tstencilProps: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault() {\r\n\t\t\t\treturn {};\r\n\t\t\t},\r\n\t\t},\r\n\t\tautoZoom: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false,\r\n\t\t},\r\n\t\timageClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tboundariesClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tbackgroundClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tforegroundClass: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tminWidth: {\r\n\t\t\ttype: [Number, String],\r\n\t\t},\r\n\t\tminHeight: {\r\n\t\t\ttype: [Number, String],\r\n\t\t},\r\n\t\tmaxWidth: {\r\n\t\t\ttype: [Number, String],\r\n\t\t},\r\n\t\tmaxHeight: {\r\n\t\t\ttype: [Number, String],\r\n\t\t},\r\n\t\tdebounce: {\r\n\t\t\ttype: [Boolean, Number],\r\n\t\t\tdefault: 500,\r\n\t\t},\r\n\t\ttransitions: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true,\r\n\t\t},\r\n\t\tcheckOrientation: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true,\r\n\t\t},\r\n\t\tcanvas: {\r\n\t\t\ttype: [Object, Boolean],\r\n\t\t\tdefault: true,\r\n\t\t},\r\n\t\tcrossOrigin: {\r\n\t\t\ttype: [Boolean, String],\r\n\t\t\tdefault: undefined,\r\n\t\t},\r\n\t\ttransitionTime: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 300,\r\n\t\t},\r\n\t\timageRestriction: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: 'fit-area',\r\n\t\t\tvalidator(value) {\r\n\t\t\t\treturn IMAGE_RESTRICTIONS.indexOf(value) !== -1;\r\n\t\t\t},\r\n\t\t},\r\n\t\troundResult: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true,\r\n\t\t},\r\n\t\tdefaultSize: {\r\n\t\t\ttype: [Function, Object],\r\n\t\t},\r\n\t\tdefaultPosition: {\r\n\t\t\ttype: [Function, Object],\r\n\t\t},\r\n\t\tdefaultVisibleArea: {\r\n\t\t\ttype: [Function, Object],\r\n\t\t},\r\n\t\tdefaultBoundaries: {\r\n\t\t\ttype: [Function, String],\r\n\t\t\tvalidator(value) {\r\n\t\t\t\tconst invalid = typeof value === 'string' && value !== 'fill' && value !== 'fit';\r\n\t\t\t\tif (invalid) {\r\n\t\t\t\t\tif (process.env.NODE_ENV !== 'production') {\r\n\t\t\t\t\t\tconsole.warn(\r\n\t\t\t\t\t\t\t`Warning: prop \"defaultBoundaries\" gets incorrect string value ${value}. It should be either function, 'fill' or 'fit'`,\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn !invalid;\r\n\t\t\t},\r\n\t\t},\r\n\t\tpriority: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: 'coordinates',\r\n\t\t},\r\n\t\tstencilSize: {\r\n\t\t\ttype: [Object, Function],\r\n\t\t},\r\n\t\tresizeImage: {\r\n\t\t\ttype: [Boolean, Object],\r\n\t\t\tdefault: true,\r\n\t\t},\r\n\t\tmoveImage: {\r\n\t\t\ttype: [Boolean, Object],\r\n\t\t\tdefault: true,\r\n\t\t},\r\n\t\tautoZoomAlgorithm: {\r\n\t\t\ttype: Function,\r\n\t\t},\r\n\t\tresizeAlgorithm: {\r\n\t\t\ttype: Function,\r\n\t\t\tdefault: algorithms.resize,\r\n\t\t},\r\n\t\tmoveAlgorithm: {\r\n\t\t\ttype: Function,\r\n\t\t\tdefault: algorithms.move,\r\n\t\t},\r\n\t\tinitStretcher: {\r\n\t\t\ttype: Function,\r\n\t\t\tdefault: algorithms.initStretcher,\r\n\t\t},\r\n\t\tfitCoordinates: {\r\n\t\t\ttype: Function,\r\n\t\t\tdefault: algorithms.fitCoordinates,\r\n\t\t},\r\n\t\tfitVisibleArea: {\r\n\t\t\ttype: Function,\r\n\t\t\tdefault: algorithms.fitVisibleArea,\r\n\t\t},\r\n\t\tareaRestrictionsAlgorithm: {\r\n\t\t\ttype: Function,\r\n\t\t\tdefault: algorithms.dynamicAreaRestrictions,\r\n\t\t},\r\n\t\tsizeRestrictionsAlgorithm: {\r\n\t\t\ttype: Function,\r\n\t\t\tdefault: algorithms.pixelsRestrictions,\r\n\t\t},\r\n\t\tpositionRestrictionsAlgorithm: {\r\n\t\t\ttype: Function,\r\n\t\t\tdefault: algorithms.positionRestrictions,\r\n\t\t},\r\n\t\tmaxCanvasSize: {\r\n\t\t\ttype: Number,\r\n\t\t\tvalidator(value) {\r\n\t\t\t\tif (!isUndefined(value) && process.env.NODE_ENV !== 'production') {\r\n\t\t\t\t\tconsole.warn(`Warning: prop \"maxCanvasSize\" is deprecated now.`);\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t},\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\ttransitionsActive: false,\r\n\t\t\timageLoaded: false,\r\n\t\t\timageAttributes: {\r\n\t\t\t\twidth: null,\r\n\t\t\t\theight: null,\r\n\t\t\t\tcrossOrigin: false,\r\n\t\t\t\tsrc: null,\r\n\t\t\t},\r\n\t\t\tcustomImageTransforms: {\r\n\t\t\t\trotate: 0,\r\n\t\t\t\tflip: {\r\n\t\t\t\t\thorizontal: false,\r\n\t\t\t\t\tvertical: false,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tbasicImageTransforms: {\r\n\t\t\t\trotate: 0,\r\n\t\t\t\tflip: {\r\n\t\t\t\t\thorizontal: false,\r\n\t\t\t\t\tvertical: false,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tboundaries: {\r\n\t\t\t\twidth: 0,\r\n\t\t\t\theight: 0,\r\n\t\t\t},\r\n\t\t\tvisibleArea: null,\r\n\t\t\tcoordinates: {\r\n\t\t\t\t...DEFAULT_COORDINATES,\r\n\t\t\t},\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\timage() {\r\n\t\t\treturn {\r\n\t\t\t\tsrc: this.imageAttributes.src,\r\n\t\t\t\twidth: this.imageAttributes.width,\r\n\t\t\t\theight: this.imageAttributes.height,\r\n\t\t\t\ttransforms: this.imageTransforms,\r\n\t\t\t};\r\n\t\t},\r\n\t\timageTransforms() {\r\n\t\t\treturn {\r\n\t\t\t\trotate: this.basicImageTransforms.rotate + this.customImageTransforms.rotate,\r\n\t\t\t\tflip: {\r\n\t\t\t\t\thorizontal: Boolean(\r\n\t\t\t\t\t\tthis.basicImageTransforms.flip.horizontal ^ this.customImageTransforms.flip.horizontal,\r\n\t\t\t\t\t),\r\n\t\t\t\t\tvertical: Boolean(\r\n\t\t\t\t\t\tthis.basicImageTransforms.flip.vertical ^ this.customImageTransforms.flip.vertical,\r\n\t\t\t\t\t),\r\n\t\t\t\t},\r\n\t\t\t\ttranslateX: this.visibleArea ? this.visibleArea.left / this.coefficient : 0,\r\n\t\t\t\ttranslateY: this.visibleArea ? this.visibleArea.top / this.coefficient : 0,\r\n\t\t\t\tscaleX: 1 / this.coefficient,\r\n\t\t\t\tscaleY: 1 / this.coefficient,\r\n\t\t\t};\r\n\t\t},\r\n\t\timageSize() {\r\n\t\t\tconst transforms = this.imageTransforms;\r\n\t\t\tconst angle = radians(transforms.rotate);\r\n\t\t\treturn {\r\n\t\t\t\twidth:\r\n\t\t\t\t\tMath.abs(this.imageAttributes.width * Math.cos(angle)) +\r\n\t\t\t\t\tMath.abs(this.imageAttributes.height * Math.sin(angle)),\r\n\t\t\t\theight:\r\n\t\t\t\t\tMath.abs(this.imageAttributes.width * Math.sin(angle)) +\r\n\t\t\t\t\tMath.abs(this.imageAttributes.height * Math.cos(angle)),\r\n\t\t\t};\r\n\t\t},\r\n\t\tinitialized() {\r\n\t\t\treturn Boolean(this.visibleArea && this.imageLoaded);\r\n\t\t},\r\n\t\tsettings() {\r\n\t\t\tconst resizeImage = getOptions(\r\n\t\t\t\tthis.resizeImage,\r\n\t\t\t\t{\r\n\t\t\t\t\ttouch: true,\r\n\t\t\t\t\twheel: {\r\n\t\t\t\t\t\tratio: 0.1,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tadjustStencil: true,\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttouch: false,\r\n\t\t\t\t\twheel: false,\r\n\t\t\t\t\tadjustStencil: false,\r\n\t\t\t\t},\r\n\t\t\t);\r\n\r\n\t\t\tconst moveImage = getOptions(\r\n\t\t\t\tthis.moveImage,\r\n\t\t\t\t{\r\n\t\t\t\t\ttouch: true,\r\n\t\t\t\t\tmouse: true,\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttouch: false,\r\n\t\t\t\t\tmouse: false,\r\n\t\t\t\t},\r\n\t\t\t);\r\n\r\n\t\t\treturn {\r\n\t\t\t\tmoveImage,\r\n\t\t\t\tresizeImage,\r\n\t\t\t};\r\n\t\t},\r\n\t\tcoefficient() {\r\n\t\t\treturn this.visibleArea ? this.visibleArea.width / this.boundaries.width : 0;\r\n\t\t},\r\n\t\tareaRestrictions() {\r\n\t\t\tif (this.imageLoaded) {\r\n\t\t\t\treturn this.areaRestrictionsAlgorithm({\r\n\t\t\t\t\timageSize: this.imageSize,\r\n\t\t\t\t\timageRestriction: this.imageRestriction,\r\n\t\t\t\t\tboundaries: this.boundaries,\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\treturn {};\r\n\t\t\t}\r\n\t\t},\r\n\t\ttransitionsOptions() {\r\n\t\t\treturn {\r\n\t\t\t\tenabled: this.transitionsActive,\r\n\t\t\t\ttimingFunction: 'ease-in-out',\r\n\t\t\t\ttime: 350,\r\n\t\t\t};\r\n\t\t},\r\n\t\tsizeRestrictions() {\r\n\t\t\tif (this.boundaries.width && this.boundaries.height && this.imageSize.width && this.imageSize.height) {\r\n\t\t\t\tlet sizeRestrictions = this.sizeRestrictionsAlgorithm({\r\n\t\t\t\t\timageSize: this.imageSize,\r\n\t\t\t\t\tminWidth: !isUndefined(this.minWidth) ? parseNumber(this.minWidth) : 0,\r\n\t\t\t\t\tminHeight: !isUndefined(this.minHeight) ? parseNumber(this.minHeight) : 0,\r\n\t\t\t\t\tmaxWidth: !isUndefined(this.maxWidth) ? parseNumber(this.maxWidth) : Infinity,\r\n\t\t\t\t\tmaxHeight: !isUndefined(this.maxHeight) ? parseNumber(this.maxHeight) : Infinity,\r\n\t\t\t\t});\r\n\r\n\t\t\t\tsizeRestrictions = algorithms.refineSizeRestrictions({\r\n\t\t\t\t\tsizeRestrictions,\r\n\t\t\t\t\tareaRestrictions: this.getAreaRestrictions({ visibleArea: this.visibleArea, type: 'resize' }),\r\n\t\t\t\t\timageSize: this.imageSize,\r\n\t\t\t\t\tboundaries: this.boundaries,\r\n\t\t\t\t\tpositionRestrictions: this.positionRestrictions,\r\n\t\t\t\t\timageRestriction: this.imageRestriction,\r\n\t\t\t\t\tvisibleArea: this.visibleArea,\r\n\t\t\t\t\tstencilSize: this.getStencilSize(),\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (this.visibleArea && this.stencilSize) {\r\n\t\t\t\t\tconst stencilSize = this.getStencilSize();\r\n\t\t\t\t\tconst areaRestrictions = limitsToSize(\r\n\t\t\t\t\t\tthis.getAreaRestrictions({ visibleArea: this.visibleArea, type: 'resize' }),\r\n\t\t\t\t\t);\r\n\t\t\t\t\tsizeRestrictions.maxWidth = Math.min(\r\n\t\t\t\t\t\tsizeRestrictions.maxWidth,\r\n\t\t\t\t\t\t(areaRestrictions.width * stencilSize.width) / this.boundaries.width,\r\n\t\t\t\t\t);\r\n\t\t\t\t\tsizeRestrictions.maxHeight = Math.min(\r\n\t\t\t\t\t\tsizeRestrictions.maxHeight,\r\n\t\t\t\t\t\t(areaRestrictions.height * stencilSize.height) / this.boundaries.height,\r\n\t\t\t\t\t);\r\n\t\t\t\t\tif (sizeRestrictions.maxWidth < sizeRestrictions.minWidth) {\r\n\t\t\t\t\t\tif (process.env.NODE_ENV !== 'production') {\r\n\t\t\t\t\t\t\tconsole.warn(\r\n\t\t\t\t\t\t\t\t'Maximum width is smaller than minimum width, because otherwise the area restrictions or stencil size will be broken. Minimum width is reduced.',\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsizeRestrictions.minWidth = sizeRestrictions.maxWidth;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (sizeRestrictions.maxHeight < sizeRestrictions.minHeight) {\r\n\t\t\t\t\t\tif (process.env.NODE_ENV !== 'production') {\r\n\t\t\t\t\t\t\tconsole.warn(\r\n\t\t\t\t\t\t\t\t'Maximum height is smaller than minimum height, because otherwise the area restrictions or stencil size will be broken. Minimum height is reduced.',\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsizeRestrictions.minHeight = sizeRestrictions.maxHeight;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn sizeRestrictions;\r\n\t\t\t} else {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tminWidth: 0,\r\n\t\t\t\t\tminHeight: 0,\r\n\t\t\t\t\tmaxWidth: 0,\r\n\t\t\t\t\tmaxHeight: 0,\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t},\r\n\t\tpositionRestrictions() {\r\n\t\t\treturn this.positionRestrictionsAlgorithm({\r\n\t\t\t\timageSize: this.imageSize,\r\n\t\t\t\timageRestriction: this.imageRestriction,\r\n\t\t\t});\r\n\t\t},\r\n\t\t// Styling\r\n\t\tclasses() {\r\n\t\t\treturn {\r\n\t\t\t\tcropper: cn(),\r\n\t\t\t\timage: classnames(cn('image'), this.imageClass),\r\n\t\t\t\tstencil: cn('stencil'),\r\n\t\t\t\tboundaries: classnames(cn('boundaries'), this.boundariesClass),\r\n\t\t\t\tstretcher: classnames(cn('stretcher')),\r\n\t\t\t\tbackground: classnames(cn('background'), this.backgroundClass),\r\n\t\t\t\tforeground: classnames(cn('foreground'), this.foregroundClass),\r\n\t\t\t\timageWrapper: classnames(cn('image-wrapper')),\r\n\t\t\t\tcropperWrapper: classnames(cn('cropper-wrapper')),\r\n\t\t\t};\r\n\t\t},\r\n\t\tstencilCoordinates() {\r\n\t\t\tif (this.initialized) {\r\n\t\t\t\tconst { width, height, left, top } = this.coordinates;\r\n\t\t\t\treturn {\r\n\t\t\t\t\twidth: width / this.coefficient,\r\n\t\t\t\t\theight: height / this.coefficient,\r\n\t\t\t\t\tleft: (left - this.visibleArea.left) / this.coefficient,\r\n\t\t\t\t\ttop: (top - this.visibleArea.top) / this.coefficient,\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\treturn this.defaultCoordinates();\r\n\t\t\t}\r\n\t\t},\r\n\t\tboundariesStyle() {\r\n\t\t\tconst styles = {\r\n\t\t\t\twidth: this.boundaries.width ? `${Math.round(this.boundaries.width)}px` : 'auto',\r\n\t\t\t\theight: this.boundaries.height ? `${Math.round(this.boundaries.height)}px` : 'auto',\r\n\t\t\t\ttransition: `opacity ${this.transitionTime}ms`,\r\n\t\t\t\tpointerEvents: this.imageLoaded ? 'all' : 'none',\r\n\t\t\t};\r\n\t\t\tif (!this.imageLoaded) {\r\n\t\t\t\tstyles.opacity = '0';\r\n\t\t\t}\r\n\t\t\treturn styles;\r\n\t\t},\r\n\t\timageStyle() {\r\n\t\t\tconst optimalImageSize =\r\n\t\t\t\tthis.imageAttributes.width > this.imageAttributes.height\r\n\t\t\t\t\t? {\r\n\t\t\t\t\t\t\twidth: Math.min(1024, this.imageAttributes.width),\r\n\t\t\t\t\t\t\theight:\r\n\t\t\t\t\t\t\t\tMath.min(1024, this.imageAttributes.width) /\r\n\t\t\t\t\t\t\t\t(this.imageAttributes.width / this.imageAttributes.height),\r\n\t\t\t\t\t  }\r\n\t\t\t\t\t: {\r\n\t\t\t\t\t\t\theight: Math.min(1024, this.imageAttributes.height),\r\n\t\t\t\t\t\t\twidth:\r\n\t\t\t\t\t\t\t\tMath.min(1024, this.imageAttributes.height) *\r\n\t\t\t\t\t\t\t\t(this.imageAttributes.width / this.imageAttributes.height),\r\n\t\t\t\t\t  };\r\n\r\n\t\t\tconst compensations = {\r\n\t\t\t\trotate: {\r\n\t\t\t\t\tleft: (optimalImageSize.width - this.imageSize.width) / (2 * this.coefficient),\r\n\t\t\t\t\ttop: (optimalImageSize.height - this.imageSize.height) / (2 * this.coefficient),\r\n\t\t\t\t},\r\n\t\t\t\tscale: {\r\n\t\t\t\t\tleft: ((1 - 1 / this.coefficient) * optimalImageSize.width) / 2,\r\n\t\t\t\t\ttop: ((1 - 1 / this.coefficient) * optimalImageSize.height) / 2,\r\n\t\t\t\t},\r\n\t\t\t};\r\n\r\n\t\t\tconst transforms = {\r\n\t\t\t\t...this.imageTransforms,\r\n\t\t\t\tscaleX: this.imageTransforms.scaleX * (this.imageAttributes.width / optimalImageSize.width),\r\n\t\t\t\tscaleY: this.imageTransforms.scaleY * (this.imageAttributes.height / optimalImageSize.height),\r\n\t\t\t};\r\n\r\n\t\t\tconst result = {\r\n\t\t\t\twidth: `${optimalImageSize.width}px`,\r\n\t\t\t\theight: `${optimalImageSize.height}px`,\r\n\t\t\t\tleft: '0px',\r\n\t\t\t\ttop: '0px',\r\n\t\t\t\ttransform:\r\n\t\t\t\t\t`translate(${\r\n\t\t\t\t\t\t-compensations.rotate.left - compensations.scale.left - this.imageTransforms.translateX\r\n\t\t\t\t\t}px, ${-compensations.rotate.top - compensations.scale.top - this.imageTransforms.translateY}px)` +\r\n\t\t\t\t\tgetStyleTransforms(transforms),\r\n\t\t\t};\r\n\r\n\t\t\tif (this.transitionsOptions.enabled) {\r\n\t\t\t\tresult.transition = `${this.transitionsOptions.time}ms ${this.transitionsOptions.timingFunction}`;\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t},\r\n\t},\r\n\twatch: {\r\n\t\tsrc() {\r\n\t\t\tthis.onChangeImage();\r\n\t\t},\r\n\t\tstencilComponent() {\r\n\t\t\tthis.$nextTick(() => {\r\n\t\t\t\tthis.resetCoordinates();\r\n\t\t\t\tthis.runAutoZoom('setCoordinates');\r\n\t\t\t\tthis.onChange();\r\n\t\t\t});\r\n\t\t},\r\n\t\tminWidth() {\r\n\t\t\tthis.onPropsChange();\r\n\t\t},\r\n\t\tmaxWidth() {\r\n\t\t\tthis.onPropsChange();\r\n\t\t},\r\n\t\tminHeight() {\r\n\t\t\tthis.onPropsChange();\r\n\t\t},\r\n\t\tmaxHeight() {\r\n\t\t\tthis.onPropsChange();\r\n\t\t},\r\n\t\timageRestriction() {\r\n\t\t\tthis.reset();\r\n\t\t},\r\n\t\tstencilProps(oldProps, newProps) {\r\n\t\t\tconst significantProps = ['aspectRatio', 'minAspectRatio', 'maxAspectRatio'];\r\n\t\t\tif (significantProps.find((prop) => oldProps[prop] !== newProps[prop])) {\r\n\t\t\t\tthis.$nextTick(this.onPropsChange);\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n\tcreated() {\r\n\t\tthis.debouncedUpdate = debounce(this.update, this.debounce);\r\n\t\tthis.debouncedDisableTransitions = debounce(this.disableTransitions, this.transitionsOptions.time);\r\n\t\tthis.awaiting = false;\r\n\t},\r\n\tmounted() {\r\n\t\tthis.$refs.image.addEventListener('load', this.onSuccessLoadImage);\r\n\t\tthis.$refs.image.addEventListener('error', this.onFailLoadImage);\r\n\t\tthis.onChangeImage();\r\n\r\n\t\t// Add listeners to window to adapt the cropper to window changes\r\n\t\twindow.addEventListener('resize', this.refresh);\r\n\t\twindow.addEventListener('orientationchange', this.refresh);\r\n\t},\r\n\tunmounted() {\r\n\t\twindow.removeEventListener('resize', this.refresh);\r\n\t\twindow.removeEventListener('orientationchange', this.refresh);\r\n\t\tif (this.imageAttributes.revoke && this.imageAttributes.src) {\r\n\t\t\tURL.revokeObjectURL(this.imageAttributes.src);\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\t// External methods\r\n\t\tgetResult() {\r\n\t\t\tconst coordinates = this.initialized\r\n\t\t\t\t? this.prepareResult({ ...this.coordinates })\r\n\t\t\t\t: this.defaultCoordinates();\r\n\t\t\tconst imageTransforms = {\r\n\t\t\t\trotate: this.imageTransforms.rotate % 360,\r\n\t\t\t\tflip: {\r\n\t\t\t\t\t...this.imageTransforms.flip,\r\n\t\t\t\t},\r\n\t\t\t};\r\n\t\t\tif (this.src && this.imageLoaded) {\r\n\t\t\t\tconst cropper = this;\r\n\t\t\t\treturn {\r\n\t\t\t\t\timage: this.image,\r\n\t\t\t\t\tcoordinates,\r\n\t\t\t\t\tvisibleArea: this.visibleArea ? { ...this.visibleArea } : null,\r\n\t\t\t\t\timageTransforms,\r\n\t\t\t\t\tget canvas() {\r\n\t\t\t\t\t\tif (cropper.canvas) {\r\n\t\t\t\t\t\t\treturn cropper.getCanvas();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn undefined;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\treturn {\r\n\t\t\t\t\timage: this.image,\r\n\t\t\t\t\tcoordinates,\r\n\t\t\t\t\tvisibleArea: this.visibleArea ? { ...this.visibleArea } : null,\r\n\t\t\t\t\tcanvas: undefined,\r\n\t\t\t\t\timageTransforms,\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t},\r\n\t\tzoom(factor, center, params = {}) {\r\n\t\t\tconst { transitions = true } = params;\r\n\r\n\t\t\tthis.onManipulateImage(\r\n\t\t\t\tnew ManipulateImageEvent(\r\n\t\t\t\t\t{},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfactor: 1 / factor,\r\n\t\t\t\t\t\tcenter,\r\n\t\t\t\t\t},\r\n\t\t\t\t),\r\n\t\t\t\t{\r\n\t\t\t\t\tnormalize: false,\r\n\t\t\t\t\ttransitions,\r\n\t\t\t\t},\r\n\t\t\t);\r\n\t\t},\r\n\t\tmove(left, top, params = {}) {\r\n\t\t\tconst { transitions = true } = params;\r\n\r\n\t\t\tthis.onManipulateImage(\r\n\t\t\t\tnew ManipulateImageEvent({\r\n\t\t\t\t\tleft: left || 0,\r\n\t\t\t\t\ttop: top || 0,\r\n\t\t\t\t}),\r\n\t\t\t\t{\r\n\t\t\t\t\tnormalize: false,\r\n\t\t\t\t\ttransitions,\r\n\t\t\t\t},\r\n\t\t\t);\r\n\t\t},\r\n\t\tsetCoordinates(transforms, params = {}) {\r\n\t\t\tconst { autoZoom = true, transitions = true } = params;\r\n\t\t\tthis.$nextTick(() => {\r\n\t\t\t\tif (!this.imageLoaded) {\r\n\t\t\t\t\tthis.delayedTransforms = transforms;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (!this.transitionsActive) {\r\n\t\t\t\t\t\tif (transitions) {\r\n\t\t\t\t\t\t\tthis.enableTransitions();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.coordinates = this.applyTransform(transforms);\r\n\t\t\t\t\t\tif (autoZoom) {\r\n\t\t\t\t\t\t\tthis.runAutoZoom('setCoordinates');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (transitions) {\r\n\t\t\t\t\t\t\tthis.debouncedDisableTransitions();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.onChange();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\trefresh() {\r\n\t\t\tconst image = this.$refs.image;\r\n\t\t\tif (this.src && image) {\r\n\t\t\t\tlet promise;\r\n\t\t\t\tif (this.initialized) {\r\n\t\t\t\t\treturn this.updateVisibleArea().then(() => {\r\n\t\t\t\t\t\tthis.onChange();\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn this.resetVisibleArea().then(() => {\r\n\t\t\t\t\t\tthis.onChange();\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\treset() {\r\n\t\t\treturn this.resetVisibleArea().then(() => {\r\n\t\t\t\tthis.onChange();\r\n\t\t\t});\r\n\t\t},\r\n\t\t// Internal methods\r\n\t\tawaitRender(callback) {\r\n\t\t\tif (!this.awaiting) {\r\n\t\t\t\tthis.awaiting = true;\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t\tthis.awaiting = false;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\tprepareResult(coordinates) {\r\n\t\t\tif (this.roundResult) {\r\n\t\t\t\treturn algorithms.roundCoordinates({\r\n\t\t\t\t\t...this.getPublicProperties(),\r\n\t\t\t\t\tpositionRestrictions: algorithms.limitBy(this.positionRestrictions, this.visibleArea),\r\n\t\t\t\t\tcoordinates,\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\treturn coordinates;\r\n\t\t\t}\r\n\t\t},\r\n\t\tprocessAutoZoom(type, visibleArea, coordinates, params) {\r\n\t\t\tlet algorithm = this.autoZoomAlgorithm;\r\n\r\n\t\t\tif (!algorithm) {\r\n\t\t\t\tif (this.stencilSize) {\r\n\t\t\t\t\talgorithm = algorithms.fixedStencilAutoZoom;\r\n\t\t\t\t} else if (this.autoZoom) {\r\n\t\t\t\t\talgorithm = algorithms.hybridStencilAutoZoom;\r\n\t\t\t\t} else {\r\n\t\t\t\t\talgorithm = algorithms.simplestAutoZoom;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst result = algorithm({\r\n\t\t\t\tevent: {\r\n\t\t\t\t\ttype,\r\n\t\t\t\t\tparams,\r\n\t\t\t\t},\r\n\t\t\t\tvisibleArea,\r\n\t\t\t\tcoordinates,\r\n\t\t\t\tboundaries: this.boundaries,\r\n\t\t\t\taspectRatio: this.getAspectRatio(),\r\n\t\t\t\tpositionRestrictions: this.positionRestrictions,\r\n\t\t\t\tgetAreaRestrictions: this.getAreaRestrictions,\r\n\t\t\t\tsizeRestrictions: this.sizeRestrictions,\r\n\t\t\t\tstencilSize: this.getStencilSize(),\r\n\t\t\t});\r\n\r\n\t\t\treturn {\r\n\t\t\t\t...result,\r\n\t\t\t\tchanged: !isEqual(result.visibleArea, visibleArea) || !isEqual(result.coordinates, coordinates),\r\n\t\t\t};\r\n\t\t},\r\n\t\trunAutoZoom(event, params = {}) {\r\n\t\t\tconst { transitions = false, ...payload } = params;\r\n\r\n\t\t\tconst { visibleArea, coordinates, changed } = this.processAutoZoom(\r\n\t\t\t\tevent,\r\n\t\t\t\tthis.visibleArea,\r\n\t\t\t\tthis.coordinates,\r\n\t\t\t\tpayload,\r\n\t\t\t);\r\n\r\n\t\t\tif (transitions && changed) {\r\n\t\t\t\tthis.enableTransitions();\r\n\t\t\t}\r\n\r\n\t\t\tthis.visibleArea = visibleArea;\r\n\t\t\tthis.coordinates = coordinates;\r\n\r\n\t\t\tif (transitions && changed) {\r\n\t\t\t\tthis.debouncedDisableTransitions();\r\n\t\t\t}\r\n\t\t},\r\n\t\tnormalizeEvent(event) {\r\n\t\t\treturn algorithms.normalizeEvent({\r\n\t\t\t\t...this.getPublicProperties(),\r\n\t\t\t\tevent,\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetCanvas() {\r\n\t\t\t// This function can be asynchronously called because it's debounced\r\n\t\t\t// Therefore there is workaround to prevent processing after the component was unmounted\r\n\t\t\tif (this.$refs.canvas) {\r\n\t\t\t\tconst canvas = this.$refs.canvas;\r\n\t\t\t\tconst image = this.$refs.image;\r\n\t\t\t\tconst imageTransformed =\r\n\t\t\t\t\tthis.imageTransforms.rotate !== 0 ||\r\n\t\t\t\t\tthis.imageTransforms.flip.horizontal ||\r\n\t\t\t\t\tthis.imageTransforms.flip.vertical;\r\n\t\t\t\tconst source = imageTransformed\r\n\t\t\t\t\t? prepareSource(this.$refs.sourceCanvas, image, this.imageTransforms)\r\n\t\t\t\t\t: image;\r\n\r\n\t\t\t\tconst options = {\r\n\t\t\t\t\tminWidth: 0,\r\n\t\t\t\t\tminHeight: 0,\r\n\t\t\t\t\tmaxWidth: Infinity,\r\n\t\t\t\t\tmaxHeight: Infinity,\r\n\t\t\t\t\tmaxArea: this.maxCanvasSize,\r\n\t\t\t\t\timageSmoothingEnabled: true,\r\n\t\t\t\t\timageSmoothingQuality: 'high',\r\n\t\t\t\t\tfillColor: 'transparent',\r\n\t\t\t\t\t...this.canvas,\r\n\t\t\t\t};\r\n\r\n\t\t\t\tconst firstNumeric = (array) => array.find((el) => isNumeric(el));\r\n\r\n\t\t\t\tlet size = approximatedSize({\r\n\t\t\t\t\tsizeRestrictions: {\r\n\t\t\t\t\t\tminWidth: firstNumeric([options.width, options.minWidth]) || 0,\r\n\t\t\t\t\t\tminHeight: firstNumeric([options.height, options.minHeight]) || 0,\r\n\t\t\t\t\t\tmaxWidth: firstNumeric([options.width, options.maxWidth]) || Infinity,\r\n\t\t\t\t\t\tmaxHeight: firstNumeric([options.height, options.maxHeight]) || Infinity,\r\n\t\t\t\t\t},\r\n\t\t\t\t\twidth: this.coordinates.width,\r\n\t\t\t\t\theight: this.coordinates.height,\r\n\t\t\t\t\taspectRatio: {\r\n\t\t\t\t\t\tminimum: this.coordinates.width / this.coordinates.height,\r\n\t\t\t\t\t\tmaximum: this.coordinates.width / this.coordinates.height,\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (options.maxArea && size.width * size.height > options.maxArea) {\r\n\t\t\t\t\tconst scale = Math.sqrt(options.maxArea / (size.width * size.height));\r\n\t\t\t\t\tsize = {\r\n\t\t\t\t\t\twidth: Math.round(scale * size.width),\r\n\t\t\t\t\t\theight: Math.round(scale * size.height),\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tupdateCanvas(canvas, source, this.coordinates, size, options);\r\n\r\n\t\t\t\treturn canvas;\r\n\t\t\t}\r\n\t\t},\r\n\t\tupdate() {\r\n\t\t\tthis.$emit('change', this.getResult());\r\n\t\t},\r\n\t\tapplyTransform(transform, limited = false) {\r\n\t\t\tconst sizeRestrictions =\r\n\t\t\t\tthis.visibleArea && limited\r\n\t\t\t\t\t? limitSizeRestrictions(this.sizeRestrictions, this.visibleArea)\r\n\t\t\t\t\t: this.sizeRestrictions;\r\n\r\n\t\t\tconst positionRestrictions =\r\n\t\t\t\tthis.visibleArea && limited\r\n\t\t\t\t\t? limitBy(this.positionRestrictions, this.visibleArea)\r\n\t\t\t\t\t: this.positionRestrictions;\r\n\r\n\t\t\treturn algorithms.applyTransform({\r\n\t\t\t\ttransform,\r\n\t\t\t\tcoordinates: this.coordinates,\r\n\t\t\t\timageSize: this.imageSize,\r\n\t\t\t\tsizeRestrictions,\r\n\t\t\t\tpositionRestrictions,\r\n\t\t\t\taspectRatio: this.getAspectRatio(),\r\n\t\t\t\tvisibleArea: this.visibleArea,\r\n\t\t\t});\r\n\t\t},\r\n\t\tresetCoordinates() {\r\n\t\t\t// This function can be asynchronously called after completion of refreshing image promise\r\n\t\t\t// Therefore there is a workaround to prevent processing after the component was unmounted\r\n\t\t\t// Also coordinates can't be reset if visible area was not initialized\r\n\t\t\tif (this.$refs.image) {\r\n\t\t\t\tconst cropper = this.$refs.cropper;\r\n\t\t\t\tconst image = this.$refs.image;\r\n\r\n\t\t\t\tlet defaultSizeAlgorithm = this.defaultSize;\r\n\t\t\t\tif (!defaultSizeAlgorithm) {\r\n\t\t\t\t\tif (this.stencilSize) {\r\n\t\t\t\t\t\tdefaultSizeAlgorithm = algorithms.fixedDefaultSize;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdefaultSizeAlgorithm = algorithms.defaultSize;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst { minWidth, minHeight, maxWidth, maxHeight } = this.sizeRestrictions;\r\n\r\n\t\t\t\tconst defaultSize = isFunction(defaultSizeAlgorithm)\r\n\t\t\t\t\t? defaultSizeAlgorithm({\r\n\t\t\t\t\t\t\tboundaries: this.boundaries,\r\n\t\t\t\t\t\t\timageSize: this.imageSize,\r\n\t\t\t\t\t\t\taspectRatio: this.getAspectRatio(),\r\n\t\t\t\t\t\t\tsizeRestrictions: this.sizeRestrictions,\r\n\t\t\t\t\t\t\tstencilSize: this.getStencilSize(),\r\n\t\t\t\t\t\t\tvisibleArea: this.visibleArea,\r\n\t\t\t\t\t  })\r\n\t\t\t\t\t: defaultSizeAlgorithm;\r\n\r\n\t\t\t\tif (\r\n\t\t\t\t\tprocess.env.NODE_ENV === 'development' &&\r\n\t\t\t\t\t(defaultSize.width < minWidth ||\r\n\t\t\t\t\t\tdefaultSize.height < minHeight ||\r\n\t\t\t\t\t\tdefaultSize.width > maxWidth ||\r\n\t\t\t\t\t\tdefaultSize.height > maxHeight)\r\n\t\t\t\t) {\r\n\t\t\t\t\tconsole.warn(\r\n\t\t\t\t\t\t'Warning: the default size breaks size restrictions. Check your defaultSize function',\r\n\t\t\t\t\t\tdefaultSize,\r\n\t\t\t\t\t\tthis.sizeRestrictions,\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst defaultPositionAlgorithm = this.defaultPosition || algorithms.defaultPosition;\r\n\r\n\t\t\t\tconst transforms = [\r\n\t\t\t\t\tdefaultSize,\r\n\t\t\t\t\t({ coordinates }) => ({\r\n\t\t\t\t\t\t...(isFunction(defaultPositionAlgorithm)\r\n\t\t\t\t\t\t\t? defaultPositionAlgorithm({\r\n\t\t\t\t\t\t\t\t\tcoordinates,\r\n\t\t\t\t\t\t\t\t\timageSize: this.imageSize,\r\n\t\t\t\t\t\t\t\t\tvisibleArea: this.visibleArea,\r\n\t\t\t\t\t\t\t  })\r\n\t\t\t\t\t\t\t: this.defaultPosition),\r\n\t\t\t\t\t}),\r\n\t\t\t\t];\r\n\r\n\t\t\t\tif (this.delayedTransforms) {\r\n\t\t\t\t\ttransforms.push(\r\n\t\t\t\t\t\t...(Array.isArray(this.delayedTransforms) ? this.delayedTransforms : [this.delayedTransforms]),\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tthis.coordinates = this.applyTransform(transforms, true);\r\n\t\t\t\tthis.delayedTransforms = null;\r\n\t\t\t}\r\n\t\t},\r\n\t\tclearImage() {\r\n\t\t\tthis.imageLoaded = false;\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tconst stretcher = this.$refs.stretcher;\r\n\t\t\t\tif (stretcher) {\r\n\t\t\t\t\tstretcher.style.height = 'auto';\r\n\t\t\t\t\tstretcher.style.width = 'auto';\r\n\t\t\t\t}\r\n\t\t\t\tthis.coordinates = this.defaultCoordinates();\r\n\t\t\t\tthis.boundaries = {\r\n\t\t\t\t\twidth: 0,\r\n\t\t\t\t\theight: 0,\r\n\t\t\t\t};\r\n\t\t\t}, this.transitionTime);\r\n\t\t},\r\n\t\tenableTransitions() {\r\n\t\t\tif (this.transitions) {\r\n\t\t\t\tthis.transitionsActive = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tdisableTransitions() {\r\n\t\t\tthis.transitionsActive = false;\r\n\t\t},\r\n\t\tupdateBoundaries() {\r\n\t\t\tconst stretcher = this.$refs.stretcher;\r\n\t\t\tconst cropper = this.$refs.cropper;\r\n\r\n\t\t\tthis.initStretcher({\r\n\t\t\t\tcropper,\r\n\t\t\t\tstretcher,\r\n\t\t\t\timageSize: this.imageSize,\r\n\t\t\t});\r\n\r\n\t\t\treturn this.$nextTick().then(() => {\r\n\t\t\t\tconst params = {\r\n\t\t\t\t\tcropper,\r\n\t\t\t\t\timageSize: this.imageSize,\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (isFunction(this.defaultBoundaries)) {\r\n\t\t\t\t\tthis.boundaries = this.defaultBoundaries(params);\r\n\t\t\t\t} else if (this.defaultBoundaries === 'fit') {\r\n\t\t\t\t\tthis.boundaries = fitBoundaries(params);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.boundaries = fillBoundaries(params);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!this.boundaries.width || !this.boundaries.height) {\r\n\t\t\t\t\tthrow new Error(\"It's impossible to fit the cropper in the current container\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tresetVisibleArea() {\r\n\t\t\treturn this.updateBoundaries()\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tif (this.priority !== 'visible-area') {\r\n\t\t\t\t\t\tthis.visibleArea = null;\r\n\t\t\t\t\t\tthis.resetCoordinates();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet algorithm = this.defaultVisibleArea || algorithms.defaultVisibleArea;\r\n\r\n\t\t\t\t\tthis.visibleArea = isFunction(algorithm)\r\n\t\t\t\t\t\t? algorithm({\r\n\t\t\t\t\t\t\t\timageSize: this.imageSize,\r\n\t\t\t\t\t\t\t\tboundaries: this.boundaries,\r\n\t\t\t\t\t\t\t\tcoordinates: this.priority !== 'visible-area' ? this.coordinates : null,\r\n\t\t\t\t\t\t\t\tgetAreaRestrictions: this.getAreaRestrictions,\r\n\t\t\t\t\t\t\t\tstencilSize: this.getStencilSize(),\r\n\t\t\t\t\t\t  })\r\n\t\t\t\t\t\t: this.defaultVisibleArea;\r\n\r\n\t\t\t\t\tthis.visibleArea = algorithms.refineVisibleArea({\r\n\t\t\t\t\t\tvisibleArea: this.visibleArea,\r\n\t\t\t\t\t\tboundaries: this.boundaries,\r\n\t\t\t\t\t\tgetAreaRestrictions: this.getAreaRestrictions,\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (this.priority === 'visible-area') {\r\n\t\t\t\t\t\tthis.resetCoordinates();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.coordinates = this.fitCoordinates({\r\n\t\t\t\t\t\t\tvisibleArea: this.visibleArea,\r\n\t\t\t\t\t\t\tcoordinates: this.coordinates,\r\n\t\t\t\t\t\t\taspectRatio: this.getAspectRatio(),\r\n\t\t\t\t\t\t\tpositionRestrictions: this.positionRestrictions,\r\n\t\t\t\t\t\t\tsizeRestrictions: this.sizeRestrictions,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.runAutoZoom('resetVisibleArea');\r\n\t\t\t\t})\r\n\t\t\t\t.catch(() => {\r\n\t\t\t\t\tthis.visibleArea = null;\r\n\t\t\t\t});\r\n\t\t},\r\n\t\tupdateVisibleArea() {\r\n\t\t\treturn this.updateBoundaries()\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tthis.visibleArea = this.fitVisibleArea({\r\n\t\t\t\t\t\timageSize: this.imageSize,\r\n\t\t\t\t\t\tboundaries: this.boundaries,\r\n\t\t\t\t\t\tvisibleArea: this.visibleArea,\r\n\t\t\t\t\t\tcoordinates: this.coordinates,\r\n\t\t\t\t\t\tgetAreaRestrictions: this.getAreaRestrictions,\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.coordinates = this.fitCoordinates({\r\n\t\t\t\t\t\tvisibleArea: this.visibleArea,\r\n\t\t\t\t\t\tcoordinates: this.coordinates,\r\n\t\t\t\t\t\taspectRatio: this.getAspectRatio(),\r\n\t\t\t\t\t\tpositionRestrictions: this.positionRestrictions,\r\n\t\t\t\t\t\tsizeRestrictions: this.sizeRestrictions,\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.runAutoZoom('updateVisibleArea');\r\n\t\t\t\t})\r\n\t\t\t\t.catch(() => {\r\n\t\t\t\t\tthis.visibleArea = null;\r\n\t\t\t\t});\r\n\t\t},\r\n\t\tonChange(debounce = true) {\r\n\t\t\tif (debounce && this.debounce) {\r\n\t\t\t\tthis.debouncedUpdate();\r\n\t\t\t} else {\r\n\t\t\t\tthis.update();\r\n\t\t\t}\r\n\t\t},\r\n\t\tonChangeImage() {\r\n\t\t\tthis.imageLoaded = false;\r\n\t\t\tthis.delayedTransforms = null;\r\n\r\n\t\t\tif (this.src) {\r\n\t\t\t\tif (isCrossOriginURL(this.src)) {\r\n\t\t\t\t\tlet crossOrigin = isUndefined(this.crossOrigin) ? this.canvas : this.crossOrigin;\r\n\t\t\t\t\tif (crossOrigin === true) {\r\n\t\t\t\t\t\tcrossOrigin = 'anonymous';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.imageAttributes.crossOrigin = crossOrigin;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.checkOrientation) {\r\n\t\t\t\t\tconst promise = parseImage(this.src);\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tpromise.then(this.onParseImage);\r\n\t\t\t\t\t}, this.transitionTime);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tthis.onParseImage({ source: this.src });\r\n\t\t\t\t\t}, this.transitionTime);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.clearImage();\r\n\t\t\t}\r\n\t\t},\r\n\t\tonFailLoadImage() {\r\n\t\t\tif (this.imageAttributes.src) {\r\n\t\t\t\tthis.clearImage();\r\n\t\t\t\tthis.$emit('error');\r\n\t\t\t}\r\n\t\t},\r\n\t\tonSuccessLoadImage() {\r\n\t\t\t// After loading image the current component can be unmounted\r\n\t\t\t// Therefore there is a workaround to prevent processing the following code\r\n\t\t\tconst image = this.$refs.image;\r\n\t\t\tif (image && !this.imageLoaded) {\r\n\t\t\t\tthis.imageAttributes.height = image.naturalHeight;\r\n\t\t\t\tthis.imageAttributes.width = image.naturalWidth;\r\n\t\t\t\tthis.imageLoaded = true;\r\n\t\t\t\tthis.reset().then(() => {\r\n\t\t\t\t\tthis.$emit('ready');\r\n\t\t\t\t\tthis.onChange(false);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\tonParseImage({ source, arrayBuffer, orientation }) {\r\n\t\t\tif (this.imageAttributes.revoke && this.imageAttributes.src) {\r\n\t\t\t\tURL.revokeObjectURL(this.imageAttributes.src);\r\n\t\t\t}\r\n\t\t\tthis.imageAttributes.revoke = false;\r\n\t\t\tif (arrayBuffer && orientation && orientation > 1 && isLocal(source)) {\r\n\t\t\t\tif (isBlob(source)) {\r\n\t\t\t\t\tthis.imageAttributes.src = URL.createObjectURL(new Blob([arrayBuffer]));\r\n\t\t\t\t\tthis.imageAttributes.revoke = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.imageAttributes.src = arrayBufferToDataURL(arrayBuffer);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.imageAttributes.src = source;\r\n\t\t\t}\r\n\t\t\tthis.customImageTransforms = {\r\n\t\t\t\trotate: 0,\r\n\t\t\t\tflip: {\r\n\t\t\t\t\thorizontal: false,\r\n\t\t\t\t\tvertical: false,\r\n\t\t\t\t},\r\n\t\t\t};\r\n\t\t\tthis.basicImageTransforms = {\r\n\t\t\t\t...this.customImageTransforms,\r\n\t\t\t\t...getImageTransforms(orientation),\r\n\t\t\t};\r\n\t\t\tthis.$nextTick(() => {\r\n\t\t\t\tconst image = this.$refs.image;\r\n\t\t\t\tif (image && image.complete) {\r\n\t\t\t\t\tif (isLoadedImage(image)) {\r\n\t\t\t\t\t\tthis.onSuccessLoadImage();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.onFailLoadImage();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tonResizeEnd() {\r\n\t\t\tthis.runAutoZoom('resize', {\r\n\t\t\t\ttransitions: true,\r\n\t\t\t});\r\n\t\t},\r\n\t\tonMoveEnd() {\r\n\t\t\tthis.runAutoZoom('move', {\r\n\t\t\t\ttransitions: true,\r\n\t\t\t});\r\n\t\t},\r\n\t\tonMove(event) {\r\n\t\t\tif (!this.transitionsOptions.enabled) {\r\n\t\t\t\tthis.awaitRender(() => {\r\n\t\t\t\t\tthis.coordinates = this.moveAlgorithm({\r\n\t\t\t\t\t\t...this.getPublicProperties(),\r\n\t\t\t\t\t\tpositionRestrictions: algorithms.limitBy(this.positionRestrictions, this.visibleArea),\r\n\t\t\t\t\t\tcoordinates: this.coordinates,\r\n\t\t\t\t\t\tevent: this.normalizeEvent(event),\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.onChange();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\tonResize(event) {\r\n\t\t\tif (!this.transitionsOptions.enabled && (!this.stencilSize || this.autoZoom)) {\r\n\t\t\t\tthis.awaitRender(() => {\r\n\t\t\t\t\tconst sizeRestrictions = this.sizeRestrictions;\r\n\r\n\t\t\t\t\t// The magic number is the approximation of the handler size\r\n\t\t\t\t\t// Temporary solution that should be improved in the future\r\n\t\t\t\t\tconst minimumSize = Math.min(\r\n\t\t\t\t\t\tthis.coordinates.width,\r\n\t\t\t\t\t\tthis.coordinates.height,\r\n\t\t\t\t\t\t20 * this.coefficient,\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tthis.coordinates = this.resizeAlgorithm({\r\n\t\t\t\t\t\t...this.getPublicProperties(),\r\n\t\t\t\t\t\tpositionRestrictions: algorithms.limitBy(this.positionRestrictions, this.visibleArea),\r\n\t\t\t\t\t\tsizeRestrictions: {\r\n\t\t\t\t\t\t\tmaxWidth: Math.min(sizeRestrictions.maxWidth, this.visibleArea.width),\r\n\t\t\t\t\t\t\tmaxHeight: Math.min(sizeRestrictions.maxHeight, this.visibleArea.height),\r\n\t\t\t\t\t\t\tminWidth: Math.max(sizeRestrictions.minWidth, minimumSize),\r\n\t\t\t\t\t\t\tminHeight: Math.max(sizeRestrictions.minHeight, minimumSize),\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tevent: this.normalizeEvent(event),\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.onChange();\r\n\t\t\t\t\tthis.ticking = false;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\tonManipulateImage(event, params = {}) {\r\n\t\t\tif (!this.transitionsOptions.enabled) {\r\n\t\t\t\tconst { transitions = false, normalize = true } = params;\r\n\t\t\t\tif (transitions) {\r\n\t\t\t\t\tthis.enableTransitions();\r\n\t\t\t\t}\r\n\t\t\t\tconst { visibleArea, coordinates } = algorithms.manipulateImage({\r\n\t\t\t\t\t...this.getPublicProperties(),\r\n\t\t\t\t\tevent: normalize ? this.normalizeEvent(event) : event,\r\n\t\t\t\t\tgetAreaRestrictions: this.getAreaRestrictions,\r\n\t\t\t\t\timageRestriction: this.imageRestriction,\r\n\t\t\t\t\tadjustStencil: !this.stencilSize && this.settings.resizeImage.adjustStencil,\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.visibleArea = visibleArea;\r\n\t\t\t\tthis.coordinates = coordinates;\r\n\r\n\t\t\t\tthis.runAutoZoom('manipulateImage');\r\n\r\n\t\t\t\tthis.onChange();\r\n\r\n\t\t\t\tif (transitions) {\r\n\t\t\t\t\tthis.debouncedDisableTransitions();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tonPropsChange() {\r\n\t\t\tthis.coordinates = this.applyTransform(this.coordinates, true);\r\n\t\t\tthis.onChange(false);\r\n\t\t},\r\n\t\tgetAreaRestrictions({ visibleArea, type = 'move' } = {}) {\r\n\t\t\treturn this.areaRestrictionsAlgorithm({\r\n\t\t\t\tboundaries: this.boundaries,\r\n\t\t\t\timageSize: this.imageSize,\r\n\t\t\t\timageRestriction: this.imageRestriction,\r\n\t\t\t\tvisibleArea,\r\n\t\t\t\ttype,\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetAspectRatio(ignoreStencil) {\r\n\t\t\tlet minimum, maximum;\r\n\t\t\tconst { aspectRatio, minAspectRatio, maxAspectRatio } = this.stencilProps;\r\n\r\n\t\t\tif (this.$refs.stencil.aspectRatios) {\r\n\t\t\t\t({ minimum, maximum } = this.$refs.stencil.aspectRatios());\r\n\t\t\t}\r\n\r\n\t\t\tif (isUndefined(minimum)) {\r\n\t\t\t\tminimum = !isUndefined(aspectRatio) ? aspectRatio : minAspectRatio;\r\n\t\t\t}\r\n\t\t\tif (isUndefined(maximum)) {\r\n\t\t\t\tmaximum = !isUndefined(aspectRatio) ? aspectRatio : maxAspectRatio;\r\n\t\t\t}\r\n\r\n\t\t\tif (!ignoreStencil && (isUndefined(minimum) || isUndefined(maximum))) {\r\n\t\t\t\tconst stencilSize = this.getStencilSize();\r\n\t\t\t\tconst stencilRatio = stencilSize ? ratio(stencilSize) : null;\r\n\t\t\t\tif (isUndefined(minimum)) {\r\n\t\t\t\t\tminimum = isNumber(stencilRatio) ? stencilRatio : undefined;\r\n\t\t\t\t}\r\n\t\t\t\tif (isUndefined(maximum)) {\r\n\t\t\t\t\tmaximum = isNumber(stencilRatio) ? stencilRatio : undefined;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\tminimum,\r\n\t\t\t\tmaximum,\r\n\t\t\t};\r\n\t\t},\r\n\t\tgetStencilSize() {\r\n\t\t\tif (this.stencilSize) {\r\n\t\t\t\treturn algorithms.calculateStencilSize({\r\n\t\t\t\t\tcurrentStencilSize: {\r\n\t\t\t\t\t\twidth: this.stencilCoordinates.width,\r\n\t\t\t\t\t\theight: this.stencilCoordinates.height,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstencilSize: this.stencilSize,\r\n\t\t\t\t\tboundaries: this.boundaries,\r\n\t\t\t\t\tcoefficient: this.coefficient,\r\n\t\t\t\t\tcoordinates: this.coordinates,\r\n\t\t\t\t\taspectRatio: this.getAspectRatio(true),\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\tgetPublicProperties() {\r\n\t\t\treturn {\r\n\t\t\t\tcoefficient: this.coefficient,\r\n\t\t\t\tvisibleArea: this.visibleArea,\r\n\t\t\t\tcoordinates: this.coordinates,\r\n\t\t\t\tboundaries: this.boundaries,\r\n\t\t\t\tsizeRestrictions: this.sizeRestrictions,\r\n\t\t\t\tpositionRestrictions: this.positionRestrictions,\r\n\t\t\t\taspectRatio: this.getAspectRatio(),\r\n\t\t\t\timageRestriction: this.imageRestriction,\r\n\t\t\t};\r\n\t\t},\r\n\t\tdefaultCoordinates() {\r\n\t\t\treturn { ...DEFAULT_COORDINATES };\r\n\t\t},\r\n\t\tflip(horizontal, vertical, options = {}) {\r\n\t\t\tconst { transitions = true } = options;\r\n\t\t\tif (!this.transitionsActive) {\r\n\t\t\t\tif (transitions) {\r\n\t\t\t\t\tthis.enableTransitions();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst previousFlip = {\r\n\t\t\t\t\t...this.imageTransforms.flip,\r\n\t\t\t\t};\r\n\r\n\t\t\t\tlet { visibleArea, coordinates } = algorithms.flipImage({\r\n\t\t\t\t\tflip: {\r\n\t\t\t\t\t\thorizontal: horizontal ? !previousFlip.horizontal : previousFlip.horizontal,\r\n\t\t\t\t\t\tvertical: vertical ? !previousFlip.vertical : previousFlip.vertical,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tpreviousFlip,\r\n\t\t\t\t\trotate: this.imageTransforms.rotate,\r\n\t\t\t\t\tvisibleArea: this.visibleArea,\r\n\t\t\t\t\tcoordinates: this.coordinates,\r\n\t\t\t\t\timageSize: this.imageSize,\r\n\t\t\t\t\tpositionRestrictions: this.positionRestrictions,\r\n\t\t\t\t\tsizeRestrictions: this.sizeRestrictions,\r\n\t\t\t\t\tgetAreaRestrictions: this.getAreaRestrictions,\r\n\t\t\t\t\taspectRatio: this.getAspectRatio(),\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (horizontal) {\r\n\t\t\t\t\tthis.customImageTransforms.flip.horizontal = !this.customImageTransforms.flip.horizontal;\r\n\t\t\t\t}\r\n\t\t\t\tif (vertical) {\r\n\t\t\t\t\tthis.customImageTransforms.flip.vertical = !this.customImageTransforms.flip.vertical;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.visibleArea = visibleArea;\r\n\t\t\t\tthis.coordinates = coordinates;\r\n\r\n\t\t\t\tthis.onChange();\r\n\t\t\t\tif (transitions) {\r\n\t\t\t\t\tthis.debouncedDisableTransitions();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\trotate(angle, options = {}) {\r\n\t\t\tconst { transitions = true } = options;\r\n\r\n\t\t\tif (!this.transitionsActive) {\r\n\t\t\t\tif (transitions) {\r\n\t\t\t\t\tthis.enableTransitions();\r\n\t\t\t\t}\r\n\t\t\t\tconst previousImageSize = { ...this.imageSize };\r\n\r\n\t\t\t\tthis.customImageTransforms.rotate += angle;\r\n\t\t\t\tlet { visibleArea, coordinates } = algorithms.rotateImage({\r\n\t\t\t\t\tvisibleArea: this.visibleArea,\r\n\t\t\t\t\tcoordinates: this.coordinates,\r\n\t\t\t\t\tpreviousImageSize,\r\n\t\t\t\t\timageSize: this.imageSize,\r\n\t\t\t\t\tangle,\r\n\t\t\t\t\tpositionRestrictions: this.positionRestrictions,\r\n\t\t\t\t\tsizeRestrictions: this.sizeRestrictions,\r\n\t\t\t\t\tgetAreaRestrictions: this.getAreaRestrictions,\r\n\t\t\t\t\taspectRatio: this.getAspectRatio(),\r\n\t\t\t\t});\r\n\r\n\t\t\t\t({ visibleArea, coordinates } = this.processAutoZoom('rotateImage', visibleArea, coordinates));\r\n\r\n\t\t\t\tthis.visibleArea = visibleArea;\r\n\t\t\t\tthis.coordinates = coordinates;\r\n\r\n\t\t\t\tthis.onChange();\r\n\r\n\t\t\t\tif (transitions) {\r\n\t\t\t\t\tthis.debouncedDisableTransitions();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n\temits: ['change', 'error', 'ready'],\r\n};\r\n</script>\r\n\r\n<template>\r\n\t<div ref=\"cropper\" :class=\"classes.cropper\">\r\n\t\t<div ref=\"stretcher\" :class=\"classes.stretcher\" />\r\n\r\n\t\t<div :class=\"classes.boundaries\" :style=\"boundariesStyle\">\r\n\t\t\t<cropper-wrapper\r\n\t\t\t\t:class=\"classes.cropperWrapper\"\r\n\t\t\t\t:wheel-resize=\"settings.resizeImage.wheel\"\r\n\t\t\t\t:touch-resize=\"settings.resizeImage.touch\"\r\n\t\t\t\t:touch-move=\"settings.moveImage.touch\"\r\n\t\t\t\t:mouse-move=\"settings.moveImage.mouse\"\r\n\t\t\t\t@move=\"onManipulateImage\"\r\n\t\t\t\t@resize=\"onManipulateImage\"\r\n\t\t\t>\r\n\t\t\t\t<div :class=\"classes.background\" :style=\"boundariesStyle\"></div>\r\n\t\t\t\t<div :class=\"classes.imageWrapper\">\r\n\t\t\t\t\t<img\r\n\t\t\t\t\t\tref=\"image\"\r\n\t\t\t\t\t\t:crossorigin=\"imageAttributes.crossOrigin\"\r\n\t\t\t\t\t\t:src=\"imageAttributes.src\"\r\n\t\t\t\t\t\t:class=\"classes.image\"\r\n\t\t\t\t\t\t:style=\"imageStyle\"\r\n\t\t\t\t\t\t@mousedown.prevent\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div :class=\"classes.foreground\" :style=\"boundariesStyle\"></div>\r\n\t\t\t\t<component\r\n\t\t\t\t\t:is=\"stencilComponent\"\r\n\t\t\t\t\tv-show=\"imageLoaded\"\r\n\t\t\t\t\tref=\"stencil\"\r\n\t\t\t\t\t:image=\"image\"\r\n\t\t\t\t\t:coordinates=\"coordinates\"\r\n\t\t\t\t\t:stencil-coordinates=\"stencilCoordinates\"\r\n\t\t\t\t\t:transitions=\"transitionsOptions\"\r\n\t\t\t\t\tv-bind=\"stencilProps\"\r\n\t\t\t\t\t@resize=\"onResize\"\r\n\t\t\t\t\t@resize-end=\"onResizeEnd\"\r\n\t\t\t\t\t@move=\"onMove\"\r\n\t\t\t\t\t@move-end=\"onMoveEnd\"\r\n\t\t\t\t/>\r\n\t\t\t\t<canvas v-if=\"canvas\" ref=\"canvas\" :style=\"{ display: 'none' }\" />\r\n\t\t\t\t<canvas v-if=\"canvas\" ref=\"sourceCanvas\" :style=\"{ display: 'none' }\" />\r\n\t\t\t</cropper-wrapper>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.vue-advanced-cropper {\r\n\ttext-align: center;\r\n\tposition: relative;\r\n\tuser-select: none;\r\n\tmax-height: 100%;\r\n\tmax-width: 100%;\r\n\tdirection: ltr;\r\n\r\n\t&__stretcher {\r\n\t\tpointer-events: none;\r\n\t\tposition: relative;\r\n\t\tmax-width: 100%;\r\n\t\tmax-height: 100%;\r\n\t}\r\n\r\n\t&__image {\r\n\t\tuser-select: none;\r\n\t\tposition: absolute;\r\n\t\ttransform-origin: center;\r\n\t\t// Workaround to prevent bugs at the websites with max-width\r\n\t\t// rule applied to img (Vuepress for example)\r\n\t\tmax-width: none !important;\r\n\t}\r\n\t&__background,\r\n\t&__foreground {\r\n\t\topacity: 1;\r\n\t\tbackground: black;\r\n\t\ttransform: translate(-50%, -50%);\r\n\t\tposition: absolute;\r\n\t\ttop: 50%;\r\n\t\tleft: 50%;\r\n\t}\r\n\t&__foreground {\r\n\t\topacity: 0.5;\r\n\t}\r\n\t&__boundaries {\r\n\t\topacity: 1;\r\n\t\ttransform: translate(-50%, -50%);\r\n\t\tposition: absolute;\r\n\t\tleft: 50%;\r\n\t\ttop: 50%;\r\n\t}\r\n\t&__cropper-wrapper {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n\t&__image-wrapper {\r\n\t\toverflow: hidden;\r\n\t\tposition: absolute;\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n\t&__stencil-wrapper {\r\n\t\tposition: absolute;\r\n\t}\r\n}\r\n</style>\r\n","import { Size } from '../typings';\r\nimport { ratio } from '../service';\r\n\r\nexport interface InitStretcherParams {\r\n\tstretcher: HTMLElement;\r\n\timageSize: Size;\r\n}\r\nexport function initStretcher({ stretcher, imageSize }: InitStretcherParams): void {\r\n\tconst aspectRatio = ratio(imageSize);\r\n\tstretcher.style.width = `${imageSize.width}px`;\r\n\tstretcher.style.height = `${stretcher.clientWidth / aspectRatio}px`;\r\n\t// Prevent stretching in future until stretcher will be reinitialized\r\n\tstretcher.style.width = `${stretcher.clientWidth}px`;\r\n}\r\n","import { AspectRatio, Coordinates, PositionRestrictions, SizeRestrictions, VisibleArea } from '../typings';\r\nimport { approximatedSize } from './approximatedSize';\r\nimport { applyMove, diff, fit, fitToLimits, getCenter, intersectionLimits, toLimits } from '../service';\r\n\r\nexport interface FitCoordinatesParams {\r\n\tvisibleArea: VisibleArea;\r\n\tcoordinates: Coordinates;\r\n\taspectRatio: AspectRatio;\r\n\tsizeRestrictions: SizeRestrictions;\r\n\tpositionRestrictions: PositionRestrictions;\r\n}\r\n\r\nexport function fitCoordinates(params: FitCoordinatesParams): Coordinates {\r\n\tconst {\r\n\t\tvisibleArea,\r\n\t\tcoordinates: previousCoordinates,\r\n\t\taspectRatio,\r\n\t\tsizeRestrictions,\r\n\t\tpositionRestrictions,\r\n\t} = params;\r\n\r\n\tlet coordinates = {\r\n\t\t...previousCoordinates,\r\n\t\t...approximatedSize({\r\n\t\t\twidth: previousCoordinates.width,\r\n\t\t\theight: previousCoordinates.height,\r\n\t\t\taspectRatio,\r\n\t\t\tsizeRestrictions: {\r\n\t\t\t\tmaxWidth: visibleArea.width,\r\n\t\t\t\tmaxHeight: visibleArea.height,\r\n\t\t\t\tminHeight: Math.min(visibleArea.height, sizeRestrictions.minHeight),\r\n\t\t\t\tminWidth: Math.min(visibleArea.width, sizeRestrictions.minWidth),\r\n\t\t\t},\r\n\t\t}),\r\n\t};\r\n\r\n\tcoordinates = applyMove(coordinates, diff(getCenter(previousCoordinates), getCenter(coordinates)));\r\n\r\n\tcoordinates = fitToLimits(coordinates, intersectionLimits(toLimits(visibleArea), positionRestrictions));\r\n\r\n\treturn coordinates;\r\n}\r\n","import {\r\n\tadjustSize,\r\n\tapplyMove,\r\n\tapplyScale,\r\n\tfit,\r\n\tfitToLimits,\r\n\tgetIntersections,\r\n\tinverseMove,\r\n\tmaxScale,\r\n\tratio,\r\n\ttoLimits,\r\n} from '../service';\r\nimport { Coordinates, AreaRestrictions, VisibleArea, Boundaries, GetAreaRestrictions } from '../typings';\r\n\r\n// This function updates visible area with respect to current transformations and fits\r\n// coordinates to the new visible area\r\nexport interface FitVisibleAreaParams {\r\n\tgetAreaRestrictions: GetAreaRestrictions;\r\n\tcoordinates: Coordinates;\r\n\tvisibleArea: VisibleArea;\r\n\tboundaries: Boundaries;\r\n}\r\nexport function fitVisibleArea(params: FitVisibleAreaParams): VisibleArea {\r\n\tconst { visibleArea: previousVisibleArea, boundaries, getAreaRestrictions, coordinates } = params;\r\n\r\n\tlet visibleArea = { ...previousVisibleArea };\r\n\r\n\t// Scale visible area size to fit new boundaries:\r\n\tvisibleArea.height = visibleArea.width / ratio(boundaries);\r\n\tvisibleArea.top += (previousVisibleArea.height - visibleArea.height) / 2;\r\n\r\n\t// Scale visible area to prevent overlap coordinates\r\n\tif (coordinates.height - visibleArea.height > 0 || coordinates.width - visibleArea.width > 0) {\r\n\t\tvisibleArea = applyScale(\r\n\t\t\tvisibleArea,\r\n\t\t\tMath.max(coordinates.height / visibleArea.height, coordinates.width / visibleArea.width),\r\n\t\t);\r\n\t}\r\n\r\n\t// Scale visible area to prevent overlap area restrictions\r\n\tvisibleArea = applyScale(\r\n\t\tvisibleArea,\r\n\t\tadjustSize(visibleArea, getAreaRestrictions({ visibleArea, type: 'resize' })),\r\n\t);\r\n\r\n\t// Move visible are to prevent moving of the coordinates:\r\n\tconst move = inverseMove(fit(coordinates, toLimits(visibleArea)));\r\n\tif (visibleArea.width < coordinates.width) {\r\n\t\tmove.left = 0;\r\n\t}\r\n\tif (visibleArea.height < coordinates.height) {\r\n\t\tmove.top = 0;\r\n\t}\r\n\tvisibleArea = applyMove(visibleArea, move);\r\n\r\n\t// Move visible area to prevent overlap the area restrictions\r\n\tvisibleArea = fitToLimits(visibleArea, getAreaRestrictions({ visibleArea, type: 'move' }));\r\n\r\n\treturn visibleArea;\r\n}\r\n","import { Boundaries, ImageRestriction, Limits, Size, VisibleArea } from '../typings';\r\nimport { ratio } from '../service';\r\n\r\nexport interface DynamicAreaRestrictionsParams {\r\n\timageRestriction: ImageRestriction;\r\n\timageSize: Size;\r\n\tboundaries: Boundaries;\r\n\tvisibleArea?: VisibleArea;\r\n\tcenter?: boolean;\r\n\ttype: 'resize' | 'move';\r\n}\r\nexport function dynamicAreaRestrictions(params: DynamicAreaRestrictionsParams): Limits {\r\n\tconst { visibleArea, boundaries, imageSize, imageRestriction, type } = params;\r\n\r\n\tlet limits: Limits = {};\r\n\r\n\tif (imageRestriction === 'fill-area') {\r\n\t\tlimits = {\r\n\t\t\tleft: 0,\r\n\t\t\ttop: 0,\r\n\t\t\tright: imageSize.width,\r\n\t\t\tbottom: imageSize.height,\r\n\t\t};\r\n\t} else if (imageRestriction === 'fit-area') {\r\n\t\tif (ratio(boundaries) > ratio(imageSize)) {\r\n\t\t\tlimits = {\r\n\t\t\t\ttop: 0,\r\n\t\t\t\tbottom: imageSize.height,\r\n\t\t\t};\r\n\t\t\tif (visibleArea && type === 'move') {\r\n\t\t\t\tif (visibleArea.width > imageSize.width) {\r\n\t\t\t\t\tlimits.left = -(visibleArea.width - imageSize.width) / 2;\r\n\t\t\t\t\tlimits.right = imageSize.width - limits.left;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlimits.left = 0;\r\n\t\t\t\t\tlimits.right = imageSize.width;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlimits = {\r\n\t\t\t\tleft: 0,\r\n\t\t\t\tright: imageSize.width,\r\n\t\t\t};\r\n\t\t\tif (visibleArea && type === 'move') {\r\n\t\t\t\tif (visibleArea.height > imageSize.height) {\r\n\t\t\t\t\tlimits.top = -(visibleArea.height - imageSize.height) / 2;\r\n\t\t\t\t\tlimits.bottom = imageSize.height - limits.top;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlimits.top = 0;\r\n\t\t\t\t\tlimits.bottom = imageSize.height;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn limits;\r\n}\r\n","import { Size, SizeRestrictions } from '../typings';\r\n\r\nexport interface SizeRestrictionsParams {\r\n\timageSize: Size;\r\n\tminWidth: number;\r\n\tminHeight: number;\r\n\tmaxWidth: number;\r\n\tmaxHeight: number;\r\n}\r\nexport function percentRestrictions({\r\n\timageSize,\r\n\tminWidth,\r\n\tminHeight,\r\n\tmaxWidth,\r\n\tmaxHeight,\r\n}: SizeRestrictionsParams): SizeRestrictions {\r\n\treturn {\r\n\t\tminWidth: (minWidth / 100) * imageSize.width,\r\n\t\tminHeight: (minHeight / 100) * imageSize.height,\r\n\t\tmaxWidth: (maxWidth / 100) * imageSize.width,\r\n\t\tmaxHeight: (maxHeight / 100) * imageSize.height,\r\n\t};\r\n}\r\n\r\nexport function pixelsRestrictions({\r\n\tminWidth,\r\n\tminHeight,\r\n\tmaxWidth,\r\n\tmaxHeight,\r\n}: SizeRestrictionsParams): SizeRestrictions {\r\n\treturn {\r\n\t\tminWidth,\r\n\t\tminHeight,\r\n\t\tmaxWidth,\r\n\t\tmaxHeight,\r\n\t};\r\n}\r\n","import { ImageRestriction, Limits, Size } from '../typings';\r\n\r\nexport interface PositionRestrictionsParams {\r\n\timageRestriction: ImageRestriction;\r\n\timageSize: Size;\r\n}\r\nexport function positionRestrictions({ imageSize, imageRestriction }: PositionRestrictionsParams): Limits {\r\n\tlet limits = {};\r\n\r\n\tif (imageRestriction !== 'none') {\r\n\t\tlimits = {\r\n\t\t\tleft: 0,\r\n\t\t\ttop: 0,\r\n\t\t\tright: imageSize.width,\r\n\t\t\tbottom: imageSize.height,\r\n\t\t};\r\n\t}\r\n\r\n\treturn limits;\r\n}\r\n","import {\r\n\tAreaRestrictions,\r\n\tBoundaries,\r\n\tImageRestriction,\r\n\tPositionRestrictions,\r\n\tSize,\r\n\tSizeRestrictions,\r\n\tVisibleArea,\r\n} from '../typings';\r\nimport { fitSize, limitsToSize } from '../service';\r\nimport { isUndefined } from '../utils';\r\n\r\ninterface RefineSizeRestrictionsParams {\r\n\tsizeRestrictions: Partial<SizeRestrictions>;\r\n\tareaRestrictions: AreaRestrictions;\r\n\tpositionRestrictions: PositionRestrictions;\r\n\tboundaries: Boundaries;\r\n\timageSize: Size;\r\n\timageRestriction: ImageRestriction;\r\n}\r\nexport function refineSizeRestrictions({\r\n\tareaRestrictions,\r\n\tsizeRestrictions,\r\n\timageSize,\r\n\tboundaries,\r\n\tpositionRestrictions,\r\n\timageRestriction = 'none',\r\n}: RefineSizeRestrictionsParams) {\r\n\t// User can forget to set some of restrictions, so we should init them by default values\r\n\tconst restrictions = {\r\n\t\t...sizeRestrictions,\r\n\t\tminWidth: sizeRestrictions.minWidth !== undefined ? sizeRestrictions.minWidth : 0,\r\n\t\tminHeight: sizeRestrictions.minHeight !== undefined ? sizeRestrictions.minHeight : 0,\r\n\t\tmaxWidth: sizeRestrictions.maxWidth !== undefined ? sizeRestrictions.maxWidth : Infinity,\r\n\t\tmaxHeight: sizeRestrictions.maxHeight !== undefined ? sizeRestrictions.maxHeight : Infinity,\r\n\t};\r\n\r\n\t// The situation, when stencil can't be positioned in cropper due to positionRestrictions should be avoided\r\n\tif (positionRestrictions.left !== undefined && positionRestrictions.right !== undefined) {\r\n\t\trestrictions.maxWidth = Math.min(restrictions.maxWidth, positionRestrictions.right - positionRestrictions.left);\r\n\t}\r\n\tif (positionRestrictions.bottom !== undefined && positionRestrictions.top !== undefined) {\r\n\t\trestrictions.maxHeight = Math.min(\r\n\t\t\trestrictions.maxHeight,\r\n\t\t\tpositionRestrictions.bottom - positionRestrictions.top,\r\n\t\t);\r\n\t}\r\n\r\n\t// The situation when stencil larger than maximum visible area or image should be avoided if imageRestriction != 'none':\r\n\tconst areaLimits = limitsToSize(areaRestrictions);\r\n\tconst areaMaximum = fitSize(boundaries, areaLimits);\r\n\r\n\tif (areaLimits.width < Infinity && (!restrictions.maxWidth || restrictions.maxWidth > areaMaximum.width)) {\r\n\t\trestrictions.maxWidth = Math.min(restrictions.maxWidth, areaMaximum.width);\r\n\t}\r\n\tif (areaLimits.height < Infinity && (!restrictions.maxHeight || restrictions.maxHeight > areaMaximum.height)) {\r\n\t\trestrictions.maxHeight = Math.min(restrictions.maxHeight, areaMaximum.height);\r\n\t}\r\n\r\n\t// Process the border cases when minimum height / width larger than maximum height / width\r\n\tif (restrictions.minWidth > restrictions.maxWidth) {\r\n\t\tif (process.env.NODE_ENV !== 'production') {\r\n\t\t\tconsole.warn(\r\n\t\t\t\t`Warning: maximum width (${restrictions.maxWidth}px) fewer that the minimum width (${restrictions.minWidth}px). It is set equal to the minimum width and width resizing was blocked`,\r\n\t\t\t);\r\n\t\t}\r\n\t\trestrictions.minWidth = restrictions.maxWidth;\r\n\t\trestrictions.widthFrozen = true;\r\n\t}\r\n\r\n\tif (restrictions.minHeight > restrictions.maxHeight) {\r\n\t\tif (process.env.NODE_ENV !== 'production') {\r\n\t\t\tconsole.warn(\r\n\t\t\t\t`Warning: maximum height (${restrictions.maxHeight}px) fewer that the minimum height (${restrictions.minHeight}px). It is set equal to the minimum height and height resizing was blocked`,\r\n\t\t\t);\r\n\t\t}\r\n\t\trestrictions.minHeight = restrictions.maxHeight;\r\n\t\trestrictions.heightFrozen = true;\r\n\t}\r\n\r\n\treturn restrictions;\r\n}\r\n","import { Coordinates, PositionRestrictions, SizeRestrictions } from '../typings';\r\nimport { fitToLimits } from '../service';\r\n\r\nexport interface RoundCoordinatesParams {\r\n\tcoordinates: Coordinates;\r\n\tsizeRestrictions: SizeRestrictions;\r\n\tpositionRestrictions: PositionRestrictions;\r\n}\r\nexport function roundCoordinates({\r\n\tcoordinates,\r\n\tsizeRestrictions,\r\n\tpositionRestrictions,\r\n}: RoundCoordinatesParams): Coordinates {\r\n\tconst roundedCoordinates = {\r\n\t\twidth: Math.round(coordinates.width),\r\n\t\theight: Math.round(coordinates.height),\r\n\t\tleft: Math.round(coordinates.left),\r\n\t\ttop: Math.round(coordinates.top),\r\n\t};\r\n\r\n\tif (roundedCoordinates.width > sizeRestrictions.maxWidth) {\r\n\t\troundedCoordinates.width = Math.floor(coordinates.width);\r\n\t} else if (roundedCoordinates.width < sizeRestrictions.minWidth) {\r\n\t\troundedCoordinates.width = Math.ceil(coordinates.width);\r\n\t}\r\n\tif (roundedCoordinates.height > sizeRestrictions.maxHeight) {\r\n\t\troundedCoordinates.height = Math.floor(coordinates.height);\r\n\t} else if (roundedCoordinates.height < sizeRestrictions.minHeight) {\r\n\t\troundedCoordinates.height = Math.ceil(coordinates.height);\r\n\t}\r\n\r\n\treturn fitToLimits(roundedCoordinates, positionRestrictions);\r\n}\r\n","import { ManipulateImageEvent, MoveEvent, ResizeEvent } from '../events';\r\nimport { VisibleArea } from '../typings';\r\nimport { ALL_DIRECTIONS, MAIN_DIRECTIONS } from '../constants';\r\n\r\ninterface NormalizeEventParams {\r\n\tevent: ResizeEvent | MoveEvent | ManipulateImageEvent;\r\n\tvisibleArea: VisibleArea;\r\n\tcoefficient: number;\r\n}\r\nexport function normalizeEvent({ event, visibleArea, coefficient }: NormalizeEventParams) {\r\n\tif (event.type === 'manipulateImage') {\r\n\t\treturn {\r\n\t\t\t...event,\r\n\t\t\tmove: {\r\n\t\t\t\tleft: event.move && event.move.left ? coefficient * event.move.left : 0,\r\n\t\t\t\ttop: event.move && event.move.top ? coefficient * event.move.top : 0,\r\n\t\t\t},\r\n\t\t\tscale: {\r\n\t\t\t\tfactor: event.scale && event.scale.factor ? event.scale.factor : 1,\r\n\t\t\t\tcenter:\r\n\t\t\t\t\tevent.scale && event.scale.center\r\n\t\t\t\t\t\t? {\r\n\t\t\t\t\t\t\t\tleft: event.scale.center.left * coefficient + visibleArea.left,\r\n\t\t\t\t\t\t\t\ttop: event.scale.center.top * coefficient + visibleArea.top,\r\n\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t: null,\r\n\t\t\t},\r\n\t\t};\r\n\t} else if (event.type === 'resize') {\r\n\t\tconst normalizedEvent = { ...event, directions: { ...event.directions } };\r\n\t\tALL_DIRECTIONS.forEach((direction) => {\r\n\t\t\tnormalizedEvent.directions[direction] *= coefficient;\r\n\t\t});\r\n\t\treturn normalizedEvent;\r\n\t} else if (event.type === 'move') {\r\n\t\tconst normalizedEvent = { ...event, directions: { ...event.directions } };\r\n\t\tMAIN_DIRECTIONS.forEach((direction) => {\r\n\t\t\tnormalizedEvent.directions[direction] *= coefficient;\r\n\t\t});\r\n\t\treturn normalizedEvent;\r\n\t} else {\r\n\t\treturn event;\r\n\t}\r\n}\r\n","import { Coordinates, Size } from './typings';\r\n\r\ninterface Options {\r\n\timageSmoothingQuality?: 'low' | 'medium' | 'high';\r\n\timageSmoothingEnabled?: boolean;\r\n\tfillColor?: string;\r\n}\r\n\r\nexport function updateCanvas(\r\n\tcanvas: HTMLCanvasElement,\r\n\tsource: HTMLCanvasElement | HTMLImageElement,\r\n\tcoordinates: Coordinates,\r\n\tresultSize?: Size,\r\n\toptions?: Options,\r\n) {\r\n\tcanvas.width = resultSize ? resultSize.width : coordinates.width;\r\n\tcanvas.height = resultSize ? resultSize.height : coordinates.height;\r\n\r\n\tconst ctx = canvas.getContext('2d');\r\n\r\n\tctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n\tif (options) {\r\n\t\tif (options.imageSmoothingEnabled) {\r\n\t\t\tctx.imageSmoothingEnabled = options.imageSmoothingEnabled;\r\n\t\t}\r\n\t\tif (options.imageSmoothingQuality) {\r\n\t\t\tctx.imageSmoothingQuality = options.imageSmoothingQuality;\r\n\t\t}\r\n\t\tif (options.fillColor) {\r\n\t\t\tctx.fillStyle = options.fillColor;\r\n\t\t\tctx.fillRect(0, 0, canvas.width, canvas.height);\r\n\t\t\tctx.save();\r\n\t\t}\r\n\t}\r\n\r\n\tctx.drawImage(\r\n\t\tsource,\r\n\t\tcoordinates.left,\r\n\t\tcoordinates.top,\r\n\t\tcoordinates.width,\r\n\t\tcoordinates.height,\r\n\t\t0,\r\n\t\t0,\r\n\t\tcanvas.width,\r\n\t\tcanvas.height,\r\n\t);\r\n}\r\n","import { Boundaries, Size } from '../typings';\r\n\r\nexport interface DefaultBoundariesParams {\r\n\tcropper: HTMLElement;\r\n\timageSize: Size;\r\n}\r\n\r\nexport function fitBoundaries({ cropper, imageSize }: DefaultBoundariesParams): Boundaries {\r\n\tconst areaHeight = cropper.clientHeight;\r\n\tconst areaWidth = cropper.clientWidth;\r\n\r\n\tlet currentHeight = areaHeight;\r\n\tlet currentWidth = (imageSize.width * areaHeight) / imageSize.height;\r\n\r\n\tif (currentWidth > areaWidth) {\r\n\t\tcurrentWidth = areaWidth;\r\n\t\tcurrentHeight = (imageSize.height * areaWidth) / imageSize.width;\r\n\t}\r\n\r\n\treturn {\r\n\t\twidth: currentWidth,\r\n\t\theight: currentHeight,\r\n\t};\r\n}\r\n\r\nexport function fillBoundaries({ cropper }: DefaultBoundariesParams): Boundaries {\r\n\treturn {\r\n\t\twidth: cropper.clientWidth,\r\n\t\theight: cropper.clientHeight,\r\n\t};\r\n}\r\n","import { GetAreaRestrictions, Boundaries, VisibleArea } from '../typings';\r\nimport { fitToLimits, ratio } from '../service';\r\n\r\ninterface RefineVisibleAreaParams {\r\n\tvisibleArea: VisibleArea;\r\n\tboundaries: Boundaries;\r\n\tgetAreaRestrictions: GetAreaRestrictions;\r\n}\r\nexport function refineVisibleArea(params: RefineVisibleAreaParams): VisibleArea {\r\n\tconst { visibleArea: previousVisibleArea, boundaries, getAreaRestrictions } = params;\r\n\r\n\tlet visibleArea = { ...previousVisibleArea };\r\n\r\n\tconst boundariesRatio = ratio(boundaries);\r\n\tif (visibleArea.width / visibleArea.height !== boundariesRatio) {\r\n\t\tvisibleArea.height = visibleArea.width / boundariesRatio;\r\n\t}\r\n\r\n\treturn fitToLimits(visibleArea, getAreaRestrictions({ visibleArea, type: 'move' }));\r\n}\r\n","import {\r\n\tAspectRatio,\r\n\tBoundaries,\r\n\tCoordinates,\r\n\tGetAreaRestrictions,\r\n\tPositionRestrictions,\r\n\tSize,\r\n\tSizeRestrictions,\r\n\tStencilSize,\r\n\tPosition,\r\n\tVisibleArea,\r\n\tStencilCalculationParams,\r\n} from '../typings';\r\nimport { isFunction, isUndefined } from '../utils';\r\nimport { adjustSize, applyScale, fitToLimits, getBrokenRatio, intersectionLimits, ratio, toLimits } from '../service';\r\nimport { approximatedSize } from './approximatedSize';\r\n\r\nexport interface CalculateStencilSizeParams {\r\n\taspectRatio: AspectRatio;\r\n\tstencilSize: StencilSize;\r\n\tboundaries: Boundaries;\r\n}\r\nexport function calculateStencilSize(params: CalculateStencilSizeParams): Size {\r\n\tconst { boundaries, stencilSize, aspectRatio } = params;\r\n\r\n\t// Checks that coordinates has the same ratio that coordinates:\r\n\tlet stencil = isFunction(stencilSize)\r\n\t\t? (stencilSize as Function)({ boundaries, aspectRatio })\r\n\t\t: stencilSize;\r\n\r\n\tif (getBrokenRatio(ratio(stencil), aspectRatio)) {\r\n\t\tif (process.env.NODE_ENV !== 'production') {\r\n\t\t\tconsole.error(\r\n\t\t\t\t`[Adjusting stencil] The aspect ratio of stencil doesn't correspondent to aspect ratio limitations`,\r\n\t\t\t);\r\n\t\t}\r\n\t\tstencil = approximatedSize({\r\n\t\t\tsizeRestrictions: {\r\n\t\t\t\tmaxWidth: boundaries.width,\r\n\t\t\t\tmaxHeight: boundaries.height,\r\n\t\t\t\tminWidth: 0,\r\n\t\t\t\tminHeight: 0,\r\n\t\t\t},\r\n\t\t\twidth: stencil.width,\r\n\t\t\theight: stencil.height,\r\n\t\t\taspectRatio: {\r\n\t\t\t\tminimum: aspectRatio.minimum,\r\n\t\t\t\tmaximum: aspectRatio.maximum,\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\tif (stencil.width > boundaries.width || stencil.height > boundaries.height) {\r\n\t\tif (process.env.NODE_ENV !== 'production') {\r\n\t\t\tconsole.error(\r\n\t\t\t\t`[Adjusting stencil] The width and height of stencil (${stencil.width}, ${stencil.height}) should be fewer or equal to the width and height of boundaries (${boundaries.width},${boundaries.height}) respectively`,\r\n\t\t\t);\r\n\t\t}\r\n\t\tstencil = approximatedSize({\r\n\t\t\tsizeRestrictions: {\r\n\t\t\t\tmaxWidth: boundaries.width,\r\n\t\t\t\tmaxHeight: boundaries.height,\r\n\t\t\t\tminWidth: 0,\r\n\t\t\t\tminHeight: 0,\r\n\t\t\t},\r\n\t\t\twidth: stencil.width,\r\n\t\t\theight: stencil.height,\r\n\t\t\taspectRatio: {\r\n\t\t\t\tminimum: ratio(stencil),\r\n\t\t\t\tmaximum: ratio(stencil),\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\treturn stencil;\r\n}\r\n"],"names":["hasOwn","hasOwnProperty","classNames","classes","i","arguments","length","arg","argType","push","Array","isArray","inner","apply","key","call","join","module","exports","default","window","componentName","elementOrMods","mods","element","base","Object","keys","reduce","result","name","value","debounce","func","wait","immediate","timeout","args","context","timestamp","later","last","Date","now","setTimeout","debounced","this","callNow","clear","clearTimeout","flush","__assign","assign","t","s","n","p","prototype","directionNames","hDirection","vDirection","classname","toUpperCase","slice","isBlob","url","test","isLocal","isDataUrl","isFunction","obj","constructor","isUndefined","undefined","isObject","getOptions","options","defaultScheme","falseScheme","forEach","Boolean","parseNumber","number","parsedNumber","Number","isNaN","isNumber","isObjectLike","toString","distance","firstPoint","secondPoint","Math","sqrt","pow","x","y","move","scale","type","directions","params","nativeEvent","position","previousPosition","anchor","DragEvent","_a","_b","getBoundingClientRect","left","top_1","top","props","String","beforeMount","addEventListener","onMouseUp","passive","onMouseMove","onTouchMove","onTouchEnd","beforeUnmount","removeEventListener","mounted","$refs","draggable","Error","touches","hovered","methods","onMouseOver","$emit","onMouseLeave","onTouchStart","e","cancelable","disabled","initAnchor","mean","touch","clientX","clientY","preventDefault","stopPropagation","processEnd","processMove","onMouseDown","fake","right","bottom","event","newTouches","emits","cn","bem","components","DraggableElement","horizontalPosition","verticalPosition","computed","rootClass","root","required","ALL_DIRECTIONS","HORIZONTAL_DIRECTIONS","VERTICAL_DIRECTIONS","MAIN_DIRECTIONS","IMAGE_RESTRICTIONS","DEFAULT_COORDINATES","width","height","isEqual","a","b","properties","some","property","toLimits","object","diff","firstObject","secondObject","getCenter","getIntersections","limits","intersections","direction","areaLimit","objectLimit","max","applyDirections","coordinates","inverseMove","applyMove","applyScale","scaleFactor","center","progress","currentCenter","ratio","maxScale","area","min","Infinity","fit","intersection","getBrokenRatio","currentAspectRatio","aspectRatio","ratioBroken","minimum","maximum","fitSize","firstSize","secondSize","firstRatio","secondRatio","rotateSize","size","angle","radians","PI","abs","cos","sin","rotatePoint","point","adjustSize","fitToLimits","inverse","limitsToSize","limitSizeRestrictions","sizeRestrictions","minWidth","minHeight","maxWidth","maxHeight","joinLimits","firstDirection","secondDirection","intersectionLimits","validateSize","ignoreMinimum","correctRatio","approximatedSize","findBestCandidate","candidates","candidate","positionRestrictions","movedCoordinates","applyTransform","initialCoordinates","transform","imageSize","visibleArea","moveAlgorithm","prevCoordinates","newCoordinates","MoveEvent","changes","resizeAlgorithm","fixedStencilAutoZoom","precision","getAreaRestrictions","boundaries","originalCoordinates","originalVisibleArea","stencilSize","stencil","console","error","hybridStencilAutoZoom","simplestAutoZoom","widthIntersections","heightIntersections","defaultPosition","defaultSize","optimalRatio","fixedDefaultSize","defaultVisibleArea","boundaryRatio","reference","areaProperties","coordinatesIntersection","imageRatio","limitBy","manipulateImage","adjustStencil","areaScale","stencilScale","allowedScale","factor","scaleRestrictions","relativeCoordinates","rotateImage","previousImageSize","imageCenter","flipImage","flip","previousFlip","rotate","changed","horizontal","vertical","oldCenter","newCenter","fitConditions","preserveRatio","compensate","fittedDirections","currentWidth","currentHeight","breaks","maxResize","multiplier_1","map","multiplier_2","distributeOverlap","overlap","first","second","block","wrapper","HandlerWrapper","defaultClass","hoverClass","wrapperClass","data","hover","classnames","onDrag","dragEvent","onEnter","onLeave","onDragEnd","LineWrapper","transitions","handlers","eastNorth","north","westNorth","west","westSouth","south","eastSouth","east","handlersComponent","SimpleHandler","handlersClasses","handlersWrappersClasses","lines","linesComponent","SimpleLine","linesClasses","linesWrappersClasses","resizable","points","verticalDirection","horizontalDirection","style","enabled","transition","time","timingFunction","handlersWrappers","linesWrappers","lineNodes","_this","component","class","handlerNodes","_this2","wrapperStyle","onEnd","onHandlerDrag","respectDirection","shift","ResizeEvent","allowedDirections","preserveAspectRatio","shiftKey","movable","activationDistance","touchStarted","shouldStartMove","button","container","getImageData","img","Promise","resolve","reject","base64","replace","binary","atob","len","buffer","ArrayBuffer","view","Uint8Array","charCodeAt","base64ToArrayBuffer","fileReader_1","FileReader","onload","target","callback","blob","readAsArrayBuffer","http","XMLHttpRequest","open","responseType","status","response","send","http_1","onreadystatechange","readyState","onprogress","getResponseHeader","abort","withCredentials","getStyleTransforms","scaleX","scaleY","resetAndGetOrientation","arrayBuffer","orientation_1","dataView","DataView","tiffOffset","littleEndian","app1Start","ifdStart","getUint8","length_1","byteLength","offset","start","str","fromCharCode","getStringFromCharCode","endianness","getUint16","firstIFDOffset","getUint32","length_2","setUint16","image","stencilCoordinates","imageClass","imageWrapper","imageStyle","imageTransforms","transforms","virtualSize","compensations","translateX","translateY","calculateGeometricProperties","centerMass","spread","count","touchMove","mouseMove","touchResize","wheelResize","_toConsumableArray","filter","oldGeometricProperties","identifier","find","anotherTouch","buttons","ManipulateImageEvent","newProperties","oldProperties","onWheel","deltaY","detail","wheelDelta","fill","calculatedImageSize","calculatedSize","coefficient","watch","onChangeImage","refreshImage","refresh","unmounted","naturalHeight","naturalWidth","clientWidth","clientHeight","complete","Preview","inheritAttrs","StencilPreview","BoundingBox","DraggableArea","minAspectRatio","maxAspectRatio","movingClass","resizingClass","previewClass","boundingBoxClass","moving","resizing","preview","boundingBox","onMove","moveEvent","onMoveEnd","onResize","resizeEvent","onResizeEnd","aspectRatios","CropperWrapper","src","stencilComponent","RectangleStencil","stencilProps","autoZoom","boundariesClass","backgroundClass","foregroundClass","checkOrientation","canvas","crossOrigin","transitionTime","imageRestriction","validator","indexOf","roundResult","Function","defaultBoundaries","invalid","warn","priority","resizeImage","moveImage","autoZoomAlgorithm","actualCoordinates","eventParams","widthFrozen","heightFrozen","overlapHeight","overlapWidth","algorithms","initStretcher","stretcher","fitCoordinates","previousCoordinates","fitVisibleArea","previousVisibleArea","areaRestrictionsAlgorithm","sizeRestrictionsAlgorithm","positionRestrictionsAlgorithm","maxCanvasSize","transitionsActive","imageLoaded","imageAttributes","customImageTransforms","basicImageTransforms","initialized","settings","wheel","mouse","areaRestrictions","transitionsOptions","restrictions","areaLimits","areaMaximum","getStencilSize","cropper","background","foreground","cropperWrapper","defaultCoordinates","boundariesStyle","styles","round","pointerEvents","opacity","optimalImageSize","$nextTick","resetCoordinates","runAutoZoom","onChange","onPropsChange","reset","oldProps","newProps","prop","created","debouncedUpdate","update","debouncedDisableTransitions","disableTransitions","awaiting","onSuccessLoadImage","onFailLoadImage","revoke","URL","revokeObjectURL","getResult","prepareResult","getCanvas","zoom","onManipulateImage","normalize","setCoordinates","enableTransitions","delayedTransforms","updateVisibleArea","then","_this3","resetVisibleArea","_this4","awaitRender","_this5","roundedCoordinates","floor","ceil","getPublicProperties","processAutoZoom","algorithm","getAspectRatio","payload","normalizeEvent","normalizedEvent_1","normalizedEvent_2","source","originalSize","transformedSize","ctx","getContext","save","canvasCenter","translate","drawImage","restore","prepareSource","sourceCanvas","maxArea","imageSmoothingEnabled","imageSmoothingQuality","fillColor","firstNumeric","array","el","parseFloat","isFinite","resultSize","clearRect","fillStyle","fillRect","updateCanvas","limited","defaultSizeAlgorithm","defaultPositionAlgorithm","_this6","clearImage","_this7","updateBoundaries","_this8","areaHeight","areaWidth","fitBoundaries","fillBoundaries","_this9","boundariesRatio","catch","_this10","pageLocation","location","urlMatch","exec","urlparts","protocol","host","port","portOf","isCrossOriginURL","promise","orientation","_this11","onParseImage","_this12","createObjectURL","Blob","chunks","uint8","subarray","from","btoa","arrayBufferToDataURL","getImageTransforms","_this13","isLoadedImage","_this14","_this15","minimumSize","ticking","ignoreStencil","stencilRatio","currentStencilSize"],"mappings":"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"}